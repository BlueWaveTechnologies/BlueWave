//Bluewave Explorer 1.0.0
if(!bluewave)var bluewave={};bluewave.utils={get:function(e,t){var a=null;2<arguments.length&&(a=arguments[1],t=arguments[2]);var l=javaxt.dhtml.utils.get;l(e,{payload:a,success:function(e){var a=e.substring(0,1);if("{"==a||"["==a){var l=JSON.parse(e);if(l.cols&&l.rows){for(var o=l.rows,n={},s=0;s<l.cols.length;s++)n[l.cols[s]]=s;for(var s=0;s<o.length;s++){var d=o[s],r={};for(var p in n)n.hasOwnProperty(p)&&(r[p]=d[n[p]]);o[s]=r}l=o}e=l}t.success&&t.success.apply(this,[e])},failure:function(e){t.failure&&t.failure.apply(this,[e])}})},getData:function(e,t,a){bluewave.data||(bluewave.data={}),1<arguments.length&&"function"==typeof arguments[1]&&(a=arguments[1],t="data/");var l=t.lastIndexOf("/");l!==t.length-1&&(t+="/");var i=t+e,o=javaxt.dhtml.utils.get,n=function(e){a&&a.apply(this,[e])};o(i,{success:function(e){0==e.indexOf("{")||0==e.indexOf("[")?n(JSON.parse(e)):n(e)},failure:function(){var t=e.indexOf("?");if(-1<t&&(e=e.substring(0,t)),bluewave.data[e])n(bluewave.data[e]);else{var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",i+".js?_="+new Date().getTime()),a.onload=function(){n(bluewave.data[e])};var l=document.getElementsByTagName("head")[0];l.appendChild(a)}}})},getMapData:function(e,t){if(0!==arguments.length){"function"==typeof arguments[0]&&(t=arguments[0],e="data/");var a=bluewave.utils.getData;bluewave.data||(bluewave.data={}),bluewave.data.mapData||(bluewave.data.mapData={});var l=bluewave.data.mapData.counties,i=bluewave.data.mapData.countries;l?i?t.apply(this,[bluewave.data.mapData]):a("countries",e,function(e){i=topojson.feature(e,e.objects.countries),bluewave.data.mapData.countries=i,t.apply(this,[bluewave.data.mapData])}):a("counties",e,function(o){l=topojson.feature(o,o.objects.counties),bluewave.data.mapData.counties=l;var n=topojson.feature(o,o.objects.states);bluewave.data.mapData.states=n,i?t.apply(this,[bluewave.data.mapData]):a("countries",e,function(e){i=topojson.feature(e,e.objects.countries),bluewave.data.mapData.countries=i,t.apply(this,[bluewave.data.mapData])})})}},warn:function(e,t){var a=t.row,l;l=a?a.childNodes[2]:t.el.parentNode,null==l&&(l=t.el.parentNode);var i=javaxt.dhtml.utils.getRect,o=i(l),n=l.getElementsByTagName("input");if(0==n.length&&(n=l.getElementsByTagName("textarea")),0<n.length){n[0].blur();n[0].className?-1==n[0].className.indexOf("form-input-error")&&(n[0].className+=" form-input-error"):n[0].className="form-input-error",o=i(n[0]),t.resetColor=function(){n[0].className&&(n[0].className=n[0].className.replace("form-input-error",""))}}var s=bluewave.utils.formError;s||(s=new javaxt.dhtml.Callout(document.body,{style:{panel:"error-callout-panel",arrow:"error-callout-arrow"}}),bluewave.utils.formError=s),s.getInnerDiv().innerHTML=e;var d=o.x+o.width/2,r=o.y;s.showAt(d,r,"above","center")},createButton:function(e,t){return t=JSON.parse(JSON.stringify(t)),t.icon&&(t.style.icon="toolbar-button-icon "+t.icon,delete t.icon),!0===t.menu&&(t.style.arrow="toolbar-button-menu-icon",t.style.menu="menu-panel",t.style.select="panel-toolbar-menubutton-selected"),new javaxt.dhtml.Button(e,t)},createSpacer:function(e){var t=document.createElement("div");t.className="toolbar-spacer",e.appendChild(t)},createToggleButton:function(e,t){javaxt.dhtml.utils.merge(t,{style:{panel:"toggle-button-bar noselect",button:"toggle-button",activeButton:"toggle-button-active"}});var a=document.createElement("div");a.className=t.style.panel,e.appendChild(a);for(var l=function(e,l){e.className!==t.style.activeButton&&(a.reset(),e.className=t.style.activeButton,!0===l||t.onChange&&t.onChange.apply(e,[e.innerHTML]))},o=0,n;o<t.options.length;o++)n=document.createElement("div"),n.className=t.style.button,n.innerHTML=t.options[o],n.onclick=function(){l(this)},a.appendChild(n);return a.setValue=function(e){for(var t=0,o;t<a.childNodes.length;t++)if(o=a.childNodes[t],o.innerText===e){l(o);break}},a.getValue=function(){for(var e=0,l;e<a.childNodes.length;e++)if(l=a.childNodes[e],l.className===t.style.activeButton)return l.innerText;return null},a.reset=function(){for(var e=0;e<a.childNodes.length;e++)a.childNodes[e].className=t.style.button},a},createDashboardItem:function(e,t){javaxt.dhtml.utils.merge(t,{width:360,height:260,title:"",subtitle:"",settings:!1,waitmask:!1});var a=t.width+"",l=t.height+"";-1===a.indexOf("%")&&(a=parseInt(a)+"px"),-1===l.indexOf("%")&&(l=parseInt(l)+"px");var i=document.createElement("div");i.className="dashboard-item",i.style.width=a,i.style.height=l,i.style.position="relative",e.appendChild(i);var o;!0===t.settings&&(o=document.createElement("div"),o.className="dashboard-item-settings noselect",o.innerHTML="<i class=\"fas fa-cog\"></i>",i.appendChild(o));var n=javaxt.dhtml.utils.createTable(),s=n.firstChild,d;d=document.createElement("tr"),s.appendChild(d);var r=document.createElement("td");r.className="chart-title noselect",r.innerHTML=t.title,d.appendChild(r),d=document.createElement("tr"),s.appendChild(d);var p=document.createElement("td");p.className="chart-subtitle noselect",p.innerHTML=t.subtitle,d.appendChild(p),d=document.createElement("tr"),s.appendChild(d);var u=document.createElement("td");u.style.height="100%",u.style.position="relative",d.appendChild(u),i.appendChild(n);var h;return t.waitmask&&(h=new javaxt.express.WaitMask(i)),{el:i,title:r,subtitle:p,innerDiv:u,settings:o,waitmask:h}},createGrid:function(e,t,a,l){a.innerHTML="";for(var o=[],n=javaxt.dhtml.utils.getSuggestedColumnWidths(e,10),s=e[0],d=0;d<s.length;d++){var r=n.suggestedWidths[d],p=null;"100%"===r&&1<s.length&&(p=Math.min(n.widths[d],175)),o.push({header:t?s[d]:d+1,width:r,minWidth:p,sortable:!1})}var u=document.createElement("div");u.style.height="100%",u.style.position="relative",a.appendChild(u);var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.overflow="hidden",h.style.overflowX="auto",u.appendChild(h);var c=document.createElement("div");c.style.width="100%",c.style.height="100%",c.style.position="absolute",h.appendChild(c);var y=n.headerWidth;javaxt.dhtml.utils.onRender(h,function(){var e=javaxt.dhtml.utils.getRect(h);e.width<y&&(c.style.width=y+"px")});var m=new javaxt.dhtml.DataGrid(c,{columns:o,style:l.style.table});if(t){for(var g=[],d=1;d<e.length;d++)g.push(e[d]);m.load(g,1)}else m.load(e,1);return m},addTextEditor:function(t,a){var l=function(e){a&&a.apply(t,[e])};t.onclick=function(t){if(1!==this.childNodes[0].nodeType){t.stopPropagation();var e=this.innerText;this.innerHTML="";var a=document.createElement("input");a.className="form-input",a.type="text",a.value=e,a.onkeydown=function(e){var t=e.keyCode;(9===t||13===t)&&l(this.value)},this.appendChild(a),a.focus()}},document.body.addEventListener("click",function(a){var e=t.childNodes[0],i=a.target.className;1===e.nodeType&&"form-input"!=i&&l(e.value)})},createSlider:function(e,t,a="",l=0,o=100,n=5){for(var s=Math.ceil,d=t.findField(e),r=d.row.cloneNode(!0),p=r.childNodes,u=0;u<p.length;u++)p[u].innerHTML="";d.row.parentNode.insertBefore(r,d.row.nextSibling),r.style.height="20px";var h=document.createElement("input");p[2].appendChild(h),h.type="range",h.className="dashboard-slider",l=parseInt(l),0>l&&(l=0),o=parseInt(o),o<l&&(o=100),n=parseInt(n),1>n&&(n=1),o=s(o/n),h.setAttribute("min",l+1),h.setAttribute("max",o+1),h.onchange=function(){var e=(this.value-1)*n;d.setValue(e)};var c=javaxt.dhtml.utils.isNumber,y=javaxt.dhtml.utils.round,m=d.setValue;d.setValue=function(e){e=parseFloat(e),m(e+`${a}`),h.value=y(e/n)+1};var g=d.getValue;return d.getValue=function(){var e=parseFloat(g());return c(e)?y(e,0):0},d.row.getElementsByTagName("input")[0].addEventListener("input",function(){var e=parseFloat(this.value);c(e)&&(0>e&&(e=0),d.setValue(e))}),h},createColorOptions:function(e,t,a){var l=t.findField(e),i=l.getButton();i.className=i.className.replace("pulldown-button-icon",""),i.style.boxShadow="none",i.setColor=function(e){i.style.backgroundColor=e},l.setValue=function(e){i.setColor(e),l.getInput().value=e,t.onChange(l,e)},l.getValue=function(){return l.getInput().value},i.onclick=function(){a&&a.apply(this,[l])}},formatNumber:function(e){if(null==e)return"";"string"!=typeof e&&(e+="");var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},getStyleEditor:function(e){return bluewave.utils.styleEditor||(bluewave.utils.styleEditor=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:e.style.window})),bluewave.utils.styleEditor},getColorPalette:function(e){return!0===e?["#6699CC","#98DFAF","#FF3C38","#FF8C42","#933ed5","#bebcc1","#9DBEDE","#C6EDD3","#FF8280","#FFB586","#cda5eb","#dedde0"]:[...["#C6EDD3","#98DFAF","#FF8280","#FF3C38","#FFB586","#FF8C42","#9DBEDE","#6699CC","#999999"],...d3.schemeCategory10]},getThemeColors:function(){return{blue:"#6699CC",green:"#98DFAF",red:"#FF3C38",orange:"#FF8C42",purple:"#933ed5",grey:"#bebcc1"}},getColorGradients:function(){var e={},t=bluewave.utils.getThemeColors();for(var a in t)if(t.hasOwnProperty(a)){var l=t[a];e[a]=[l,"#f8f8f8"],"blue"==a&&(e.blue=d3.schemeBlues[7].reverse()),"red"==a&&(e.red=d3.schemeReds[7].reverse()),"green"==a&&(e.green=d3.schemeGreens[7].reverse()),"grey"==a&&(e.grey=d3.schemeGreys[7].reverse()),"purple"==a&&(e.purple=d3.schemePurples[7].reverse())}for(var o=[],n=[],s=0,d;10>=s;s++)d=s/10,o.push(d3.interpolateInferno(d)),n.push(d3.interpolatePlasma(d));return e.inferno=o.reverse(),e.plasma=n.reverse(),e.mixed=Object.values(t),e.d3=d3.schemeCategory10,e.tableau=d3.schemeTableau10,e},createColorField:function(e,t){0===arguments.length?e=document.createElement("div"):1===arguments.length&&!javaxt.dhtml.utils.isElement(e)&&(t=e,e=document.createElement("div")),t||(t={});var a={style:javaxt.dhtml.style.default};javaxt.dhtml.utils.merge(t,a);var l=new javaxt.dhtml.ComboBox(e,{style:t.style.combobox,readOnly:!0,addNewOption:!1,addNewOptionText:"Add New...",showMenuOnFocus:!0}),o;for(var n in t.colors||(t.colors=bluewave.utils.getColorGradients()),t.colors)if(t.colors.hasOwnProperty(n)){var s=t.colors[n],d=chroma.scale(s),r=document.createElement("div");r.className="form-input-menu-color";for(var u="linear-gradient(to right",h=0;h<s.length;h++){var y=javaxt.dhtml.utils.round(h/(s.length-1),2),m=d(y).css();u+=", "+m+" "+100*y+"%"}u+=")",r.style.background=u,l.add(r,JSON.stringify(s)),o||(o=n)}var g=l.setValue;return l.setValue=function(e){"string"==typeof e||e instanceof String?g(e):g(JSON.stringify(e))},l},createColorPicker:function(e,t){t||(t={}),t.style||(t.style=javaxt.dhtml.style.default);var a=t.colors;a||(a=bluewave.utils.getColorPalette(!0));var l={onChange:function(){},setColor:function(){},colorWheel:null,setColors:function(){}},i=javaxt.dhtml.utils.createTable(),o=i.firstChild,n,s;n=document.createElement("tr"),o.appendChild(n),s=document.createElement("td"),n.appendChild(s);var d=document.createElement("div");d.innerHTML="<i class=\"fas fa-check\"></i>";var r=document.createElement("div");r.className="color-picker-header",r.innerHTML="Theme Colors",s.appendChild(r);var p=s,u=[];l.setColors=function(e){u.forEach(e=>{var t=e.parentNode;t.removeChild(e)}),u=[],e.forEach(e=>{r=document.createElement("div"),r.className="color-picker-option",r.style.backgroundColor=e,r.onclick=function(){d.parentNode===this||(d.parentNode&&d.parentNode.removeChild(d),this.appendChild(d),l.onChange(new iro.Color(this.style.backgroundColor).hexString))},p.appendChild(r),u.push(r)})},l.setColors(a),n=document.createElement("tr"),o.appendChild(n),s=document.createElement("td"),n.appendChild(s);var r=document.createElement("div");r.className="color-picker-header noselect",r.innerHTML="Custom Colors",s.appendChild(r);var h=function(){r=document.createElement("div"),r.className="color-picker-option",r.onclick=function(){if(d.parentNode!==this){if(""===this.innerHTML)return d.parentNode&&d.parentNode.removeChild(d),this.appendChild(d),void l.onChange(new iro.Color(this.style.backgroundColor).hexString);if(!l.colorWheel){var e=new javaxt.dhtml.Callout(document.body,{style:{panel:"color-picker-callout-panel",arrow:"color-picker-callout-arrow"}}),t=e.getInnerDiv();t.style.padding="5px",t.style.backgroundColor="#fff";var a=new iro.ColorPicker(t,{width:280,height:280,anticlockwise:!0,borderWidth:1,borderColor:"#fff",css:{"#output":{"background-color":"$color"}}});l.colorWheel=e,l.colorWheel.getColor=function(){return a.color.hexString},a.on("color:change",function(){var e=l.colorWheel.target;e.innerHTML="",e.style.backgroundColor=l.colorWheel.getColor()})}var o=this,n=javaxt.dhtml.utils.getRect(o),s=n.x+n.width+5,r=n.y+n.height/2;l.colorWheel.target=o,l.colorWheel.showAt(s,r,"right","middle"),l.colorWheel.onHide=function(){0<i.getElementsByClassName("color-picker-new-option").length||h()}}},s.appendChild(r);var e=document.createElement("div");e.className="color-picker-new-option",e.innerHTML="<i class=\"fas fa-plus\"></i>",r.appendChild(e)};return h(),e.appendChild(i),l},createColorPickerCallout:function(e){var t=new javaxt.dhtml.Callout(document.body,{style:{panel:"color-picker-callout-panel",arrow:"color-picker-callout-arrow"}}),a=t.getInnerDiv(),l=document.createElement("div");l.className="window-header",l.innerHTML="<div class=\"window-title\">"+"Select Color"+"</div>",a.appendChild(l);var i=document.createElement("div");i.style.padding="0 15px 15px",i.style.width="325px",i.style.backgroundColor="#fff",a.appendChild(i);var o=javaxt.dhtml.utils.createTable(),n=o.firstChild,s=document.createElement("tr");n.appendChild(s);var d=document.createElement("td");s.appendChild(d);var r=bluewave.utils.createColorPicker(d,e);return t.onHide=function(){r.colorWheel&&r.colorWheel.isVisible()&&(r.colorWheel.hide(),t.show())},t.onChange=function(){},t.setColor=function(e){r.setColor(e)},t.setColors=function(e){r.setColors(e)},r.onChange=function(e){t.onChange(e)},i.appendChild(o),t},resizeCanvas:function(e,t,a,l){var o=Math.sqrt,n=Math.abs,s=Math.floor,d=Math.round,r=Math.ceil,p=e.width,u=e.height;t=d(t),a=d(a);for(var h=p/t,c=u/a,y=r(h/2),m=r(c/2),g=e.getContext("2d"),b=g.getImageData(0,0,p,u),f=g.createImageData(t,a),C=b.data,x=f.data,v=0;v<a;v++)for(var k=0;k<t;k++){for(var L=4*(k+v*t),T=0,E=0,V=0,N=0,D=0,O=0,F=0,S=(v+.5)*c,B=s(v*c),M=r((v+1)*c),A=B;A<M;A++)for(var H=n(S-(A+.5))/m,P=(k+.5)*h,R=H*H,z=s(k*h),I=r((k+1)*h),G=z;G<I;G++){var W=n(P-(G+.5))/y,U=o(R+W*W);if(!(1<=U)){T=2*U*U*U-3*U*U+1;var _=4*(G+A*p);F+=T*C[_+3],V+=T,255>C[_+3]&&(T=T*C[_+3]/250),N+=T*C[_],D+=T*C[_+1],O+=T*C[_+2],E+=T}}x[L]=N/E,x[L+1]=D/E,x[L+2]=O/E,x[L+3]=F/V}!0===l?(e.width=t,e.height=a):g.clearRect(0,0,p,u),g.putImageData(f,0,0)},base64ToBlob:function(e,t){t=t||"";for(var a=1024,l=window.atob(e),o=[],n=0,s=l.length;n<s;n+=a){for(var d=l.slice(n,n+a),r=Array(d.length),p=0;p<d.length;p++)r[p]=d.charCodeAt(p);var u=new Uint8Array(r);o.push(u)}return new Blob(o,{type:t})},getPixel:function(){var e=bluewave.utils.pixel;if(!e){var t=document.createElement("canvas");t.width=1,t.height=1,e=t.toDataURL("image/png"),bluewave.utils.pixel=e}return e},parseData:function(e,t){var a=[];if(null==e||0==e.length)return a;if(!javaxt.dhtml.utils.isArray(e[0])){var l=t.sheetName,o;if(l){for(var n=0;n<e.length;n++)if(e[n].name===l){o=e[n];break}}else e[0].name&&e[0].getData&&(o=e[0]);if(!o)return a;if(e=o.getData(),null==e||0==e.length)return a}var s=[],d=0;!0===t.hasHeader?(s=e[0],d=1):e[0].forEach((e,t)=>{s.push(t+1+"")});for(var n=d,r;n<e.length;n++)r={},e[n].forEach((e,t)=>{var a=s[t];r[a]=e}),a.push(r);return a},parseCSV:function(e,t){t||(t={});return javaxt.dhtml.utils.merge(t,{headers:!1,quote:"\"",separator:","}),t.headers=!1,e&&(e=e.trim()),alasql.from.CSV(e,t,null,0,null)},parseXLS:function(e,t){var a=String.fromCharCode;t||(t={});var i=alasql.utils.global.XLSX,n="binary";if(e instanceof ArrayBuffer){n="base64";for(var s="",d=0,r=10240;d<e.byteLength/r;++d)s+=a.apply(null,new Uint8Array(e.slice(d*r,d*r+r)));s+=a.apply(null,new Uint8Array(e.slice(d*r))),e=btoa(s)}var p=i.read(e,{type:n,...alasql.options.excel,...t}),u=p.SheetNames;u||(u=[]);var h=[];return u.forEach(e=>{h.push({name:e,getData:function(e){e||(e={});return javaxt.dhtml.utils.merge(e,{headers:!1}),e.headers=!1,bluewave.utils.parseWorkbook(this.name,p,e)}})}),h},parseWorkbook:function(e,t,a){function l(e){return e&&!1===alasql.options.casesensitive?e.toLowerCase():e}a||(a={});var o=[],n;if("undefined"==typeof a.range?n=t.Sheets[e]["!ref"]:(n=a.range,t.Sheets[e][n]&&(n=t.Sheets[e][n])),n){for(var s=n.split(":"),d=s[0].match(/[A-Z]+/)[0],r=+s[0].match(/[0-9]+/)[0],p=s[1].match(/[A-Z]+/)[0],u=+s[1].match(/[0-9]+/)[0],h={},c=alasql.utils.xlscn(d),y=alasql.utils.xlscn(p),m=c,g;m<=y;m++)g=alasql.utils.xlsnc(m),h[g]=a.headers?t.Sheets[e][g+""+r]?l(t.Sheets[e][g+""+r].v):l(g):g;a.headers&&r++;for(var b=r;b<=u;b++){var f=a.headers?{}:[];for(var m=c;m<=y;m++){var g=alasql.utils.xlsnc(m),C=null;t.Sheets[e][g+""+b]&&(C=t.Sheets[e][g+""+b].v),a.headers?C&&(f[h[g]]=C):f.push(C)}o.push(f)}}else o.push([]);return 0<o.length&&o[o.length-1]&&0==Object.keys(o[o.length-1]).length&&o.pop(),o}},bluewave.utils.Confirm=null;var confirm=function(e,t){"string"==typeof e||e instanceof String||(t=e),javaxt.dhtml.utils.merge(t,{title:"Confirm",text:e});var a=bluewave.utils.Confirm;if(!a){var l=document.getElementsByTagName("body")[0],i=document.createElement("div");i.className="button-div";var o=function(e,t){var l=document.createElement("input");return l.type="button",l.className="form-button",l.onclick=function(){a.result=this.result,a.close()},l.setLabel=function(e){e&&(this.name=this.value=e)},l.setValue=function(e){(!0===e||!1===e)&&(this.result=e)},l.update=function(e){e&&(this.setLabel(e.label),this.setValue(e.value))},l.setLabel(e),l.setValue(t),i.appendChild(l),l};a=bluewave.utils.Confirm=new javaxt.dhtml.Window(l,{width:450,height:150,valign:"top",modal:!0,footer:i,style:{panel:"window",header:"window-header",title:"window-title",buttonBar:"window-header-button-bar",button:"window-header-button",body:"window-body confirm-body"}}),a.leftButton=o("OK",!0),a.rightButton=o("Cancel",!1)}return a.setTitle(t.title),a.setContent(t.text.replace("\n","<p></p>")),a.leftButton.update(t.leftButton),a.rightButton.update(t.rightButton),a.result=!1,a.onClose=function(){var e=t.callback;e&&e.apply(a,[a.result])},a.show(),!1};bluewave.utils.Alert=null;var alert=function(e){null==e&&(e=""),"string"==typeof e||e instanceof String||"undefined"==typeof e.responseText||(e=0<e.responseText.length?e.responseText:e.statusText,!e&&(e="Unknown Server Error"));var t=bluewave.utils.Alert;if(!t){var a=document.getElementsByTagName("body")[0],l=document.createElement("div");l.style.width="100%",l.style.height="100%",l.style.position="relative",l.style.cursor="inherit";var i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="absolute",i.style.overflowX="hidden",i.style.cursor="inherit",l.appendChild(i),t=bluewave.utils.Alert=new javaxt.dhtml.Window(a,{width:450,height:200,valign:"top",modal:!0,title:"Alert",body:l,style:{panel:"window",header:"window-header alert-header",title:"window-title",buttonBar:"window-header-button-bar",button:"window-header-button",body:"window-body alert-body"}}),t.div=i}t.div.innerHTML=e,t.show()};if(!bluewave)var bluewave={};if(bluewave.Explorer=function(parent,config){var _Mathabs2=Math.abs,_Mathceil3=Math.ceil;this.className="bluewave.Explorer";var me=this,defaultConfig={nodes:[{title:"Pie Chart",type:"pieChart",icon:"fas fa-chart-pie",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.PieEditor},inputNodes:["datafile","filter","sankeyChart"]},{title:"Bar Chart",type:"barChart",icon:"fas fa-chart-bar",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.BarEditor},inputNodes:["datafile","filter"]},{title:"Line Chart",type:"lineChart",icon:"fas fa-chart-line",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.LineEditor},inputNodes:["datafile","filter"]},{title:"Histogram Chart",type:"histogramChart",icon:"fas fa-chart-area",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.HistogramEditor},inputNodes:["datafile","filter"]},{title:"Scatter Chart",type:"scatterChart",icon:"fas fa-braille",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.ScatterEditor},inputNodes:["datafile","filter"]},{title:"Map",type:"mapChart",icon:"fas fa-globe-americas",editor:{width:1180,height:700,resizable:!0,class:bluewave.editor.MapEditor},inputNodes:["datafile","filter"]},{title:"Treemap Chart",type:"treeMapChart",icon:"fas fa-basketball-ball",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.TreeMapEditor},inputNodes:["datafile","filter"]},{title:"Calendar Chart",type:"calendarChart",icon:"fas fa-th",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.CalendarEditor},inputNodes:["datafile","filter"]},{title:"Sankey Chart",type:"sankeyChart",icon:"fas fa-random",editor:{width:1680,height:920,resizable:!0,class:bluewave.editor.SankeyEditor}},{title:"Filter",type:"filter",icon:"fas fa-filter",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.FilterEditor},inputNodes:["datafile"]}],toolbar:{nodes:["sankeyChart","pieChart","barChart","lineChart","histogramChart","scatterChart","mapChart","treeMapChart","calendarChart","filter"]},supportedFileTypes:["csv","tab","tsv","xls","xlsx","pdf"]},button={},nodes={},windows=[],zoom=0,init=function(){if(me.setConfig(config),!!parent){config.fx||(config.fx=new javaxt.dhtml.Effects),config.style||(config.style=javaxt.dhtml.style.default),waitmask=config.waitmask,waitmask||(waitmask={show:function(){},hide:function(){}});var e=createElement("div",parent,{height:"100%",position:"relative"});e.setAttribute("desc",me.className),e.onwheel=function(t){t.preventDefault(),drawflow&&(0<t.deltaY?zoomOut():zoomIn())},e.tabIndex=-1,createDrawFlow(e),tooltip=new javaxt.dhtml.Callout(document.body,{style:{panel:"tooltip-panel",arrow:"tooltip-arrow"}});var t=tooltip.hide;tooltip.hide=function(){tooltipTimer&&clearTimeout(tooltipTimer),t()},addShowHide(e),me.el=e,addShowHide(me)}},id,name,description,thumbnail,menubar,tooltip,tooltipTimer,lastToolTipEvent,drawflow,waitmask;this.onChange=function(){},this.setConfig=function(e){config=e?merge(e,defaultConfig):defaultConfig},this.getConfig=function(){return config},this.addExtensions=function(e){e&&e.forEach(function(e){addExtension(e)})},this.setName=function(e){name=e},this.getName=function(){return name},this.setDescription=function(e){description=e},this.getDescription=function(){return description},this.setThumbnail=function(e){thumbnail=e},this.getThumbnail=function(){return thumbnail},this.setID=function(e){id=e},this.getID=function(){return id},this.getDashboard=function(){var e={id:id,name:name,description:description,className:me.className,thumbnail:thumbnail,info:{layout:drawflow.export().drawflow.Home.data,nodes:{},zoom:zoom}};for(var t in nodes)if(nodes.hasOwnProperty(t)){var a=nodes[t];e.info.nodes[t]={name:a.name,type:a.type,config:a.config,preview:a.preview},"datafile"===a.type&&a.data&&(e.info.nodes[t].data=a.data)}return e},this.getNodes=function(){return nodes},this.clear=function(){for(var e in id=name=description=thumbnail=null,nodes={},drawflow.clear(),button)button.hasOwnProperty(e)&&button[e].disable();for(var t in windows)windows[t].hide();zoom=0},this.update=function(e,t,a){if(e||(e={}),me.clear(),id=e.id,name=e.name,description=e.description,!description&&e.info&&(description=e.info.description),thumbnail=e.thumbnail,drawflow.editor_mode=t?"view":"edit",updateButtons(),me.el.focus(),!e.info)return void(a&&a.apply(me,[]));drawflow.import({drawflow:{Home:{data:e.info.layout}}});var l=[],o=[];for(var n in e.info.nodes)if(e.info.nodes.hasOwnProperty(n)){var s=drawflow.getNodeFromId(n),d=createElement("div");d.innerHTML=s.html;var r=document.getElementById(d.childNodes[0].id),p=e.info.nodes[n];for(var u in p)if(p.hasOwnProperty(u)){var h=p[u];r[u]=h}for(var u in"map"===r.type&&(r.type="mapChart"),p.config.chartTitle&&updateTitle(r,p.config.chartTitle),p.preview&&l.push({node:r,thumbnail:p.preview}),addEventListeners(r),r.inputs={},s.inputs)if(s.inputs.hasOwnProperty(u)){var c=s.inputs[u].connections;for(var y in c){var m=c[y],g=m.node,b=nodes[g];r.inputs[g]=b,o.push(g)}}nodes[n]=r}for(var n in nodes){var r=nodes[n];for(var g in r.inputs){var b=r.inputs[g];b||(r.inputs[g]=nodes[g])}}var f=[];for(var n in nodes){var r=nodes[n];if("filter"===r.type){var C=getNodeEditor(r);C&&f.push(C)}}var w=function(){updateButtons(),setTimeout(function(){for(var t=0,n;t<o.length;t++)n=o[t],drawflow.updateConnectionNodes("node-"+n);for(var t=0;t<l.length;t++)(function(e){var t=e.node.childNodes[1];onRender(t,function(){createThumbnail(e.node,e.thumbnail)})})(l[t]);setZoom(e.info.zoom),me.el.focus(),a&&a.apply(me,[])},500)};if(0===f.length)w();else{waitmask.show();var x=function(){if(0===f.length)return waitmask.hide(),void w();var e=f.shift(),t=e.getNode();e.update(t,function(){e.getData&&e.getData(function(e){t.data=e?JSON.parse(JSON.stringify(e)):[]}),e.clear(),x()})};x()}};var updateButtons=function(){for(var e in button)button.hasOwnProperty(e)&&button[e].disable();if(!me.isReadOnly()){var a={};for(var e in nodes)if(nodes.hasOwnProperty(e)){var l=nodes[e];a[l.type]=!0}config.nodes.forEach(function(e){var l=button[e.type];if(l){var i=e.inputNodes;i||(i=[]),0<i.length?i.every(function(e){var t=!1,i=!0;return("string"==typeof e?t=a[e]:(t=a[e.inputNode],i=e.required),t)?(l.enable(),!1):(i||l.enable(),!0)}):l.enable()}})}};this.setReadOnly=function(e){if(!0===e){if(me.isReadOnly())return;drawflow.editor_mode="view"}else{if(!me.isReadOnly())return;drawflow.editor_mode="edit"}updateButtons()},this.isReadOnly=function(){return"view"===drawflow.editor_mode},this.getToolbar=function(){return menubar},this.getButtons=function(){return button};var getFileNodes=function(){var e=[];for(var t in nodes)if(nodes.hasOwnProperty(t)){var a=nodes[t];isValidFile(a.type)&&e.push(a)}return e},createDrawFlow=function(e){var t=createElement("div",e,"drawflow");t.addEventListener("dragover",onDragOver,!1),t.addEventListener("drop",onDrop,!1),drawflow=new Drawflow(t),drawflow.reroute=!0,drawflow.start(),drawflow.on("connectionCreated",function(e){var t=e.output_id+"",a=e.input_id+"",l=nodes[a],i=nodes[t],o=!1;config.nodes.every(function(e){if(e.type===l.type){var t=e.inputNodes;return t&&t.forEach(function(e){"string"==typeof e?i.type===e&&(o=!0):e.inputNode===i.type&&(o=!0)}),!1}return!0}),o?(l.inputs[t]=i,l.ondblclick()):drawflow.removeSingleConnection(e.output_id,e.input_id,e.output_class,e.input_class),me.onChange("connectionCreated")}),drawflow.on("nodeRemoved",function(e){removeInputs(nodes,e);var t=nodes[e+""];delete nodes[e+""],updateButtons(),me.onChange("nodeRemoved",t)}),drawflow.on("connectionRemoved",function(e){var t=e.output_id+"",a=e.input_id+"",l=nodes[a];delete l.inputs[t+""],me.onChange("connectionRemoved")}),drawflow.on("contextmenu",function(){setTimeout(function(){for(var e in nodes)if(nodes.hasOwnProperty(e)){var t=nodes[e],a=t.parentNode.parentNode,l=a.getElementsByClassName("drawflow-delete")[0];l&&(a.removeChild(l),l=createElement("div",a,"drawflow-delete2"),l.innerHTML="&#x2715",l.nodeID=parseInt(e),l.onclick=function(){var e=this,t=e.nodeID;confirm("Are you sure you want to delete this node?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(a){a?drawflow.removeNodeId("node-"+t):e.parentNode.removeChild(e)}})})}},200)}),drawflow.on("nodeMoved",function(e){me.onChange("nodeMoved",nodes[e+""])}),menubar=createElement("div",t,"drawflow-toolbar"),config.toolbar.nodes.forEach(e=>{"string"==typeof e?config.nodes.every(t=>{if(e===t.type){var a=createMenuButton(t.type,t.icon,t.title);return t.inputNodes?isArray(t.inputNodes)&&0===t.inputNodes.length&&a.enable():a.enable(),!1}return!0}):isArray(e)})},setZoom=function(e){if(e=parseInt(e),!(isNaN(e)||e===zoom)){for(var t=_Mathabs2(e,zoom),a=0;a<t;a++)e<zoom?zoomOut():zoomIn();me.onChange("zoomChange")}},zoomIn=function(){drawflow.zoom_in(),zoom++},zoomOut=function(){drawflow.zoom_out(),zoom--},drag=function(e){"touchstart"===e.type||e.dataTransfer.setData("node",e.target.getAttribute("data-node"))},onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},onDrop=function(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type);else{var e=t.clientX,a=t.clientY,l=t.dataTransfer.files;if(0<l.length){for(var o={},n=getFileNodes(),s=0;s<n.length;s++){var d=n[s],r=d.config.fileName;o[r.toLowerCase()]=d}for(var p=[],s=0,u;s<l.length;s++)if(u=l[s],isValidFile(u)){var r=u.name.toLowerCase();o[r]||p.push(u)}if(0===p.length)return;var h=0,c=[];waitmask.show();var m=function(){if(0===p.length)return waitmask.hide(),void(0<c.length&&alert("Failed to upload "+c));var t=p.shift(),l=getFileExtension(t);if(isValidFile(l)){var i=new FormData;i.append(t.name,t),0<h&&(e+=35,a+=85),h++,addNodeToDrawFlow(l,e,a,t),m()}};m(),0<h&&updateButtons()}else{let l=t.dataTransfer.getData("node");addNodeToDrawFlow(l,e,a)}}},addNodeToDrawFlow=function(e,t,a,l){if("fixed"===drawflow.editor_mode)return!1;t=t*(drawflow.precanvas.clientWidth/(drawflow.precanvas.clientWidth*drawflow.zoom))-drawflow.precanvas.getBoundingClientRect().x*(drawflow.precanvas.clientWidth/(drawflow.precanvas.clientWidth*drawflow.zoom)),a=a*(drawflow.precanvas.clientHeight/(drawflow.precanvas.clientHeight*drawflow.zoom))-drawflow.precanvas.getBoundingClientRect().y*(drawflow.precanvas.clientHeight/(drawflow.precanvas.clientHeight*drawflow.zoom));var i=getNodeConfig(e);if(!i)return void console.log("Unsupported Node Type: "+e);l&&(i.type="datafile",i.title=l.name),e=i.type;var o=i.icon,n=i.title,s=0,d=1;i.inputNodes&&isArray(i.inputNodes)&&0<i.inputNodes.length&&(s=1),!1===i.output&&(d=0);var r=createNode({name:n,type:e,icon:o,content:createElement("i",o),position:[t,a],inputs:s,outputs:d});addEventListeners(r),me.onChange("nodeCreated",r),l&&(r.file=l,r.config.fileName=l.name,r.ondblclick())},addEventListeners=function(e){e.ondblclick=function(){var t=getNodeEditor(e);if(t){t.clear(),t.show();var a=t.getData?300:50;setTimeout(()=>{t.update(e)},a)}}},createNode=function(e){var t=createElement("div");t.id="_"+new Date().getTime();var a=createElement("div",t,"drawflow-node-title");a.innerHTML="<i class=\""+e.icon+"\"></i><span>"+e.name+"</span>";var l=createElement("div",t,"drawflow-node-body"),i=e.content;i&&("string"==typeof i?l.innerHTML=i:l.appendChild(i));var o=drawflow.addNode(e.type,e.inputs,e.outputs,e.position[0],e.position[1],"",{},t.outerHTML);return t=document.getElementById(t.id),t.type=e.type,t.inputs={},t.config={},nodes[o+""]=t,t},getNodeConfig=function(e){var t;if(config.nodes.every(a=>a.type!==e||(t=a,!1)),!t&&("datafile"===e||isValidFile(e)))switch(e){case"csv":case"xls":case"xlsx":case"datafile":var a="fas fa-file-alt";"csv"===e&&(a="fas fa-file-csv"),("xls"===e||"xlsx"===e)&&(a="fas fa-file-excel"),t={title:e+" Data",icon:a,editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.CsvEditor}};break;case"pdf":var a="fas fa-file-pdf"}return t};this.getNodeEditor=function(e){return getNodeEditor(e)};var getNodeEditor=function(e){var t=getNodeConfig(e.type);if(t){var a=t.editor;if(a.class&&("datafile"===e.type&&(a.title=e.config.fileName),a=createNodeEditor(a),t.editor=a,a.onSave||a.onChange)){var l=function(){if(!me.isReadOnly()){var e=a.getConfig(),t=a.getNode();t.config=JSON.parse(JSON.stringify(e)),me.onChange("nodeUpdated",t)}};a.onSave&&(a.onSave=function(){l()}),a.onChange&&(a.onChange=function(){l()})}if(a.getNode=function(){return e},a.getData){var i=a.update;a.update=function(e,t){i(e,t),a.getData(function(t){e.data=t?JSON.parse(JSON.stringify(t)):[]})}}return a}},createNodeEditor=function(editorConfig){merge(editorConfig,{title:"Edit Chart",width:1060,height:600,resizable:!1,beforeClose:null,style:config.style});var style=merge({body:{padding:"0px"},closeIcon:{content:"&#x2715;",lineHeight:"16px",textAlign:"center"}},config.style.window),win=createWindow({title:editorConfig.title,width:editorConfig.width,height:editorConfig.height,modal:!0,resizable:editorConfig.resizable,shrinkToFit:!0,style:style,renderers:{headerButtons:function(e){var t=createElement("div",e,style.button);createElement("div",t,style.closeIcon),t.onclick=function(){if(editorConfig.beforeClose)editorConfig.beforeClose.apply(me,[win]);else{var e=win.editor,t=e.getNode();e.getData&&e.getData(function(e){t.data=e?JSON.parse(JSON.stringify(e)):[]});var a=e.getConfig(),l=t.config;if(l||(l={}),!isDirty(a,l))updateTitle(t,t.config.chartTitle),win.close(),e.clear();else if(me.onChange("nodeUpdated",t),t.config=JSON.parse(JSON.stringify(a)),updateTitle(t,t.config.chartTitle),e.getChart){waitmask.show();var i=e.getChart();i.show&&i.show(),setTimeout(function(){createPreview(i,function(a){a&&a.toDataURL&&(t.preview=a.toDataURL("image/png"),me.onChange("nodeUpdated",t),createThumbnail(t,a)),win.close(),e.clear(),waitmask.hide()},this)},800)}else win.close(),e.clear();updateButtons()}}}}});if(editorConfig.class){"string"==typeof editorConfig.class&&(editorConfig.class=eval(editorConfig.class));var editor=new editorConfig.class(win.getBody(),editorConfig);return editor.show=function(){win.show()},editor.hide=function(){win.hide()},win.onResize=function(){editor.resize&&editor.resize()},win.editor=editor,editor}},updateTitle=function(e,t){t&&(e.childNodes[0].getElementsByTagName("span")[0].innerHTML=t)},removeInputs=function(e,t){for(var a in e)if(e.hasOwnProperty(a)){var l=e[a];for(var i in l.inputs)i===t&&delete l.inputs[t+""]}},createWindow=function(e){var t=new javaxt.dhtml.Window(document.body,e);return windows.push(t),t},createPreview=function(e,t,a){html2canvas(e).then(e=>{t&&t.apply(a,[e])}).catch(function(e){t&&t.apply(a,["Preview Failed: "+e])})},createThumbnail=function(e,t){var a=e.childNodes[1];a.innerHTML="";var l=javaxt.dhtml.utils.getRect(a),i=l.width,o=l.height,n=createElement("div",a,{width:"100%",height:"100%"}),l=javaxt.dhtml.utils.getRect(n);a.innerHTML="";var s=i-l.width,d=i-s,r=o-s,i=0,o=0,p=function(){var e=d/i;i*=e,o*=e},u=function(){var e=r/o;i*=e,o*=e},h=function(e){if(i=e.width,o=e.height,r<d?(u(),i>d&&p()):(p(),o>r&&u()),0!==i&&0!==o){resizeCanvas(e,i,o,!0);var t=e.toDataURL("image/png"),l=createElement("img","noselect");l.onload=function(){a.appendChild(this)},l.src=t,l.ondragstart=function(t){t.preventDefault()}}};if("string"==typeof t){var c=createElement("img");c.onload=function(){var e=this,t=createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");a.drawImage(e,0,0),h(t)},c.src=t}else h(t)},createMenuButton=function(e,t,a){var l=new javaxt.dhtml.Button(menubar,{display:"table",disabled:!0,style:{button:"drawflow-toolbar-button",select:"drawflow-toolbar-button-selected",hover:"drawflow-toolbar-button-hover",label:"drawflow-toolbar-button-label",icon:"drawflow-toolbar-button-icon "+t}});return l.el.dataset.node=e,l.el.dataset.icon=t,l.el.dataset.title=a,l.el.draggable=!0,l.el.ondragstart=function(t){return!l.isDisabled()&&void drag(t)},l.el.onmouseover=function(){var e=this;if(tooltipTimer&&clearTimeout(tooltipTimer),l.isEnabled()){var t=function(){var t=e.dataset.node,a=e.dataset.title,l="Add "+(null==a?t:a);tooltip.getInnerDiv().innerHTML=l;var i=javaxt.dhtml.utils.getRect(e),o=javaxt.dhtml.utils.getRect(e.parentNode),n=o.x+o.width+3,s=i.y+_Mathceil3(i.height/2);tooltip.showAt(n,s,"right","center"),lastToolTipEvent=new Date().getTime()},a=!1;lastToolTipEvent&&3e3>new Date().getTime()-lastToolTipEvent&&(a=!1),a?tooltipTimer=setTimeout(t,1e3):t()}},l.el.onmouseleave=function(){tooltip.hide()},l.el.onmousedown=function(){tooltip.hide()},button[e]=l,l},addExtension=function(e){"editor"===e.type&&e.node&&addEditor(e.node)},addEditor=function(e){var t=!1;if(config.nodes.forEach(function(a){a.type===e.type&&(t=!0)}),!t)if(e.editor.class)config.nodes.push(e);else return void console.log("Failed to load "+e.title);button[e.type]||createMenuButton(e.type,e.icon,e.title)},getFileExtension=function(e){var t=e.name.toLowerCase(),a=t.substring(t.lastIndexOf(".")+1);return a},isValidFile=function(e){var t="string"==typeof e?e:getFileExtension(e);for(var a=!1,l=0;l<config.supportedFileTypes.length;l++)if(config.supportedFileTypes[l]===t){a=!0;break}return a},merge=javaxt.dhtml.utils.merge,onRender=javaxt.dhtml.utils.onRender,isDirty=javaxt.dhtml.utils.isDirty,isArray=javaxt.dhtml.utils.isArray,addShowHide=javaxt.dhtml.utils.addShowHide,createElement=javaxt.dhtml.utils.createElement,resizeCanvas=bluewave.utils.resizeCanvas;init()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.CalendarEditor=function(e,t){var a=this,l={panel:{},colors:{green:["#fff","#ebf5dc","#cbe9a5","#2a671a"],blue:["#fff","#aebfee","#587bdd","#1d3c90"],orange:["#fff","#fbdc77","#f8c82c","#b78e06"]},chart:{cellSize:13,showTooltip:!0}},i=[],o={},n={},s=function(){t||(t={}),l.chart.colors=l.colors.blue,t=b(t,l),n=t.chart;var i=C(e),o=i.addRow(),s;a.el=i,s=o.addColumn();let h=document.createElement("div");h.className="chart-editor-options",s.appendChild(h),u=h,s=o.addColumn(),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",d=w(s,{width:"100%",height:"100%",title:"Untitled",settings:!0}),r=d.innerDiv,p=new bluewave.charts.CalendarChart(r,{}),d.el.className="",v(d.title,function(e){d.title.innerHTML=e,n.chartTitle=e}),d.settings.onclick=function(){n&&g()}},d,r,p,u,h;this.update=function(e){a.clear();var l={};for(var o in b(l,e.config),b(l,t.chart),n=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var s=e.inputs[o],r=L(s.data,s.config);0<r.length&&i.push(r)}n.chartTitle&&(d.title.innerHTML=n.chartTitle),c(u),m()},this.clear=function(){i=[],n={},d.title.innerHTML="Untitled",u.innerHTML="",p&&p.clear()},this.getConfig=function(){return n},this.getChart=function(){return r},this.renderChart=function(e){var t=new bluewave.charts.CalendarChart(e,{});return t.update(n,i[0]),t};var c=function(e){var t=i[0],a=Object.keys(t[0]),l=[],s=[];a.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var i=k(a);"date"==i&&l.push(e),("number"==i||"currency"==i)&&s.push(e)});var d=C(),r=d.firstChild;d.style.height="",e.appendChild(d),y(r,"Date","date"),y(r,"Value","value"),l.forEach(e=>{o.date.add(e,e)}),s.forEach(e=>{o.value.add(e,e)}),n.date?o.date.setValue(n.date,!1):o.date.setValue(l[0],!1),n.value?o.value.setValue(n.value,!1):o.value.setValue(s[0],!1)},y=function(e,a,l){var i,s;i=document.createElement("tr"),e.appendChild(i),s=document.createElement("td"),i.appendChild(s),s.innerHTML=a+":",i=document.createElement("tr"),e.appendChild(i),s=document.createElement("td"),i.appendChild(s),o[l]=new javaxt.dhtml.ComboBox(s,{style:t.style.combobox,readOnly:!0}),o[l].clear(),o[l].onChange=function(e,t){n[l]=t,m()}},m=function(){if(n.date&&n.value){var e=i[0];p.update(n,e)}},g=function(){h||(h=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=h.getBody();e.innerHTML="";var a=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox}),l=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"color",label:"Color",type:a}]},{group:"Labels",items:[{name:"dayLabel",label:"Show Day",type:"checkbox",options:[{label:"",value:!0}]},{name:"yearLabel",label:"Show Year",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Graph",items:[{name:"cellSize",label:"Cell Size",type:"text"}]}]});for(var i in t.colors)t.colors.hasOwnProperty(i)&&a.add(i,JSON.stringify(t.colors[i]));if(n.colors){var o=n.colors;a.getOptions().every(function(e){var t=e.text,l=e.value;return o!=t&&JSON.stringify(o)!=l||(a.setValue(t),!1)})}else a.setValue("blue");var s=l.findField("dayLabel"),d=n.dayLabel;s.setValue(!(!0!==d));var r=l.findField("yearLabel"),p=n.yearLabel;r.setValue(!(!0!==p));var u=l.findField("cellSize"),c=n.cellSize;(isNaN(c)||1>c)&&(c=13),u.setValue(c),l.onChange=function(){var e=l.getData();e.dayLabel=!("true"!==e.dayLabel),e.yearLabel=!("true"!==e.yearLabel),n.dayLabel=e.dayLabel,n.yearLabel=e.yearLabel;var t=e.cellSize;(isNaN(t)||1>t)&&(t=13),n.cellSize=t,n.colors=JSON.parse(e.color),m()},h.showAt(108,57),l.resize()},b=javaxt.dhtml.utils.merge,f=javaxt.dhtml.utils.onRender,C=javaxt.dhtml.utils.createTable,w=bluewave.utils.createDashboardItem,x=bluewave.utils.createSlider,v=bluewave.utils.addTextEditor,k=bluewave.chart.utils.getType,L=bluewave.utils.parseData;s()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.TreeMapEditor=function(e,t){var a=this,l={panel:{},chart:{showTooltip:!0,shape:"circle"}},i=[],o={},n={},s=function(){t||(t={}),t=f(t,l),n=t.chart;let i=w(e);var o=i.addRow();a.el=i;var s;s=o.addColumn();let h=document.createElement("div");h.className="chart-editor-options",s.appendChild(h),u=h,s=o.addColumn(),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",d=x(s,{width:"100%",height:"100%",title:"Untitled",settings:!0}),r=d.innerDiv,p=new bluewave.charts.TreeMapChart(r,{}),p.onClick=function(e,t){b(p.getGroup(t.group))},d.el.className="",v(d.title,function(e){d.title.innerHTML=e,n.chartTitle=e}),d.settings.onclick=function(){n&&g()}},d,r,p,u,h;this.update=function(e){a.clear();var l={};for(var o in f(l,e.config),f(l,t.chart),n=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var s=e.inputs[o],r=L(s.data,s.config);0<r.length&&i.push(r)}n.chartTitle&&(d.title.innerHTML=n.chartTitle),c(u),m()},this.clear=function(){i=[],n={},d.title.innerHTML="Untitled",u.innerHTML="",p&&p.clear()},this.getConfig=function(){return n},this.getChart=function(){return r},this.renderChart=function(e){var t=new bluewave.charts.TreeMapChart(e,{});return t.update(n,i[0]),t};var c=function(e){var t=i[0],a=Object.keys(t[0]),l=[],s=[],d=[];a.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var i=k(a);"string"==i&&l.push(e),("number"==i||"currency"==i)&&s.push(e),"string"==i&&d.push(e)});var r=w(e);r.style.height="",y(r,"Key","key"),y(r,"Value","value"),y(r,"Group By","groupBy"),l.forEach(e=>{o.key.add(e,e)}),s.forEach(e=>{o.value.add(e,e)}),d.forEach(e=>{o.groupBy.add(e,e)}),n.key||(n.key=l[0]),o.key.setValue(n.key,!0),n.value||(n.value=s[0]),o.value.setValue(n.value,!0),n.groupBy&&o.groupBy.setValue(n.groupBy,!0)},y=function(e,a,l){var i;i=e.addRow().addColumn(),i.innerHTML=a+":",i=e.addRow().addColumn(),o[l]=new javaxt.dhtml.ComboBox(i,{style:t.style.combobox,readOnly:!0}),o[l].onChange=function(e,t){n[l]=t,m()}},m=function(){if(n.key&&n.value){var e=i[0];p.update(n,e)}},g=function(){h||(h=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=h.getBody();e.innerHTML="";var a=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});a.add("Circular","circle"),a.add("Rectangular","square"),a.setValue("circle");var l=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"shape",label:"Shape",type:a}]},{group:"Labels",items:[{name:"groupLabel",label:"Show Group",type:"checkbox",options:[{label:"",value:!0}]},{name:"keyLabel",label:"Show Key",type:"checkbox",options:[{label:"",value:!0}]},{name:"valueLabel",label:"Show Value",type:"checkbox",options:[{label:"",value:!0}]}]}]}),i=l.findField("shape"),o=n.shape;i.setValue("square"===o?"square":"circle");var s=l.findField("groupLabel"),d=n.groupLabel;s.setValue(!(!0!==d));var r=l.findField("keyLabel"),p=n.keyLabel;r.setValue(!(!0!==p));var u=l.findField("valueLabel"),c=n.valueLabel;u.setValue(!(!0!==c)),l.onChange=function(){var e=l.getData();e.groupLabel=!("true"!==e.groupLabel),e.valueLabel=!("true"!==e.valueLabel),e.keyLabel=!("true"!==e.keyLabel),n.groupLabel=e.groupLabel,n.keyLabel=e.keyLabel,n.valueLabel=e.valueLabel,n.shape=e.shape,m()},h.showAt(108,57),l.resize()},b=function(e){e&&0!=e.length},f=javaxt.dhtml.utils.merge,C=javaxt.dhtml.utils.onRender,w=javaxt.dhtml.utils.createTable,x=bluewave.utils.createDashboardItem,v=bluewave.utils.addTextEditor,k=bluewave.chart.utils.getType,L=bluewave.utils.parseData;s()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.PieEditor=function(e,t){var a=Math.round,l=this,i={panel:{},colors:bluewave.utils.getColorGradients(),chart:{pieCutout:.65,piePadding:0,pieSort:"value",pieSortDir:"descending",maximumSlices:0,labelOffset:120,showOther:!0,showTooltip:!0}},o=[],n={},s={},d=function(){t||(t={}),t=f(t,i),s=t.chart;var a=w(e),o=a.addRow(),n;l.el=a,n=o.addColumn();let d=document.createElement("div");d.className="chart-editor-options",n.appendChild(d),h=d,n=o.addColumn(),n.className="chart-editor-preview",n.style.width="100%",n.style.height="100%",r=x(n,{width:"100%",height:"100%",title:"Untitled",settings:!0}),p=r.innerDiv,r.el.className="",k(r.title,function(e){r.title.innerHTML=e,s.chartTitle=e}),r.settings.onclick=function(){s&&b()},u=new bluewave.charts.PieChart(p,{})},r,p,u,h,c;this.update=function(e){l.clear();var a={};for(var i in f(a,e.config),f(a,t.chart),s=a,e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],d=T(n.data,n.config);if(0<d.length)o.push(d);else{var p=n.config;p&&o.push(p)}}var d=o[0],u=[];if(d.hasOwnProperty("links")){d=Object.values(d.links);var c=[];for(var e in o[0].nodes){var m=o[0].nodes[e].type,b=o[0].nodes[e].name,C={};C.id=e,C.type=m,C.name=b,c.push(C)}for(var w in o[0].links){var x="",v="",k="",L=o[0].links[w].quantity;for(var E of c)w.startsWith(E.id)&&(x=E.type),w.endsWith(E.id)&&(v=E.type,k=E.name);var V=x+" to "+k,N={};N.key=V,N.value=L,N.sendType=x,N.receiveType=v;var D=u.findIndex(e=>e.key===V);-1===D?u.push(N):u[D].value+=L}d=u.slice(),d=d.filter(e=>e.key.includes(s.pieKey)),d="Inbound"===s.pieDirection?d.filter(e=>e.receiveType.endsWith(s.pieKey)):d.filter(e=>e.sendType.startsWith(s.pieKey));let t=[];d.forEach(function(e,a){let l={};e.key.includes(s.pieKey)&&(l[s.pieKey]=e.key,l[s.pieValue]=e.value),t.push(l)}),o=[t]}s.chartTitle&&(r.title.innerHTML=s.chartTitle),y(h),g()},this.clear=function(){o=[],s={},r.title.innerHTML="Untitled",h.innerHTML="",u&&u.clear()},this.getConfig=function(){return s},this.getChart=function(){return p},this.renderChart=function(e){var t=new bluewave.charts.PieChart(e,{});return t.update(s,o),t};var y=function(e){var t=o[0],a=t.hasOwnProperty("links"),l;if(a){t=Object.values(t.links);var i=[];for(var d in t.nodes){var r=t.nodes[d].type;-1===i.indexOf(r)&&i.push(r)}l=i}else l=Object.keys(t[0]);var p=[];l.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var l=L(a);("number"==l||"currency"==l)&&p.push(e)});var u=w(e);u.style.height="",a?(m(u,"pieKey","Group By","key"),m(u,"pieDirection","Direction","direction"),l.forEach(e=>{n.key.add(e,e)}),s.pieValue="quantity",n.direction.add("Inbound"),n.direction.add("Outbound"),n.direction.setValue(s.pieDirection,!0)):(m(u,"pieKey","Key","key"),l.forEach(e=>{n.key.add(e,e)}),m(u,"pieValue","Value","value"),p.forEach(e=>{n.value.add(e,e)}),m(u,"pieSort","Sort By","sort"),n.sort.add(""),n.sort.add("Key"),n.sort.add("Value"),m(u,"pieSortDir","Sort Direction","sortDir")),n.key.setValue(s.pieKey,!0),"object"==typeof n.value&&n.value.setValue(s.pieValue,!0)},m=function(e,a,l,i){var o;o=e.addRow().addColumn(),o.innerHTML=l+":",o=e.addRow().addColumn(),n[i]=new javaxt.dhtml.ComboBox(o,{style:t.style.combobox,readOnly:!0}),n[i].clear(),n[i].onChange=function(e,l){if(!("pieSort"===a)){s[a]=l;var i=n.key.getValue(),o=n.value.getValue();if(i&&o&&(i=(i+"").trim(),o=(o+"").trim(),0<i.length&&0<o.length)){var d=t.chart.pieSort;d&&n.sort.setValue(d,!0);var r=t.chart.pieSortDir;r&&n.sortDir.setValue(r,!0),g()}}else if(0<l.length){s[a]=l;var p=n.sortDir.getValue();p||(p="Ascending"),n.sortDir.clear(),n.sortDir.add("Ascending"),n.sortDir.add("Descending"),n.sortDir.setValue(p)}else delete s[a],n.sortDir.clear(),g()}},g=function(){C(p,function(){u.update(s,o)})},b=function(){c||(c=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=c.getBody();e.innerHTML="";var l=bluewave.utils.createColorField({colors:t.colors,style:t.style}),i=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"color",label:"Color",type:l},{name:"cutout",label:"Cutout",type:"text"}]},{group:"Slices",items:[{name:"padding",label:"Padding",type:"text"},{name:"maximumSlices",label:"Max Slices",type:"text"},{name:"showOther",label:"Show Other",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Labels",items:[{name:"labels",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"extendLines",label:"Extend Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"labelOffset",label:"Label Offset",type:"text"}]}]});l.setValue(JSON.stringify(s.colors)),v("cutout",i,"%");var n=a(100*s.pieCutout);i.findField("cutout").setValue(n);var d=i.findField("labels"),r=s.showLabels;d.setValue(!(!0!==r));var p=i.findField("extendLines"),h=s.extendLines;p.setValue(!(!0!==h)),v("labelOffset",i,"%",0,120,1);var y=s.labelOffset;i.findField("labelOffset").setValue(y),v("padding",i,"%",0,100,1);var m=s.piePadding,b=5;m=a(100*(m/b)),i.findField("padding").setValue(m);var f=i.findField("showOther"),C=s.showOther;f.setValue(!(!0!==C));var w=o[0].length;u&&(w=u.getNumSlices()),v("maximumSlices",i,"",1,w,1);var x=parseInt(s.maximumSlices);(isNaN(x)||1>x||x>w)&&(x=w),i.findField("maximumSlices").setValue(x),i.onChange=function(){var e=i.getData();s.pieCutout=e.cutout/100,s.piePadding=e.padding*b/100;var t=parseInt(e.maximumSlices);(isNaN(t)||1>t||t>w)&&(t=w),s.maximumSlices=t,"true"===e.labels?(e.labels=!0,i.enableField("labelOffset"),i.enableField("extendLines")):"false"===e.labels&&(e.labels=!1,i.disableField("labelOffset"),i.disableField("extendLines")),s.showLabels=e.labels,s.extendLines="true"===e.extendLines,s.labelOffset=e.labelOffset,"true"===e.showOther?e.showOther=!0:"false"===e.showOther&&(e.showOther=!1),s.showOther=e.showOther,s.colors=JSON.parse(e.color),g()},c.showAt(108,57),i.resize()},f=javaxt.dhtml.utils.merge,C=javaxt.dhtml.utils.onRender,w=javaxt.dhtml.utils.createTable,x=bluewave.utils.createDashboardItem,v=bluewave.utils.createSlider,k=bluewave.utils.addTextEditor,L=bluewave.chart.utils.getType,T=bluewave.utils.parseData;d()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.MapEditor=function(e,t){var a=this,l={panel:{},colors:bluewave.utils.getColorGradients(),chart:{style:{backgroundColor:"#fff",landColor:"#dedde0"}},data:{politicalBoundaries:"data/"}},i={},o=[],n={},s=[],d=function(){t||(t={}),t=G(t,l),i=t.chart;let o=W(e);var n=o.addRow();a.el=o;var s;s=n.addColumn();let d=document.createElement("div");d.className="chart-editor-options",s.appendChild(d),b(d,"mapType","Map Type",f),b(d,"mapLevel","Map Level",f),b(d,"pointData","Point Data",f),b(d,"latitude","Latitude",C,"lat"),b(d,"longitude","Longitude",C,"long"),b(d,"mapLocation","Location Data",C),b(d,"mapValue","Value",C),b(d,"mapProjectionName","Projection",C),s=n.addColumn(),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",r=q(s,{width:"100%",height:"100%",title:"Untitled",settings:!0}),r.el.className="",p=r.innerDiv,u=new bluewave.charts.MapChart(p,i),u.disablePan(),j(r.title,function(e){r.title.innerHTML=e,i.chartTitle=e}),r.settings.onclick=function(){i&&w(i.mapType,i.mapLevel)}},r,p,u,h,c,y,m,g;this.clear=function(){if(o=[],i={},r.title.innerHTML="Untitled",n)for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];t&&(t.clear&&t.clear(),t.hide&&t.hide())}u&&u.clear()},this.update=function(e){a.clear();var l={};for(var s in G(l,e.config),G(l,t.chart),i=l,e.inputs)if(e.inputs.hasOwnProperty(s)){var d=e.inputs[s],p=K(d.data,d.config);if(0<p.length)o.push(p);else{var u=d.config;u&&o.push(u)}}i.chartTitle&&(r.title.innerHTML=i.chartTitle),i.mapLevel=x(i);var p=o[0];if(U(p)){var h=[],c=[];Object.keys(p[0]).forEach(e=>{var t=[];p.forEach(a=>{var l=a[e];t.push(l)});var a=X(t);"string"==a&&c.push(e),"number"==a&&h.push(e)}),h.forEach(e=>{n.lat.add(e,e),n.long.add(e,e),n.mapValue.add(e,e)}),c.forEach(e=>{n.mapLocation.add(e,e)}),n.mapType.add("Point","Point"),n.mapType.add("Area","Area"),n.pointData.add("Geographic Coordinates","geoCoords"),n.pointData.add("Admin Area","adminArea"),n.mapLevel.add("States","counties"),n.mapLevel.add("Country","states"),n.mapLevel.add("World","world")}else i.mapType="Links",i.mapValue="quantity",i.mapLevel="world",n.mapType.add("Links","Links"),n.mapValue.add("quantity","quantity"),n.mapLevel.add("Country","states"),n.mapLevel.add("World","world");n.mapType.show(),n.mapLevel.show(),n.mapValue.show(),"Point"===i.mapType&&(n.pointData.show(),"geoCoords"===i.pointData&&i.latitude&&i.longitude&&(n.lat.show(),n.long.show())),n.mapType.setValue(i.mapType,!1),n.mapLevel.setValue(i.mapLevel,!0),n.mapValue.setValue(i.mapValue,!0),n.pointData.setValue(i.pointData,!0),n.lat.setValue(i.latitude,!0),n.long.setValue(i.longitude,!0),C()},this.resize=function(){u&&u.resize()};var b=function(e,a,l,o,s){s||(s=a);var d=document.createElement("div");e.appendChild(d),_(d);var r=document.createElement("label");r.innerText=l+":",d.appendChild(r);var p=new javaxt.dhtml.ComboBox(d,{style:t.style.combobox,readOnly:!0});p.onChange=function(e,t){i[a]=t;var l=[];o===f&&(l=[s,e,t]),o.apply(p,l)};var u=p.show;p.show=function(){u(),d.show()};var h=p.hide;p.hide=function(){h(),d.hide()},p.hide(),n[s]=p},f=function(e,t,a){"mapType"===e?"Point"===a?(n.mapLocation.hide(),n.mapValue.show(),n.pointData.show()):"Area"==a&&(n.lat.hide(),n.long.hide(),n.mapLocation.show(),n.mapValue.show(),n.pointData.hide()):"pointData"===e?"geoCoords"===a?(n.lat.show(),n.long.show(),n.mapLocation.hide()):"adminArea"==a&&(n.lat.hide(),n.long.hide(),n.mapLocation.show()):"mapLevel"==e&&(delete i.lon,delete i.lat,C())},C=function(e){i.mapType&&i.mapLevel&&("Point"!==i.mapType||null!==i.pointData)&&("Point"!==i.mapType||"geoCoords"!==i.pointData||null!==i.latitude&&null!==i.longitude&&null!==i.mapValue)&&("Point"!==i.mapType||"adminArea"!==i.pointData||null!==i.mapLocation&&null!==i.mapValue)&&("Area"!==i.mapType||null!==i.mapValue&&null!==i.mapLocation)&&("Links"!==i.mapType||null!=i.mapValue&&null!==i.mapLocation)&&A(()=>{e instanceof bluewave.charts.MapChart||(e=u),L(e,o[0])})};this.getConfig=function(){return i},this.getChart=function(){return p},this.renderChart=function(e){var t=new bluewave.charts.MapChart(e,i);return C(t),t};var w=function(e,a){h||(h=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var l=h.getBody(),o;l.innerHTML="";var n={group:"Map Colors",items:[{name:"backgroundColor",label:"Background",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"landColor",label:"Land",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})}]},s={group:"Map Center",items:[{name:"centerHorizontal",label:"Longitude",type:"text"},{name:"centerVertical",label:"Latitude",type:"text"}]};if("Point"===e){var d=[{group:"Point Style",items:[{name:"color",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"radius",label:"Radius",type:"text"},{name:"opacity",label:"Opacity",type:"text"},{name:"outlineWidth",label:"Border Width",type:"text"},{name:"outlineColor",label:"Border Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})}]},n];"states"!==a&&"world"!==a,o=new javaxt.dhtml.Form(l,{style:t.style.form,items:d}),k("color",o),k("backgroundColor",o),k("landColor",o);var r=i.pointColor||"#ff3c38";o.findField("color").setValue(r),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor),k("outlineColor",o),o.findField("outlineColor").setValue(i.outlineColor||r),Y("radius",o,"px",1,20,1);var p=i.pointRadius;null==p&&(p=3),i.pointRadius=p,o.findField("radius").setValue(p),Y("opacity",o,"%");var u=i.opacity;null==u&&(u=100),i.opacity=u,o.findField("opacity").setValue(u),Y("outlineWidth",o,"px",0,20,1);var c=i.outlineWidth;if(null==c&&(c=0),i.outlineWidth=c,o.findField("outlineWidth").setValue(c),"states"===a||"world"===a){var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.pointColor=e.color,i.outlineColor=e.outlineColor,i.pointRadius=e.radius,i.opacity=e.opacity,i.outlineWidth=e.outlineWidth,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.lon=e.centerHorizontal,i.lat=e.centerVertical,C()}}else o.onChange=function(){var e=o.getData();i.pointColor=e.color,i.outlineColor=e.outlineColor,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.pointRadius=e.radius,i.outlineWidth=e.outlineWidth,i.opacity=e.opacity,C()}}else if("Area"===e){if("states"===a||"world"===a){o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"fillColors",label:"Color",type:v()}]},n]}),k("backgroundColor",o),k("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor);var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.fillColors=JSON.parse(e.fillColors),i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.lon=e.centerHorizontal,i.lat=e.centerVertical,C()}}else"counties"===a&&(o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"fillColors",label:"Color",type:v()}]},n]}),k("backgroundColor",o),k("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor),o.onChange=function(){var e=o.getData();i.fillColors=JSON.parse(e.fillColors),i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,C()});}else if("Links"===e&&("states"===a||"world"===a)){o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[n]}),k("backgroundColor",o),k("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor);var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.lon=e.centerHorizontal,i.lat=e.centerVertical,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,C()}}o&&(h.showAt(108,57),o.resize())},x=function(e){if(!e.mapLevel)return null;var t=e.mapLevel.toLowerCase();return-1<t.indexOf("census")?"states":-1<t.indexOf("states")?"states":-1<t.indexOf("counties")?"counties":-1<t.indexOf("countries")||-1<t.indexOf("world")?"world":t},v=function(){var e=bluewave.utils.createColorField({colors:t.colors,style:t.style}),a=R();return e.setValue(JSON.stringify(a)),e},k=function(e,a){bluewave.utils.createColorOptions(e,a,function(a){c||(c=bluewave.utils.createColorPickerCallout({style:t.style}));var l;l="backgroundColor"===e?["#fff","#e5ecf4"]:"landColor"===e?["#f6f8f5","#dedde0"]:bluewave.utils.getColorPalette(!0),c.setColors(l),c.setColor(a.getValue());var i=javaxt.dhtml.utils.getRect(a.row),o=i.x+i.width+15,n=i.y+i.height/2;c.showAt(o,n,"right","middle"),c.onChange=function(e){a.setValue(e)}})},L=function(e,t){e.clear();var a=i.style.backgroundColor;a||(a="white"),e.setBackgroundColor(a);var l=z(),o=d3.extent(t,function(e){return parseFloat(e[i.mapValue])}),n;"Area"===i.mapType&&(n=R());var s=i.mapLevel;if("counties"===s){if(e.setProjection("AlbersUsa"),"Point"===i.mapType){O(),F();var d={};"geoCoords"===i.pointData?d=E(t,i):"adminArea"===i.pointData&&(d=V(t,m)),N(d,i,o)}else if("Area"===i.mapType){var r=D(t,i);"counties"===r?(O(t,n,l),F()):"states"===r?F(t,n,l):"censusDivisions"===r?S(t,n,l):(O(),F())}}else if("states"===s){if(e.setProjection("Albers"),e.setExtent([-130,40.5],[-65,25.8]),B(),"Point"===i.mapType){F();var d={};"geoCoords"===i.pointData?d=E(t,i):"adminArea"===i.pointData&&(d=V(t,m)),N(d,i,o)}else if("Area"===i.mapType){var r=D(t,i);"counties"===r?(O(t,n,l),F()):"states"===r?F(t,n,l):"censusDivisions"===r?S(t,n,l):F()}else"Links"===i.mapType&&H("PortsOfEntry",function(a){e.clear(),B(),T(t,a)});}else if("world"===s)if(e.setProjection("Mercator"),e.setExtent([-170,76],[170,-76]),"Point"===i.mapType){B();var d={};"geoCoords"===i.pointData?d=E(t,i):"adminArea"===i.pointData&&(d=V(t,g)),N(d,i,o)}else if("Area"===i.mapType){var p=new I(t,n);e.addPolygons(g.features,{name:"countries",style:{fill:function(e){return p.getColor(e.properties.code,l)},stroke:"white"},showTooltip:!0,getTooltipLabel:function(e){var t=e.properties.name,a=p.getValue(e.properties.code);return isNaN(a)&&(a="No data"),t+": "+a}})}else"Links"===i.mapType&&H("PortsOfEntry",function(a){e.clear(),B(),T(t,a)});e.update()},T=function(e,t){var a=d3.scaleOrdinal(bluewave.utils.getColorPalette(!0)),l=[],o=[],n={},s=function(e,t){for(var a=0,l;a<t.features.length;a++)if(l=t.features[a].properties,e===l.code)return[l.longitude,l.latitude]};for(var d in e.links)if(e.links.hasOwnProperty(d)){var r=d.split("->"),p=e.nodes[r[0]],h=e.nodes[r[1]],c=e.links[d].quantity;if("US"===p.country?l.push(s(p.state,m)):l.push(s(p.country,g)),"US"!==p.country&&"US"===h.country)for(var y=0,b;y<t.length;y++)if(b=t[y],p.country===t[y].iso2){l.push([b.exlongitude,b.exlatitude]),l.push([b.imlongitude,b.imlatitude]);break}"US"===h.country?l.push(s(h.state,m)):l.push(s(h.country,g)),o.push(c),n[p.country]=!0,n[h.country]=!0}n.US?(n=Object.keys(n),1===n.length&&"US"===n[0]?u.setExtent([-130,50.5],[-65,25.8]):u.setExtent([60,74],[59,-58])):u.setExtent([-170,76],[170,-76]),u.addLines([l],{name:"links",style:{color:"steelblue",opacity:.5,width:3}}),u.addPoints(l,{name:"nodes",style:{fill:"#FF0000",opacity:.5,radius:4}}),u.update()},E=function(e,t){var a=[],l=!1;return e.forEach(function(e){var i=parseFloat(e[t.latitude]),o=parseFloat(e[t.longitude]);if(!(isNaN(i)||isNaN(o))){var n=[o,i];if(n&&!(isNaN(n[0])||isNaN(n[1]))){var s=parseFloat(e[t.mapValue]);isNaN(s)||(n.push(s),l=!0),a.push(n)}}}),{coords:a,hasValue:l}},V=function(e,t){var a=[],l=!1;return e.forEach(function(e){var o=e[i.mapLocation];t.features.every(function(t){var n=t.properties;if(o===n.code){var s;if(s=isNaN(n.latitude)||isNaN(n.longitude)?u.getCentroid(t):[n.longitude,n.latitude],s&&(isNaN(s[0])||isNaN(s[0])?s=null:a.push(s)),s&&i.mapValue){var d=parseFloat(e[i.mapValue]);isNaN(d)||(l=!0,s.push(d))}return!1}return!0})}),{coords:a,hasValue:l}},N=function(e,t,a){var l=t.opacity;l?l/=100:l=1;var i=parseInt(t.pointRadius);isNaN(i)&&(i=3),0>i&&(i=1);var o=t.pointColor||"#ff3c38",n=t.outlineColor;n||(n=o);var s=parseFloat(t.outlineWidth);(isNaN(s)||0>s)&&(s=0),s>i&&(s=i),u.addPoints(e.coords,{name:"points",style:{fill:o,opacity:l,radius:function(t){if(e.hasValue){var l=t[2];if(isNaN(l)||0>=l)return i;var o=l/a[1],n=i;return 0<o?n*o:.25*n}return i},outlineWidth:s,outlineColor:n}})},D=function(e,t){var a=0,l=0,i=0;e.forEach(function(e){var o=e[t.mapLocation];if("undefined"!=typeof o){var n=M(e[t.mapLocation]);y.features.every(function(e){return e.id!==o||(l++,!1)}),m.features.every(function(e){var t=!1;return(e.properties.name===o||e.properties.code===o)&&(a++,t=!0),isNaN(n)||e.properties.censusDivision!==n||(i++,t=!0),!t})}});var o=Math.max(a,l,i);if(0<o){if(o===l)return"counties";if(o===a)return"states";if(o===i)return"censusDivisions"}return null},O=function(e,t,a){a||(a=z());var l;e&&t&&(l=new I(e,t)),u.addPolygons(y.features,{name:"counties",style:{fill:function(e){return l?l.getColor(e.id,a):a},stroke:"white"},showTooltip:!!l,getTooltipLabel:function(e){var t=e.id,a=l.getValue(e.id);return isNaN(a)&&(a="No data"),t+": "+a}})},F=function(e,t,a){a||(a=z());var l;e&&t&&(l=new I(e,t)),u.addPolygons(m.features,{name:"states",style:{fill:function(e){if(l){var t=e.properties.name,i=l.getValue(t);return isNaN(i)&&(t=e.properties.code,i=l.getValue(t)),l.getColor(t,a)}return a},stroke:"white"},showTooltip:!!l,getTooltipLabel:function(e){var t=e.properties.name,a=l.getValue(e.properties.name);return isNaN(a)&&(a="No data"),t+": "+a}})},S=function(e,t,a){a||(a=z());var l;e&&t&&(l=new I(e,t));var o={};e.forEach(function(e){var t=M(e[i.mapLocation]);isNaN(t)||(o[t+""]=e[i.mapValue])}),u.addPolygons(m.features,{name:"censusRegions",style:{fill:function(e){var t=parseFloat(o[e.properties.censusDivision+""]);(isNaN(t)||0>t)&&(t=0);var a=colorScale[i.colorScale](t);return a?a:"none"},stroke:"white"},showTooltip:!!l})},B=function(){u.addPolygons(g.features,{name:"countries",style:{fill:i.landColor,stroke:"white"}})},M=function(e){if("undefined"==typeof e)return null;var t=parseInt(t);return isNaN(t)?(e=e.toLowerCase(),-1<e.indexOf("new england")?1:-1<e.indexOf("middle atlantic")||-1<e.indexOf("mid atlantic")?2:-1<e.indexOf("east north central")?3:-1<e.indexOf("west north central")?4:-1<e.indexOf("south atlantic")?5:-1<e.indexOf("east south central")?6:-1<e.indexOf("west south central")?7:-1<e.indexOf("mountain")?8:-1<e.indexOf("pacific")?9:null):t},A=function(e){var a=t.data.politicalBoundaries;bluewave.utils.getMapData(a,function(t){y=t.counties,m=t.states,g=t.countries,e()})},H=function(e,t){bluewave.data||(bluewave.data={}),bluewave.data[e]?t.apply(this,[bluewave.data[e]]):bluewave.utils.getData(e,t)},P=function(e,t,a){for(var l=0;l<a.length-1;l++){var o=a[l],n=a[l+1],s=t[l];if(e>=o&&e<n)return s;if(e==a[a.length-1])return t[t.length-1]}},R=function(){var e=i.fillColors;if(!e&&t.colors&&(e=t.colors.red,!e))for(var a in t.colors)if(t.colors.hasOwnProperty(a)){e=t.colors[a];break}return e},z=function(){var e=i.style.landColor;return e||(e="lightgray"),e},I=function(e,t){var a=this,l={};e.forEach(function(e){var t=e[i.mapLocation],a=bluewave.chart.utils.parseFloat(e[i.mapValue]);isNaN(a)||(l[t]=a)});var o=7,n=Q(Object.values(l),7),s=chroma.scale(t),d=s.colors(n.length-1).reverse();this.getColor=function(e,t){var l=a.getValue(e);return isNaN(l)?t:P(l,d,n)},this.getValue=function(e){return l[e]}},G=javaxt.dhtml.utils.merge,W=javaxt.dhtml.utils.createTable,U=javaxt.dhtml.utils.isArray,_=javaxt.dhtml.utils.addShowHide,q=bluewave.utils.createDashboardItem,j=bluewave.utils.addTextEditor,Y=bluewave.utils.createSlider,X=bluewave.chart.utils.getType,K=bluewave.utils.parseData,Q=bluewave.chart.utils.getNaturalBreaks;d()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.BarEditor=function(e,t){var a=this,l={panel:{},chart:{showTooltip:!0}},o=[],s={},d={},r=function(){t||(t={}),t=L(t,l),d=t.chart;let i=E(),o=i.firstChild;var n=document.createElement("tr");o.appendChild(n),e.appendChild(i),a.el=i;var s;s=document.createElement("td"),s.style.height="100%",n.appendChild(s);var r=document.createElement("div");r.className="chart-editor-options",r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",r.style.overflowY="auto",s.appendChild(r),c=document.createElement("div"),c.style.position="absolute",r.appendChild(c),s=document.createElement("td"),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",n.appendChild(s);var r=document.createElement("div");r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",s.appendChild(r),p=V(r,{width:"100%",height:"100%",title:"Untitled",settings:!0}),u=p.innerDiv,p.el.className="",p.el.style.position="absolute",D(p.title,function(e){p.title.innerHTML=e,d.chartTitle=e}),p.settings.onclick=function(){x()},h=new bluewave.charts.BarChart(u,{}),h.onClick=function(e,t){v(t)}},p,u,h,c,m;this.update=function(e){a.clear();var l={};for(var i in L(l,e.config),L(l,t.chart),d=l,e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],s=S(n.data,n.config);0<s.length&&o.push(s)}d.chartTitle&&(p.title.innerHTML=d.chartTitle),b(c),g()},this.clear=function(){o=[],d={},s={},p.title.innerHTML="Untitled",c.innerHTML="",h&&h.clear(),m&&m.hide()},this.getConfig=function(){let e=Object.assign({},d);return e},this.getChart=function(){return u},this.renderChart=function(e){var t=new bluewave.charts.BarChart(e,{});return t.update(d,o),t};var g=function(){for(let t=0;t<o.length;t++){var e=0<t?t+1:"";let a=`xAxis${e}`,l=`yAxis${e}`,i=`group${e}`;s[i].add("","");let n=Object.keys(o[t][0]);n.forEach(e=>{s[a].add(e,e),s[l].add(e,e),s[i].add(e,e)}),s[a].setValue(d[a],!0),s[l].setValue(d[l],!0),d[i]&&s[i].setValue(d[i],!0)}w()},b=function(e){for(var a=[],l=0,r;l<o.length;l++)r=0<l?l+1:"",a.push({group:"Series "+(0<l?r:1),items:[f("X-Axis"),C(`xAxis${r}`,s),f("Y-Axis"),C(`yAxis${r}`,s),f("Separate By"),C(`group${r}`,s)]});var p=document.createElement("div");p.style.height="100%",p.style.zIndex=1,e.appendChild(p);var u=new javaxt.dhtml.Form(p,{style:t.style.form,items:a});u.onChange=function(e,t){var a=e.name;d[a]=t,w()}},f=function(e){var t=document.createElement("div");return t.className="form-label",t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},C=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},w=function(){T(u,function(){h.update(d,o)})},x=function(){var e=O(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});l.add("Vertical","vertical"),l.add("Horizontal","horizontal"),l.setValue("vertical");var i=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"layout",label:"Chart Layout",type:l},{name:"stackValues",label:"Stack Bars",type:"checkbox",options:[{label:"",value:!0,checked:!1}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]}]}),o=i.findField("layout"),n=d.layout;o.setValue("horizontal"===n?"horizontal":"vertical");var s=i.findField("xGrid"),r=d.xGrid;s.setValue(!(!0!==r));var p=i.findField("yGrid"),u=d.yGrid;p.setValue(!(!0!==u));var h=i.findField("xLabel"),c=d.xLabel;h.setValue(!(!0!==c));var y=i.findField("yLabel"),m=d.yLabel;y.setValue(!(!0!==m));var g=i.findField("stackValues"),b=d.stackValues;g.setValue(!(!0!==b)),i.onChange=function(){var e=i.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel=!("true"!==e.xLabel),e.yLabel=!("true"!==e.yLabel),e.stackValues=!("true"!==e.stackValues),d.layout=e.layout,d.xGrid=e.xGrid,d.yGrid=e.yGrid,d.xLabel=e.xLabel,d.yLabel=e.yLabel,d.stackValues=e.stackValues;var t=d.animationSteps;d.animationSteps=0,w(),d.animationSteps=t},e.showAt(108,57),i.resize()},v=function(e){var a=O(t),l=a.getBody();l.innerHTML="";var i=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"barColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"fillOpacity",label:"Opacity",type:"text"}]}]});k("barColor",i),N("fillOpacity",i,"%");var o=d.fillOpacity;if(isNaN(o)&&(o=1),d.fillOpacity=o,i.findField("fillOpacity").setValue(100*o),null!==e&&void 0!==e){let t=`${e}`;d["barColor"+t]||(d["barColor"+t]="#6699CC"),isNaN(d["fillOpacity"+t])&&(d["fillOpacity"+t]=1),i.findField("barColor").setValue(d["barColor"+t]),i.findField("fillOpacity").setValue(100*d["fillOpacity"+t]),i.onChange=function(){let e=i.getData();d["barColor"+t]=e.barColor,d["fillOpacity"+t]=e.fillOpacity,w()}}a.showAt(108,57),i.resize()},k=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){m||(m=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;m.showAt(l,i,"right","middle"),m.setColor(e.getValue()),m.onChange=function(t){e.setValue(t)}})},L=javaxt.dhtml.utils.merge,T=javaxt.dhtml.utils.onRender,E=javaxt.dhtml.utils.createTable,V=bluewave.utils.createDashboardItem,N=bluewave.utils.createSlider,D=bluewave.utils.addTextEditor,O=bluewave.utils.getStyleEditor,F=bluewave.chart.utils.getType,S=bluewave.utils.parseData;r()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.CsvEditor=function(e,t){var a=this,l={panel:{},data:{hasHeader:!1,sheetName:null}},o=[],n=function(){t||(t={}),t=m(t,l);var i=b(e);u(i.addRow().addColumn()),r=i.addRow().addColumn(),r.style.height="100%",r.className="grid-container-"+new Date().getTime(),h(i.addRow().addColumn()),a.el=i},s,d,r,p;this.clear=function(){o=[],p=null,r.innerHTML="",s.clear(),s.hide(),d.setValue(!1)},this.update=function(n){a.clear();var r={};m(r,n.config),m(r,l.data),t.data=r;var p=!0;if(t.data.hasHeader&&d.setValue(!0,!0),!g(o[0]))for(var u=0,e;u<o.length;u++)e=o[u].name,s.add(e,e);if(t.data.sheetName&&s.setValue(t.data.sheetName,!0),!n.data&&n.file){var h=n.file,y=h.name.toLowerCase(),b=y.lastIndexOf(".");if(-1<b){var f=y.substring(b+1);if("csv"===f||"tab"===f||"tsv"===f){var x=new FileReader;x.onload=function(e){return function(t){var e=t.target.result;o=C(e,{separator:"csv"===f?",":"\t"}),n.data=o,c()}}(h),x.readAsText(h)}else if("xls"===f||"xlsx"===f){var x=new FileReader;x.onload=function(e){return function(t){var e=t.target.result;o=w(e),n.data=o,o.forEach(e=>{s.add(e.name,e.name)}),s.show()}}(h),x.readAsArrayBuffer(h)}else;}}else o=n.data,c()},this.getConfig=function(){return t.data};var u=function(e){var a=document.createElement("div");a.className="panel-toolbar",e.appendChild(a);var l=b(a).addRow(),i;i=l.addColumn(),i.style.width="100%",s=new javaxt.dhtml.ComboBox(i,{style:t.style.combobox,readOnly:!0}),s.onChange=function(e){t.data.hasHeader=!1,t.data.sheetName=e,c()},i=l.addColumn();var a=document.createElement("div");a.style.width="135px",i.appendChild(a);var o=document.createElement("div");o.innerText="Has Header",o.className="toolbar-button-label",o.style.float="left",o.style.padding="0 5px 0 8px",o.style.lineHeight="24px",a.appendChild(o);var n=document.createElement("div");n.style.float="left",a.appendChild(n),d=new javaxt.dhtml.Switch(n),d.setValue(!1),d.onChange=function(){t.data.hasHeader=d.getValue(),c()}},h=function(e){var t=document.createElement("div");t.style.float="right",t.style.width="175px",t.style.padding="0px 16px 8px 0px",e.appendChild(t);var a=document.createElement("input");t.appendChild(a),a.type="range",a.className="dashboard-slider";var l=8,i=14;a.setAttribute("min",9),a.setAttribute("max",i+1),a.onchange=function(){var e=this.value-1;y(e)}},c=function(){if((p=null,r.innerHTML="",!!o)&&0!==o.length){var e=t.data.hasHeader;if(!g(o[0])){var a=t.data.sheetName;if(a)for(var l=0;l<o.length;l++)if(o[l].name===a){var n=o[l];p=f(n.getData(),e,r,t);break}}else p=f(o,e,r,t)}},y=function(e){for(var t="."+r.className,a=document.getElementsByTagName("style"),l=0,o;l<a.length;l++)for(var n=a[l].sheet,s=n.cssRules,d=0,p;d<s.length;d++)if(p=s[d],p.selectorText&&p.selectorText.indexOf(0===t)){n.deleteRule(d),o=a[l];break}o||(o=document.createElement("style"),o.appendChild(document.createTextNode("")),document.head.appendChild(o)),o.sheet.insertRule(t+" .table-header-col, "+t+" .table-col {height: "+2.5*e+"px;line-height: "+2.5*e+"px;font-size: "+e+"px;}",0)},m=javaxt.dhtml.utils.merge,g=javaxt.dhtml.utils.isArray,b=javaxt.dhtml.utils.createTable,f=bluewave.utils.createGrid,C=bluewave.utils.parseCSV,w=bluewave.utils.parseXLS;n()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.LineEditor=function(e,t){var a=this,l={panel:{},chart:{}},o=[],s={},d={layers:[]},r=[],p=function(){t||(t={}),t=T(t,l);let i=V(),o=i.firstChild;var n=document.createElement("tr");o.appendChild(n),e.appendChild(i),a.el=i;var s;s=document.createElement("td"),s.style.height="100%",n.appendChild(s);var p=document.createElement("div");p.className="chart-editor-options",p.style.height="100%",p.style.position="relative",p.style.overflow="hidden",p.style.overflowY="auto",s.appendChild(p),m=document.createElement("div"),m.style.position="absolute",p.appendChild(m),s=document.createElement("td"),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",n.appendChild(s);var p=document.createElement("div");p.style.height="100%",p.style.position="relative",p.style.overflow="hidden",s.appendChild(p),u=N(p,{width:"100%",height:"100%",title:"Untitled",settings:!0}),h=u.innerDiv,u.el.className="",u.el.style.position="absolute",O(u.title,function(e){u.title.innerHTML=e,d.chartTitle=e}),u.settings.onclick=function(){v()},c=new bluewave.charts.LineChart(h,{}),c.onClick=function(e,t){var a=c.getLayers()[t+""].line,l=r[t].layer;k(a,l)}},u,h,c,y,m,g;this.update=function(e){a.clear();var l={};for(var n in T(l,e.config),T(l,t.chart),d=l,e.inputs)if(e.inputs.hasOwnProperty(n)){var s=e.inputs[n],r=B(s.data,s.config);0<r.length&&o.push(r)}var p=function(){d.layers.push({line:{fill:{},point:{}}})};if(!d.layers){d.layers=[];for(var h=0;h<o.length;h++)p()}else if(d.layers.length<o.length)for(var c=o.length-d.layers.length,h=c;h<o.length;h++)p();d.chartTitle&&(u.title.innerHTML=d.chartTitle),f(m),b()},this.clear=function(){o=[],r=[],d={},s={},u.title.innerHTML="Untitled",m.innerHTML="",c&&c.clear(),y&&y.clear(),g&&g.hide()},this.getConfig=function(){return d},this.getChart=function(){return h},this.renderChart=function(e){var t=new bluewave.charts.LineChart(e,{});return x(t),t};var b=function(){for(let a=0;a<o.length;a++){var e=0<a?a+1:"";let l=`xAxis${e}`,i=`yAxis${e}`,n=`group${e}`,r=`label${e}`;s[n].add("","");let p=Object.keys(o[a][0]);if(p.forEach(e=>{s[l].add(e,e),s[i].add(e,e),s[n].add(e,e)}),s[l].setValue(d.layers[a].xAxis,!0),s[i].setValue(d.layers[a].yAxis,!0),d.layers[a].group)s[n].setValue(d.layers[a].group,!1);else{var t=d.layers[a].line.label;t||(t="Series "+(a+1)),s[r].setValue(t,!0)}}x(c)},f=function(e){for(var a=[],l=0,r;l<o.length;l++)r=0<l?l+1:"",a.push({group:"Series "+(l+1),items:[C("X-Axis"),w(`xAxis${r}`,s),C("Y-Axis"),w(`yAxis${r}`,s),C("Separate By"),w(`group${r}`,s),C("Name"),{name:`label${r}`,label:"",type:"text"}]});var p=document.createElement("div");p.style.height="100%",p.style.zIndex=1,e.appendChild(p);for(var u=new javaxt.dhtml.Form(p,{style:t.style.form,items:a}),h=u.getGroups(),l=0;l<o.length;l++){var y=0<l?l+1:"",m="label"+y;s[m]=u.findField(m)}u.onChange=function(e,t){var a=!1,l;h.every(function(t){return t.getRows().every(function(i){if(i===e.row){a=!0;var o=t.name,n=parseInt(o.substring(o.lastIndexOf(" ")));l=n-1}return!a}),!a});var i=d.layers[l],o=e.name;["xAxis","yAxis","group","label"].forEach(function(e){var a=o.indexOf(e);o.includes(e)&&("label"==e?i.line.label=t:i[e]=t)});var o=e.name,n=o.indexOf("group");if(-1<n){var s=o.substring(5),r=u.findField("label"+s),p=r.row.previousSibling;r.hide||(E(r.row),E(p)),t?(r.row.hide(),p.hide()):(r.row.show(),p.show()),u.resize()}x(c)}},C=function(e){var t=document.createElement("div");return t.className="form-label",t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},w=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},x=function(e){e.clear(),e.setConfig(d);var t=bluewave.utils.getColorPalette(!0),a=function(t,a,l,i,o){e.addLine(t,a,l,i),r.push({layer:o})},l=d.layers;o.forEach(function(e,o){let i=l[o];if(i.xAxis&&i.yAxis)if(i.group){var n=[],s=d3.group(e,e=>e[i.group]);for(const e of s.keys())n.push({key:e,values:s.get(e)});var r=n.map(function(e){return e.key});n.forEach(function(e,l){var n=e.values;let s=new bluewave.chart.Line;s.setColor(t[l%t.length]),s.setLabel(r[l]),a(s,n,i.xAxis,i.yAxis,o)})}else{i.line||(i.line={});var p=i.line.color;p||(p=t[o%t.length],i.line.color=p);let l=new bluewave.chart.Line(i.line);a(l,e,i.xAxis,i.yAxis,o)}}),e.update()},v=function(){var e=F(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});l.add("Linear","linear"),l.add("Logarithmic","logarithmic"),l.setValue("linear");var i=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!1}),n=[],s=d.layers;o.forEach(function(e,t){let a=s[t];a.xAxis&&e.forEach(e=>{n.push(e[a.xAxis])})});var r=S(n);if("number"==r||"currency"==r){var p=Number.MAX_VALUE,u=0;n.forEach(e=>{var t=bluewave.chart.utils.parseFloat(e);p=Math.min(t,p),u=Math.max(t,u)}),i.add("0",0),0!=p&&i.add(p+"",p),i.setValue(0)}var h=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"scaleOptions",label:"Scaling Options",type:l},{name:"endTags",label:"Display End Tags",type:"checkbox",options:[{label:"",value:!0,checked:!0}]},{name:"accumulate",label:"Accumulate Values",type:"checkbox",options:[{label:"",value:!0,checked:!1}]},{name:"stack",label:"Stack Lines",type:"checkbox",options:[{label:"",value:!0,checked:!1}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"xMin",label:"Min Value",type:i},{name:"xTicks",label:"Ticks",type:"text"}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]}]}),y=h.findField("xGrid"),m=d.xGrid;y.setValue(!(!0!==m));var g=h.findField("yGrid"),b=d.yGrid;g.setValue(!(!0!==b));var f=h.findField("xLabel"),C=d.xLabel;f.setValue(!!C);var w=h.findField("yLabel"),v=d.yLabel;w.setValue(!!v);var k=h.findField("endTags"),L=d.endTags;k.setValue(!(!0!==L));var T=h.findField("stack"),E=d.stackValues;T.setValue(!(!0!==E));var V=h.findField("accumulate"),N=d.accumulateValues;V.setValue(!(!0!==N));var O=h.findField("scaleOptions"),B=d.scaling;O.setValue("logarithmic"===B?"logarithmic":"linear"),D("xTicks",h,"",0,50,1);var M=d.xTicks;isNaN(M)&&(M=10),h.findField("xTicks").setValue(M),h.onChange=function(){var e=h.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel=!!e.xLabel,e.yLabel=!!e.yLabel,e.endTags=!("true"!==e.endTags),e.stack=!("true"!==e.stack),e.accumulate=!("true"!==e.accumulate),d.scaling=e.scaleOptions,d.xGrid=e.xGrid,d.yGrid=e.yGrid,d.xLabel=e.xLabel,d.yLabel=e.yLabel,d.endTags=e.endTags,d.stackValues=e.stack,d.accumulateValues=e.accumulate,d.xLabel&&(d.xLabel=d.layers[0].xAxis),d.yLabel&&(d.yLabel=d.layers[0].yAxis),d.xTicks=e.xTicks;var t=bluewave.chart.utils.parseFloat(i.getText());isNaN(t)||(d.xMin=t),x(c)},e.showAt(108,57),h.resize()},k=function(e,a){var l=F(t),i=l.getBody();i.innerHTML="";var o=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});o.add("Solid","solid"),o.add("Dashed","dashed"),o.add("Dotted","dotted"),o.setValue("solid");var n=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});n.add("None","none"),n.add("Simple Spline","spline"),n.add("Moving Average","movingAverage"),n.add("Kernel Density Estimation","kde"),n.setValue("none");var s=new javaxt.dhtml.Form(i,{style:t.style.form,items:[{group:"Stroke",items:[{name:"lineStyle",label:"Type",type:o},{name:"lineColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"lineThickness",label:"Thickness",type:"text"},{name:"lineOpacity",label:"Opacity",type:"text"}]},{group:"Points",items:[{name:"pointColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"pointRadius",label:"Radius",type:"text"}]},{group:"Fill",items:[{name:"startOpacity",label:"Start Opacity",type:"text"},{name:"endOpacity",label:"End Opacity",type:"text"}]},{group:"Smoothing",items:[{name:"smoothingType",label:"Type",type:n},{name:"smoothingValue",label:"Factor",type:"text"}]}]});L("lineColor",s),L("pointColor",s);var r=e.getConfig();D("lineThickness",s,"px",1,10,1);var p=r.width;isNaN(p)&&(p=1),s.findField("lineThickness").setValue(p),D("lineOpacity",s,"%");var u=r.opacity;isNaN(u)&&(u=1),s.findField("lineOpacity").setValue(100*u),D("startOpacity",s,"%");var h=r.fill.startOpacity;isNaN(h)&&(h=0),s.findField("startOpacity").setValue(100*h),D("endOpacity",s,"%");var y=r.fill.endOpacity;isNaN(y)&&(y=0),s.findField("endOpacity").setValue(100*y),D("pointRadius",s,"px",0,10,1);var m=r.point.radius;isNaN(m)&&(m=0),s.findField("pointRadius").setValue(m);var g=s.findField("smoothingValue"),b=D("smoothingValue",s,"",0,100,1),f=r.smoothingValue;isNaN(f)&&(f=0),g.setValue(f),s.findField("lineColor").setValue(r.color),s.findField("pointColor").setValue(r.point.color),s.findField("pointRadius").setValue(r.point.radius),s.findField("lineStyle").setValue(r.style),s.findField("lineThickness").setValue(r.width),s.findField("lineOpacity").setValue(100*r.opacity),s.findField("startOpacity").setValue(100*r.fill.startOpacity),s.findField("endOpacity").setValue(100*r.fill.endOpacity);var C=r.smoothing;if(C){s.findField("smoothingType").setValue(C);var f=r.smoothingValue;isNaN(f)&&(f=0),g.setValue(f)}else g.setValue(0),s.disableField("smoothingValue"),b.disabled=!0;s.onChange=function(){let t=s.getData();r.color=t.lineColor,r.style=t.lineStyle,r.width=t.lineThickness,r.opacity=t.lineOpacity/100,r.fill.color=t.lineColor,r.fill.startOpacity=t.startOpacity/100,r.fill.endOpacity=t.endOpacity/100,r.point.color=t.pointColor,r.point.radius=t.pointRadius;var l=t.smoothingType;"none"===l?(r.smoothing="none",r.smoothingValue=0,s.disableField("smoothingValue"),b.disabled=!0):"spline"===l?(r.smoothing=l,r.smoothingValue=0,s.disableField("smoothingValue"),b.disabled=!0):(r.smoothing=l,r.smoothingValue=t.smoothingValue,s.enableField("smoothingValue"),b.disabled=!1),b.focus(),e.setConfig(r),c.update();var i=d.layers[a];i.group||(d.layers[a].line=e.getConfig())},l.showAt(108,57),s.resize()},L=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){g||(g=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;g.showAt(l,i,"right","middle"),g.setColor(e.getValue()),g.onChange=function(t){e.setValue(t)}})},T=javaxt.dhtml.utils.merge,E=javaxt.dhtml.utils.addShowHide,V=javaxt.dhtml.utils.createTable,N=bluewave.utils.createDashboardItem,D=bluewave.utils.createSlider,O=bluewave.utils.addTextEditor,F=bluewave.utils.getStyleEditor,S=bluewave.chart.utils.getType,B=bluewave.utils.parseData;p()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.HistogramEditor=function(e,t){var a=this,l={panel:{},chart:{}},o=[],s={},d={},r=function(){t||(t={}),t=L(t,l),d=t.chart;let i=E(),o=i.firstChild;var n=document.createElement("tr");o.appendChild(n),e.appendChild(i),a.el=i;var s;s=document.createElement("td"),s.style.height="100%",n.appendChild(s);var r=document.createElement("div");r.className="chart-editor-options",r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",r.style.overflowY="auto",s.appendChild(r),y=document.createElement("div"),y.style.position="absolute",r.appendChild(y),s=document.createElement("td"),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",n.appendChild(s);var r=document.createElement("div");r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",s.appendChild(r),p=V(r,{width:"100%",height:"100%",title:"Untitled",settings:!0}),h=p.innerDiv,p.el.className="",p.el.style.position="absolute",D(p.title,function(e){p.title.innerHTML=e,d.chartTitle=e}),p.settings.onclick=function(){x()},c=new bluewave.charts.BarChart(h,{}),c.onClick=function(e,t){v(t)}},p,u,h,c,y,m;this.update=function(e){a.clear();var l={};for(var i in L(l,e.config),L(l,t.chart),d=l,d.barType="histogram",e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],s=S(n.data,n.config);0<s.length&&o.push(s)}d.chartTitle&&(p.title.innerHTML=d.chartTitle),b(y),g()},this.clear=function(){o=[],d={},s={},p.title.innerHTML="Untitled",y.innerHTML="",c&&c.clear(),m&&m.hide()},this.getConfig=function(){let e=Object.assign({},d);return e},this.getChart=function(){return h},this.renderChart=function(e){var t=new bluewave.charts.BarChart(e,{});return t.update(d,o),t};var g=function(){for(let t=0;t<o.length;t++){var e=0<t?t+1:"";let a=`values${e}`,l=`group${e}`;s[l].add("","");let i=Object.keys(o[t][0]);i.forEach(e=>{s[a].add(e,e),s[l].add(e,e)}),s[a].setValue(d[a],!0),d[l]&&s[l].setValue(d[l],!0)}w()},b=function(e){for(var a=[],l=0,r;l<o.length;l++)r=0<l?l+1:"",a.push({group:"Series "+(0<l?r:1),items:[f("Values"),C(`values${r}`,s),f("Separate By"),C(`group${r}`,s)]});var p=document.createElement("div");p.style.height="100%",p.style.zIndex=1,e.appendChild(p);var u=new javaxt.dhtml.Form(p,{style:t.style.form,items:a});u.onChange=function(e,t){var a=e.name;d[a]=t,w()}},f=function(e){var t=document.createElement("div");return t.className="form-label",t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},C=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},w=function(){T(h,function(){c.update(d,o)})},x=function(){var e=O(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});l.add("Vertical","vertical"),l.add("Horizontal","horizontal"),l.setValue("vertical");var i=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"layout",label:"Chart Layout",type:l},{name:"legend",label:"Display Legend",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Histogram Options",items:[{name:"binWidth",label:"Bin Width",type:"text"}]}]}),o=i.findField("layout"),n=d.barLayout;o.setValue("horizontal"===n?"horizontal":"vertical");var s=i.findField("xGrid"),r=d.xGrid;s.setValue(!(!0!==r));var p=i.findField("yGrid"),u=d.yGrid;p.setValue(!(!0!==u));var h=i.findField("legend"),c=d.barLegend;h.setValue(!(!0!==c));var y=i.findField("xLabel"),m=d.xLabel;y.setValue(!(!0!==m));var g=i.findField("yLabel"),b=d.yLabel;g.setValue(!(!0!==b)),N("binWidth",i,"",1,100,1);var f=d.binWidth;(isNaN(f)||1>f)&&(f=10),i.findField("binWidth").setValue(f),i.onChange=function(){var e=i.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.legend=!("true"!==e.legend),e.xLabel=!("true"!==e.xLabel),e.yLabel=!("true"!==e.yLabel),d.barLayout=e.layout,d.barLegend=e.legend,d.xGrid=e.xGrid,d.yGrid=e.yGrid,d.xLabel=e.xLabel,d.yLabel=e.yLabel,d.binWidth=e.binWidth,w()},e.showAt(108,57),i.resize()},v=function(e){var a=O(t),l=a.getBody();l.innerHTML="";var i=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"barColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"fillOpacity",label:"Opacity",type:"text"}]}]});k("barColor",i),N("fillOpacity",i,"%");var o=d.fillOpacity;if(isNaN(o)&&(o=1),d.fillOpacity=o,i.findField("fillOpacity").setValue(100*o),null!==e&&void 0!==e){let t=`${e}`;d["barColor"+t]||(d["barColor"+t]="#6699CC"),isNaN(d["fillOpacity"+t])&&(d["fillOpacity"+t]=1),i.findField("barColor").setValue(d["barColor"+t]),i.findField("fillOpacity").setValue(100*d["fillOpacity"+t]),i.onChange=function(){let e=i.getData();d["barColor"+t]=e.barColor,d["fillOpacity"+t]=e.fillOpacity,w()}}a.showAt(108,57),i.resize()},k=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){m||(m=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;m.showAt(l,i,"right","middle"),m.setColor(e.getValue()),m.onChange=function(t){e.setValue(t)}})},L=javaxt.dhtml.utils.merge,T=javaxt.dhtml.utils.onRender,E=javaxt.dhtml.utils.createTable,V=bluewave.utils.createDashboardItem,N=bluewave.utils.createSlider,D=bluewave.utils.addTextEditor,O=bluewave.utils.getStyleEditor,F=bluewave.chart.utils.getType,S=bluewave.utils.parseData;r()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.SankeyEditor=function(e,t){var a=Math.abs,l=Math.ceil,o=this,s={margin:{top:10,right:10,bottom:10,left:10},nodes:[{icon:"fas fa-sign-out-alt",label:"Input"},{icon:"fas fa-random",label:"Distributor"},{icon:"fas fa-sign-in-alt",label:"Output"}],sankey:{style:{links:{color:"#ccc",opacity:.3}}},hidePreview:!1,renderers:{drawflowNodes:void 0}},d={},r={},u={},c={},d={},y=0,m=function(){var a={};me(a,t),me(a,s),t=a,t.style||(t.style=javaxt.dhtml.style.default),f=t.waitmask,f||(f={show:function(){},hide:function(){}});var l=document.createElement("div");l.style.height="100%",l.style.position="relative",l.style.overflow="hidden",ue(l);var i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="absolute",l.appendChild(i),b=document.createElement("div"),b.style.height="100%",b.style.textAlign="center",i.appendChild(b),ge(b),de(b),b.hide(),g=document.createElement("div"),g.className="drawflow",g.ondrop=J,g.ondragover=function(t){t.preventDefault()},g.onwheel=function(t){t.preventDefault(),E&&(0<t.deltaY?Q():K())},i.appendChild(g),z(g),Y(g),I(g),ge(g),e.appendChild(l),o.el=l,ge(o)},g,b,f,C,w,v,k,L,T,E,V,N,D,O,F,S,B,M;this.onChange=function(){},this.onContextMenu=function(e){},this.onNodeImport=function(e){},this.clear=function(){E.clear(),E.removeModule(V),V=null,P("Untitled",!0),O.clear(),r={},c={},y=0},this.update=function(e){o.clear();var a=null,l=!1;if(e.inputs)for(var d in e.inputs)if(e.inputs.hasOwnProperty(d)){var p=e.inputs[d];if(p.config.nodes||p.config.links){a=p.config,l=!0;break}}if(a||(a={}),me(a,e.config),a=JSON.parse(JSON.stringify(a)),P(a.chartTitle,!0),a.style||(a.style={}),t.sankey.style=me(a.style,s.sankey.style),F.setValue("Edit"),!0===t.hidePreview?F.hide():F.show(),V="sankey_"+new Date().getTime(),E.addModule(V),E.changeModule(V),a.layout){var u={drawflow:{}};u.drawflow[V]={data:a.layout},E.import(u)}for(var d in a.nodes)if(a.nodes.hasOwnProperty(d)){var h=E.getNodeFromId(d),y=document.createElement("div");y.innerHTML=h.html;var e=document.getElementById(y.childNodes[0].id),m=a.nodes[d];for(var b in m)if(m.hasOwnProperty(b)){var f=m[b];e[b]=f}for(var b in ee(e),e.inputs={},h.inputs)if(h.inputs.hasOwnProperty(b)){var C=h.inputs[b].connections;for(var w in C){var x=C[w],v=x.node,k=r[v];e.inputs[v]=k}}r[d]=e,o.onNodeImport(e,m)}for(var d in r){var e=r[d];for(var v in e.inputs){var k=e.inputs[v];k||(e.inputs[v]=r[v])}}for(var C=g.getElementsByTagName("svg"),w=0;w<C.length;w++){var x=C[w],L=H(x),v=L[0],T=L[1],b=v+"->"+T,N=a.links[b];c[b]=N.quantity;var D=x.getElementsByTagName("path")[0];D.setAttribute("d",N.path),ye(D,function(){A(this)}),q()}X(a.zoom),l&&(F.hide(),F.setValue("Preview"))};var A=function(e){var t=e.parentNode,i=H(t),n=i[0]+"->"+i[1],s=c[n],d=e.getTotalLength(),l=e.getPointAtLength(d/2),r=d3.select(e.parentNode),p=r.append("g").attr("transform","translate(-9999,-9999)").on("click",function(){var e=he();e.label=d3.select(this),o.showMenu(e,this)}),m=r.append("text").attr("text-anchor","start").text(s),g=m.node().getBBox();m.remove();var b=Math.max(g.width+8,60),f=g.height,h=f/2,C=l.x+h,w=l.y-h,y=[[C,w],[C+b,w],[C+b,w+f],[C,w+f],[C-h,w+h]];p.append("polygon").attr("points",y.join(" ")).style("fill","#459db7");var h=f/3;p.append("text").attr("x",C+h).attr("y",l.y+h).attr("text-anchor","start").style("fill","#fff").text(s),u[n]=p};this.getNodes=function(){return r},this.getConfig=function(){var e={layout:V?E.export().drawflow[V].data:{},nodes:{},links:{},chartTitle:R(),style:t.sankey.style,zoom:y};for(var a in e.layout)if(e.layout.hasOwnProperty(a)){var l=e.layout[a];l.html=r[a].parentNode.innerHTML}for(var a in r)if(r.hasOwnProperty(a)){var l=r[a];for(var o in e.nodes[a]={name:l.name,type:l.type,notes:l.notes},l)if(l.hasOwnProperty(o)){var n=l[o],s=!1;"string"==typeof n?s=!0:isNaN(n)?(!0===n||!1===n)&&(s=!0):s=!0,s&&(e.nodes[a][o]=n)}}for(var d=g.getElementsByTagName("svg"),p=0;p<d.length;p++){var u=d[p],h=H(u),m=u.getElementsByTagName("path")[0];m&&(m=m.getAttribute("d"));var a=h[0]+"->"+h[1];e.links[a]={path:m,quantity:c[a]}}return e};var H=function(e){var t=e.className;t.baseVal&&(t=t.baseVal);for(var a=t.split(" "),l=0,i,o;l<a.length;l++){var n=a[l].trim(),s=n.indexOf("node_in_node");0===s&&(o=n.substring(12+1));var s=n.indexOf("node_out_node");0===s&&(i=n.substring(13+1))}return[i,o]};this.getChart=function(){return b.isVisible()||F.setValue("Preview"),b},this.renderChart=function(e){var a=new bluewave.charts.SankeyChart(e,t.sankey),l=o.getSankeyData();return a.update(t.sankey.style,l),a},this.getEditor=function(){return b.isVisible()&&F.setValue("Edit"),g};var P=function(e,t){e||(e="Untitled"),C.title.innerHTML=e,T.innerHTML=e;!0===t||o.onChange()},R=function(){var e=C.title.innerHTML;return e?e:null},z=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.textAlign="center",t.style.zIndex=2,e.appendChild(t),T=document.createElement("div"),T.className="chart-title noselect",T.style.display="inline-block",T.style.backgroundColor="rgba(255,255,255,0.7)",T.style.padding="5px 10px",t.appendChild(T),fe(T,function(e){P(e)})},I=function(e){w=document.createElement("div"),w.className="drawflow-toolbar",e.appendChild(w),v=new javaxt.dhtml.Callout(document.body,{style:{panel:"tooltip-panel",arrow:"tooltip-arrow"}});var a=v.hide;v.hide=function(){k&&clearTimeout(k),a()};for(var l=0,o;l<t.nodes.length;l++)o=t.nodes[l],se(o.icon,o.label)},G=function(e){var t=r[e],a=t.inputs,l=0;for(var i in a)if(a.hasOwnProperty(i)){var o=c[i+"->"+e];l+=o}return 0==l&&(l=1),l},W=function(){for(var e in r){var t=r[e],a=t.inputs,l=U(e),o=0,s=0;for(var d in a)if(a.hasOwnProperty(d)){var p=r[d],u=c[d+"->"+e];o+=u}for(var h=0;h<l.length;h++){var d=l[h],p=r[d],u=c[e+"->"+d];s+=u}var y=E.drawflow.drawflow[V].data,m=y[e];t.style.color=_(m)&&o!=s?"red":"black"}q()},U=function(e){var t=[];for(var a in r){var l=r[a],i=l.inputs;for(var o in i)e===o&&t.push(a)}return t},_=function(e){return 0!==Object.keys(e.inputs).length&&0!==Object.keys(e.outputs).length},q=function(){var e=g.getElementsByClassName("connection");for(var t of e){var a=t.classList,l=[];for(var i of a)i.includes("node")&&l.push(i);var o=t.children[0];j(l,o)}},j=function(e,t){var a=e[0].substring(12+1),l=e[1].substring(13+1),i=r[a],o=r[l];("undefined"!=typeof i||"undefined"!=typeof o)&&("red"==i.style.color||"red"==o.style.color?t.style.stroke="red":t.style.stroke="")},Y=function(e){E=new Drawflow(e),E.reroute=!0,E.start();var t,a;E.on("click",function(l){t=l.clientX,a=l.clientY}),E.on("connectionCreated",function(e){var t=e.output_id+"",a=e.input_id+"",l=t+"->"+a,n=r[a];n.inputs[t]=r[t];var s=G(t);c[l]=s;for(var d=g.getElementsByTagName("svg"),p=0;p<d.length;p++){var u=d[p],h=H(u);if(h[1]===a&&h[0]===t){var y=u.getElementsByTagName("path")[0];A(y);break}}W(),o.onChange()}),E.on("connectionRemoved",function(e){var t=e.output_id+"",a=e.input_id+"",l=t+"->"+a,i=u[l];i&&i.remove(),delete u[l],delete c[l],W(),o.onChange()}),E.on("nodeRemoved",function(e){delete r[e+""],W(),o.onChange()}),E.on("nodeMoved",function(e){for(var t in u)if(u.hasOwnProperty(t)){var a=t.split("->");if(a[0]===e||a[1]===e){var l=u[t],i=l.node().previousSibling;l&&l.remove(),delete u[t],A(i)}}}),E.on("contextmenu",function(t){setTimeout(function(){for(var e in r)if(r.hasOwnProperty(e)){var t=r[e],a=t.parentNode.parentNode,l=a.getElementsByClassName("drawflow-delete")[0];l&&(o.onContextMenu(t),a.removeChild(l),l=document.createElement("div"),l.className="drawflow-delete2",a.appendChild(l),l.innerHTML="&#x2715",l.onclick=function(){var e=this;confirm("Are you sure you want to delete this node?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(t){t?E.removeNodeId(e.parentNode.id):e.parentNode.removeChild(e)}})})}},200)})},X=function(e){if(e=parseInt(e),!(isNaN(e)||e===y))for(var t=a(e,y),l=0;l<t;l++)e<y?Q():K()},K=function(){E.zoom_in(),y++},Q=function(){E.zoom_out(),y--},$=function(e){"touchstart"===e.type||e.dataTransfer.setData("node",e.target.getAttribute("data-node"))},J=function(e){if("touchend"===e.type);else{e.preventDefault();let t=e.dataTransfer.getData("node");Z(t,e.clientX,e.clientY)}},Z=function(e,a,l){if("fixed"===E.editor_mode)return!1;a=a*(E.precanvas.clientWidth/(E.precanvas.clientWidth*E.zoom))-E.precanvas.getBoundingClientRect().x*(E.precanvas.clientWidth/(E.precanvas.clientWidth*E.zoom)),l=l*(E.precanvas.clientHeight/(E.precanvas.clientHeight*E.zoom))-E.precanvas.getBoundingClientRect().y*(E.precanvas.clientHeight/(E.precanvas.clientHeight*E.zoom));var s=d[e];if(!s)return void console.log("Unsupported Node Type: "+e);var p=s.el.dataset.title,u=0;for(var h in r)if(r.hasOwnProperty(h)){var c=r[h],y=c.type;y===e&&u++}0<u&&(p+=" "+(u+1));var m=s.el.dataset.icon,g=document.createElement("i");g.className=m;for(var i=0,b=0,f=0,C;f<t.nodes.length;f++)if(C=t.nodes[f],C.label===e){0==f?b=1:f==t.nodes.length-1?i=1:(i=1,b=1);break}var c=ae({name:p,type:e,icon:m,content:g,position:[a,l],inputs:i,outputs:b});ee(c),o.onChange()},ee=function(e){e.ondblclick=function(){le(this)}},te=function(e){var t=document.createElement("div"),a=document.createElement("div");a.className="drawflow-node-title",a.innerHTML="<i class=\""+e.icon+"\"></i><span>"+e.name+"</span>",t.appendChild(a);var l=document.createElement("div");l.className="drawflow-node-body";var i=e.content;return i&&("string"==typeof i?l.innerHTML=i:l.appendChild(i)),t.appendChild(l),t},ae=function(e){var a;a=t.renderers.drawflowNodes?t.renderers.drawflowNodes(e):te(e);var l=new Date().getTime();a.id="drawflow_node_"+l;var i=E.addNode(e.type,e.inputs,e.outputs,e.position[0],e.position[1],"",{},a.outerHTML);a=document.getElementById(a.id),a.name=e.name,a.type=e.type,a.inputs={},a.outputs={},r[l+""]=a;var o=E.drawflow.drawflow[V].data,n=o[i];n.id=l,o[l+""]=n,delete o[i];var s=a.parentNode,d=s.parentNode;return d.id="node_"+l,a};this.getNodeEditor=function(){if(!N){N=new javaxt.dhtml.Window(document.body,{title:"Edit Node",width:400,valign:"top",modal:!0,resizable:!1,style:t.style.window});var e=new javaxt.dhtml.Form(N.getBody(),{style:t.style.form,items:[{name:"name",label:"Name",type:"text"},{name:"notes",label:"Notes",type:"textarea"}],buttons:[{name:"Cancel",onclick:function(){i(),N.close()}},{name:"Submit",onclick:function(){var t=e.getData(),i=t.name;return i&&(i=i.trim()),null==i||""===i?void we("Name is required",a):void(f.show(),ie(i,N.node,function(e){f.hide(),e?l():we("Name is not unique",a)}))}}]}),a=e.findField("name"),l=function(){N.close();var t=N.node;if(t){var a=e.getData();t.name=a.name,t.notes=a.notes,t.name&&(t.name=t.name.trim(),0<t.name.length&&(t.childNodes[0].getElementsByTagName("span")[0].innerHTML=t.name))}},i=function(){var t=N.node;t&&(t.name&&e.setValue("name",t.name),t.notes&&e.setValue("notes",t.notes))};N.update=function(t){e.clear(),a.resetColor&&a.resetColor(),N.node=t,t&&(t.name&&e.setValue("name",t.name),t.notes&&e.setValue("notes",t.notes))}}return N};var le=function(e){var t=o.getNodeEditor();t.update(e),t.show()},ie=function(e,t,a){var l=!0;for(var i in r)if(r.hasOwnProperty(i)){var n=r[i],s=n.name;if(n!==t&&e.toLowerCase()===s.toLowerCase()){l=!1;break}}a.apply(o,[l])};this.getLinkEditor=function(){if(!D){var e={};D=new javaxt.dhtml.Window(document.body,{title:"Edit Link",width:400,valign:"top",modal:!0,resizable:!1,style:t.style.window});var a=new javaxt.dhtml.Form(D.getBody(),{style:t.style.form,items:[{name:"quantity",label:"Quantity",type:"text"}],buttons:[{name:"Cancel",onclick:function(){D.close()}},{name:"Submit",onclick:function(){var t=a.getData(),i=t.quantity;return i&&(i=parseFloat(i.trim())),isNaN(i)?void we("Quantity is required",l):void(c[e.from+"->"+e.to]=i,e.label.select("text").text(i),D.close(),o.onChange())}}]}),l=a.findField("quantity");D.update=function(t){a.clear(),l.resetColor&&l.resetColor();var i=t.node().parentNode,o=H(i);e.from=o[0],e.to=o[1],e.label=t;var n=c[e.from+"->"+e.to];l.setValue(n)}}return D};var oe=function(e){var t=o.getLinkEditor();t.update(e),t.show()},ne=function(e){var t=e.node().parentNode,a=H(t);E.removeSingleConnection(a[0],a[1],"output_1","input_1")},se=function(e,t){var a=new javaxt.dhtml.Button(w,{display:"table",disabled:!1,style:{button:"drawflow-toolbar-button",select:"drawflow-toolbar-button-selected",hover:"drawflow-toolbar-button-hover",label:"drawflow-toolbar-button-label",icon:"drawflow-toolbar-button-icon "+e}});return a.el.dataset.node=t,a.el.dataset.icon=e,a.el.dataset.title=t,a.el.draggable=!0,a.el.ondragstart=function(t){return!a.isDisabled()&&void $(t)},a.el.onmouseover=function(t){var e=this;if(k&&clearTimeout(k),a.isEnabled()){var i=function(){var t=e.dataset.node,a=e.dataset.title,i="Add "+(null==a?t:a);v.getInnerDiv().innerHTML=i;var o=javaxt.dhtml.utils.getRect(e),n=javaxt.dhtml.utils.getRect(e.parentNode),s=n.x+n.width+3,d=o.y+l(o.height/2);v.showAt(s,d,"right","center"),L=new Date().getTime()},o=!1;L&&3e3>new Date().getTime()-L&&(o=!1),o?k=setTimeout(i,1e3):i()}},a.el.onmouseleave=function(){v.hide()},a.el.onmousedown=function(){v.hide()},d[t]=a,a},de=function(e){C=be(e,{width:"1000px",height:"644px",title:"Untitled",settings:!0});var a=C.el;a.className="dashboard-item",a.style.float="none",fe(C.title,function(e){P(e)}),C.settings.onclick=function(){pe()},O=new bluewave.charts.SankeyChart(C.innerDiv,t.sankey)},re=function(){var e=o.getSankeyData();O.update(t.sankey.style,e)};this.getSankeyData=function(){var e={nodes:[],links:[]};for(var t in r)if(r.hasOwnProperty(t)){var a=r[t],l=a.name;e.nodes.push({name:l,group:a.type});var i=a.inputs;for(var o in i)if(i.hasOwnProperty(o)){var s=r[o],d=c[o+"->"+t];e.links.push({source:s.name,target:l,value:d})}}return e};var pe=function(){if(!S){var e=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}),a=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox});a.add("Solid color","#ccc"),a.add("Source color","source");var l=new javaxt.dhtml.Form(e.getBody(),{style:t.style.form,items:[{group:"Links",items:[{name:"linkColor",label:"Color",type:a},{name:"linkOpacity",label:"Opacity",type:"text"}]}]});Ce("linkOpacity",l,"%"),S=l,S.show=function(){e.show(),l.resize()}}var i=t.sankey.style;S.onChange=function(){},S.findField("linkColor").setValue(i.links.color),S.findField("linkOpacity").setValue(100*i.links.opacity),S.onChange=function(){var e=S.getData();i.links.color=e.linkColor,i.links.opacity=e.linkOpacity/100,re()},S.show()},ue=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.top="20px",t.style.right="20px",t.style.zIndex=2,e.appendChild(t);var a=["Edit","Preview"];F=bluewave.utils.createToggleButton(t,{options:a,defaultValue:a[0],onChange:function(e){"Edit"===e?(b.hide(),g.show()):(g.hide(),b.show(),re())}}),ge(F)};this.showMenu=function(e,t){for(var a=0,l=0,n;l<e.childNodes.length;l++)n=e.childNodes[l],n.isVisible()&&a++;if(0!==a){for(var s=o.getCallout(),d=s.getInnerDiv();d.firstChild;)d.removeChild(d.lastChild);d.appendChild(e);var r=javaxt.dhtml.utils.getRect(t),p=r.x+r.width/2,u=r.y+r.height+3;s.showAt(p,u,"below","right")}};var he=function(){if(!M){var e=document.createElement("div");e.className="app-menu",e.appendChild(ce("Edit Quantity","edit",function(){oe(M.label)})),e.appendChild(ce("Delete Link","times",function(){ne(M.label)})),M=e}return M},ce=function(e,t,a){var l=document.createElement("div");return l.className="app-menu-item noselect",l.innerHTML=t&&0<t.length?"<i class=\"fas fa-"+t+"\"></i>"+e:e,l.label=e,l.onclick=function(){B.hide(),a.apply(this,[e])},ge(l),l};this.getCallout=function(){if(B){var e=B.el.parentNode;e||(B.el.innerHTML="",B=null)}return B||(B=new javaxt.dhtml.Callout(document.body,{style:t.style.callout})),B};var ye=function(e,t){var a=e.getBBox(),l=a.width;if(0===l||isNaN(l)){var i=function(){var a=e.getBBox(),l=a.width;0===l||isNaN(l)?o=setTimeout(i,100):(clearTimeout(o),t&&t.apply(e,[a]))},o;o=setTimeout(i,100)}else t&&t.apply(e,[a])},me=javaxt.dhtml.utils.merge,ge=javaxt.dhtml.utils.addShowHide,be=bluewave.utils.createDashboardItem,fe=bluewave.utils.addTextEditor,Ce=bluewave.utils.createSlider,we=bluewave.utils.warn;m()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.ScatterEditor=function(e,t){var a=this,l={panel:{},chart:{pointColor:"#6699cc",pointRadius:7,pointOpacity:.8,showRegLine:!1,showTooltip:!0}},i=[],o={},s={},d=function(){t||(t={}),t=x(t,l),s=t.chart;let i=v(),o=i.firstChild;var n=document.createElement("tr");o.appendChild(n),e.appendChild(i),a.el=i;var d;d=document.createElement("td"),n.appendChild(d);let c=document.createElement("div");c.className="chart-editor-options",d.appendChild(c),h=c,d=document.createElement("td"),d.className="chart-editor-preview",d.style.width="100%",d.style.height="100%",n.appendChild(d),r=k(d,{width:"100%",height:"100%",title:"Scatter Chart",settings:!0}),p=r.innerDiv,r.el.className="",T(r.title,function(e){r.title.innerHTML=e,s.chartTitle=e}),r.settings.onclick=function(){C()},u=new bluewave.charts.ScatterChart(p,{})},r,p,u,h,c,m;this.update=function(e){a.clear();var l={};for(var o in x(l,e.config),x(l,t.chart),s=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var n=e.inputs[o],d=N(n.data,n.config);0<d.length&&i.push(d)}s.chartTitle&&(r.title.innerHTML=s.chartTitle),g(h)},this.clear=function(){i=[],s={},r.title.innerHTML="Untitled",h.innerHTML="",u&&u.clear(),m&&m.hide()},this.getConfig=function(){return s},this.getChart=function(){return p},this.renderChart=function(e){var t=new bluewave.charts.ScatterChart(e,{});return t.update(s,i),t};var g=function(e){var t=v(),a=t.firstChild;t.style.height="",e.appendChild(t),b(a,"xAxis","X-Axis",f),b(a,"yAxis","Y-Axis",f);var l=i[0];let n=Object.keys(l[0]);n.forEach(e=>{o.xAxis.add(e,e),o.yAxis.add(e,e)}),o.xAxis.setValue(s.xAxis,!1),o.yAxis.setValue(s.yAxis,!1)},b=function(e,a,l,i){var n,d;n=document.createElement("tr"),e.appendChild(n),d=document.createElement("td"),n.appendChild(d),d.innerHTML=l+":",n=document.createElement("tr"),e.appendChild(n),d=document.createElement("td"),n.appendChild(d),o[a]=new javaxt.dhtml.ComboBox(d,{style:t.style.combobox,readOnly:!0}),o[a].onChange=function(e,t){s[a]=t,i()}},f=function(){u.update(s,i)},C=function(){c||(c=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=c.getBody();e.innerHTML="";var a=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!1}),o=[];i.forEach(function(e,t){var a=0<t?t+1:"";let l=`xAxis${a}`;var i=s[l];i&&e.forEach(e=>{o.push(e[i])})});var n=V(o);if("number"==n||"currency"==n){var d=Number.MAX_VALUE,r=0;o.forEach(e=>{var t=bluewave.chart.utils.parseFloat(e);d=Math.min(t,d),r=Math.max(t,r)}),a.add("0",0),0!=d&&a.add(d+"",d),a.setValue(0)}var p=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"pointLabels",label:"Display Point Labels",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Analysis",items:[{name:"showRegLine",label:"Enable Regression Line",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Points",items:[{name:"pointColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"pointOpacity",label:"Point Opacity",type:"text"},{name:"pointRadius",label:"Radius",type:"text"}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"xMin",label:"Min Value",type:a}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]}]}),u=p.findField("xGrid"),h=s.xGrid;u.setValue(!(!0!==h));var y=p.findField("yGrid"),m=s.yGrid;y.setValue(!(!0!==m));var g=p.findField("xLabel"),b=s.xLabel;g.setValue(!!b);var C=p.findField("yLabel"),x=s.yLabel;C.setValue(!!x);var v=p.findField("pointLabels"),k=s.showPointLabels;v.setValue(!(!0!==k)),w("pointColor",p),p.findField("pointColor").setValue(s.pointColor),L("pointRadius",p,"px",0,20,1);var T=parseInt(s.pointRadius);(isNaN(T)||1>T)&&(T=l.chart.pointRadius),p.findField("pointRadius").setValue(T),L("pointOpacity",p,"%");var N=parseFloat(s.pointOpacity);(isNaN(N)||0>N||100<N)&&(N=l.chart.pointOpacity),p.findField("pointOpacity").setValue(E(100*N,0)),p.onChange=function(){var e=p.getData();s.pointColor=e.pointColor,s.pointOpacity=e.pointOpacity/100,s.pointRadius=e.pointRadius,e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel="true"===e.xLabel?s.xAxis:null,e.yLabel="true"===e.yLabel?s.yAxis:null,e.pointLabels=!("true"!==e.pointLabels),e.showRegLine=!("true"!==e.showRegLine),s.xGrid=e.xGrid,s.yGrid=e.yGrid,s.xLabel=e.xLabel,s.yLabel=e.yLabel,s.pointLabels=e.pointLabels,s.showRegLine=e.showRegLine;var t=bluewave.chart.utils.parseFloat(a.getText());isNaN(t)||(s.xMin=t),f()},c.showAt(108,57),p.resize()},w=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){m||(m=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;m.showAt(l,i,"right","middle"),m.setColor(e.getValue()),m.onChange=function(t){e.setValue(t)}})},x=javaxt.dhtml.utils.merge,v=javaxt.dhtml.utils.createTable,k=bluewave.utils.createDashboardItem,L=bluewave.utils.createSlider,T=bluewave.utils.addTextEditor,E=javaxt.dhtml.utils.round,V=bluewave.chart.utils.getType,N=bluewave.utils.parseData;d()},!bluewave)var bluewave={};bluewave.editor||(bluewave.editor={}),bluewave.editor.FilterEditor=function(parent,config){var me=this,defaultConfig={supportedLanguages:["sql","javascript"],style:{border:"1px solid #b5b5b5",editor:{height:"240px"},bottomPanel:{backgroundColor:"#e4e4e4",borderTop:"1px solid #b5b5b5"}},filter:{mode:"sql",code:""}},inputData=[],data=[],button={},init=function(){config||(config={}),config=merge(config,defaultConfig);var e=createTable(parent),t;createToolbar(e.addRow().addColumn());var t=e.addRow().addColumn();setStyle(t,config.style.editor),t.style.borderBottom=config.style.border,createEditor(t);var a=t,t=e.addRow().addColumn();setStyle(t,config.style.bottomPanel),t.style.height="100%",t.style.verticalAlign="top",addVerticalResizer(t,a),createGridContainer(t),createWaitMask(t),me.el=e},editor,combobox,waitmask,gridContainer,grid,getRecords;this.getConfig=function(){return config.filter},this.getData=function(e){e&&e.apply(me,[data])},this.clear=function(){inputData=[],data=[],grid=null,gridContainer.innerHTML=""},this.update=function(e,t){for(var a in me.clear(),config.filter=merge(e.config,defaultConfig.filter),e.inputs)if(e.inputs.hasOwnProperty(a)){var l=e.inputs[a],i=parseData(l.data,l.config);0<i.length&&inputData.push({raw:l.data,data:i,config:l.config})}combobox.setValue(config.filter.mode,!0),editor.setMode(config.filter.mode);var o=config.filter.code,n=getDefaultCode(combobox.getValue());o?(o+="",0==o.trim().length&&(o=n)):o=n,editor.setValue(o),runScript(t)};var createToolbar=function(e){var t=document.createElement("div");t.className="panel-toolbar",e.appendChild(t);var a=createTable(t);a.style.width="";var l=a.addRow(),i;i=l.addColumn(),button.run=createButton(i,{style:config.style.toolbarButton,icon:"fas fa-play",label:"Run"}),button.run.onClick=runScript,i=l.addColumn(),i.style.verticalAlign="bottom",createSpacer(i),i=l.addColumn(),i.innerText="Mode:",i=l.addColumn(),i.style.width="150px",i.style.paddingLeft="5px",combobox=new javaxt.dhtml.ComboBox(i,{style:config.style.combobox,readOnly:!0}),config.supportedLanguages.forEach(e=>{var t;t="sql"===e?e.toUpperCase():e.substring(0,1).toUpperCase()+e.substring(1),combobox.add(t,e)}),combobox.onChange=function(e,t,a,l){var i=editor.getValue(),o=getDefaultCode(l);i===o?(editor.setMode(t),editor.setValue(getDefaultCode(t))):confirm("Are you sure you want to delete this code and switch editor?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(e){e?(editor.setMode(t),editor.setValue(getDefaultCode(t)),gridContainer.innerHTML=""):combobox.setValue(l,!0)}})}},createEditor=function(e){if("undefined"!=typeof CodeMirror){var t=document.createElement("div");t.style.height="100%",t.style.position="relative",e.appendChild(t);var a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.overflow="auto",t.appendChild(a);var l=function(){editor=CodeMirror(a,{value:"",mode:config.filter.mode,lineNumbers:!1,indentUnit:4}),editor.setValue=function(e){var t=this.getDoc();t.setValue(e),t.clearHistory();var a=this;setTimeout(function(){a.refresh()},200)},editor.getValue=function(){return this.getDoc().getValue()},editor.setMode=function(e){if(e!==editor.getOption("mode")){config.filter.mode=e;var t=editor.getValue();editor=null,a.innerHTML="",l(),editor.setValue(t)}}};l()}else editor=document.createElement("textarea"),editor.style.height="100%",editor.style.width="100%",editor.style.resize="none",e.appendChild(editor),editor.getValue=function(){return this.value},editor.setValue=function(e){this.value=e},editor.setMode=function(){}},createGridContainer=function(e){gridContainer=document.createElement("div"),gridContainer.className="grid-container-"+new Date().getTime(),gridContainer.style.height="100%",e.appendChild(gridContainer)},addVerticalResizer=function(e,t){var a=document.createElement("div");a.style.position="relative";var l=document.createElement("div");l.style.position="absolute",l.style.width="100%",l.style.height="10px",l.style.top="-5px",l.style.cursor="ns-resize",l.style.zIndex=2,a.appendChild(l),e.appendChild(a),javaxt.dhtml.utils.initDrag(l,{onDragStart:function(e,a){var l=this;l.yOffset=a,l.initialHeight=t.offsetHeight},onDrag:function(e,a){var l=this,i=l.yOffset-a,o=l.initialHeight-i;t.style.height=o+"px"},onDragEnd:function(){}})},createWaitMask=function(e){waitmask=javaxt.express?new javaxt.express.WaitMask(e):{show:function(){},hide:function(){}}},getDefaultCode=function(e){return"sql"==e?"select * from ?":"javascript"==e?"var records = [];\ndata.forEach((record, i)=>{\n    \n    //TODO: do something with the record\n    \n    records.push(record);\n});\nreturn records;":void 0},runScript=function(callback){gridContainer.innerHTML="";var mode=combobox.getValue(),code=editor.getValue(),input=inputData[0];waitmask.show(),setTimeout(()=>{var arr;if("sql"===mode)arr=alasql(code,[input.data]);else if("javascript"===mode){getRecords=null;var fn="getRecords = function(data){\n"+code+"\n}";eval(fn),arr=getRecords(input.data)}if(waitmask.hide(),arr&&(data=[],0<arr.length)){var keys=Object.keys(arr[0]);data.push(keys),arr.forEach(e=>{var t=[];keys.forEach(a=>{t.push(e[a])}),data.push(t)}),createGrid(data,!0,gridContainer,config)}config.filter.code=code,config.filter.hasHeader=input.config.hasHeader,config.filter.sheetName=input.config.sheetName,callback&&callback.apply(me,[data,config.filter])},300)},merge=javaxt.dhtml.utils.merge,setStyle=javaxt.dhtml.utils.setStyle,createTable=javaxt.dhtml.utils.createTable,createButton=bluewave.utils.createButton,createSpacer=bluewave.utils.createSpacer,createGrid=bluewave.utils.createGrid,parseData=bluewave.utils.parseData;init()};
