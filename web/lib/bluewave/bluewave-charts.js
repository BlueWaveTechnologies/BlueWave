if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.CalendarChart=function(a,c){var d,e,f=this,b={dayLabel:!0,yearLabel:!0,date:"date",value:"value",weekday:"monday",cellSize:17,colors:["#fff","#ebf5dc","#cbe9a5","#2a671a"],showTooltip:!1};this.setConfig=function(a){c=a?h(a,b):b},this.onClick=function(a,b){},this.getCell=function(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth(),f=a.getDate(),g=null;return e.selectAll("rect").each(function(a){var e=a.getFullYear(),h=a.getMonth(),i=a.getDate();e===b&&h===c&&i===f&&(g=this)}),g},this.getTooltipLabel=function(a){return d3.utcFormat("%m/%d/%Y")(a.date)+"<br/>"+d3.format(",")(a.value)},this.clear=function(){e&&e.selectAll("*").remove()},this.update=function(a,e){f.clear(),1<arguments.length?c=h(a,b):e=arguments[0];var j=d.node().parentNode;i(j,function(){g(e)})};var g=function(a){f.clear();var b=c,g=c.cellSize,h=c.weekday,i=a=>"SMTWTFS"[a];a.forEach(a=>{var b=a[c.date],d=a[c.value];a[c.date]=new Date(b),a[c.value]=parseFloat(d)}),a.sort(function(d,a){return a[c.date].getTime()-d[c.date].getTime()});var j=[],n=[],o={};a.forEach(a=>{var b=a[c.date],d=a[c.value];j.push(b),n.push(d);var e=b.getUTCFullYear();o[e+""]=e}),o=Object.values(o),o.sort(function(c,a){return a-c});const p="sunday"===h?a=>a:a=>(a+6)%7,q="sunday"===h?d3.utcSunday:d3.utcMonday,r="weekday"===h?5:7,s=g*(r+2);var t,u=10,v=m(n,10),w=l(v.length+1,c.colors),x=function(a){for(var b=0;b<v.length-1;b++){var c=v[b],d=v[b+1],e=w[b];if(a>=c&&a<d)return e;if(a==v[v.length-1])return w[w.length-1]}};!0===c.showTooltip&&(t=k());var y=function(a,b){if(t){var c=f.getTooltipLabel({date:a,value:n[b]});t.html(c).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},z=function(){var a=d3.event;t&&t.style("top",a.clientY+"px").style("left",a.clientX+20+"px")},A=function(){t&&t.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},B=e.selectAll("*").data(o).join("g").attr("transform",(a,b)=>`translate(40.5,${s*b+1.5*g})`);b.yearLabel&&B.append("text").attr("class","chart-axis-label").attr("x",-5).attr("y",-5).attr("text-anchor","end").text(a=>a),b.dayLabel&&B.append("g").attr("class","tick").attr("text-anchor","middle").selectAll("text").data(function(a){var b=d3.range(7);return b.forEach(function(c,d){b[d]={day:c,year:a}}),b}).join("text").attr("x",-10).attr("y",function(a){return(p(a.day)+.5)*g}).attr("dy","0.31em").text(function(a){var b=a.day,c=a.year,d=!1;if(j.every(function(a){if(a.getUTCFullYear()===c){var e=a.getUTCDay();if(e===b)return d=!0,!1}return!0}),d||0<b&&6>b)return i(b)});B.append("g").selectAll("*").data(function(a){var b=[];return j.forEach(function(c){c.getUTCFullYear()===a&&b.push(c)}),b}).join("rect").attr("width",g-1).attr("height",g-1).attr("x",a=>q.count(d3.utcYear(a),a)*g+.5).attr("y",a=>p(a.getUTCDay())*g+.5).attr("fill",function(a,b){var d=n[b],e=x(d);return e===c.colors[0]&&0<d&&(e=w[1]),e}).on("mouseover",y).on("mousemove",z).on("mouseleave",A).on("click",function(a,b){f.onClick(this,{date:a,value:n[b]})});var C=B.append("g").selectAll("g").data(function(a){var b,c;return j.forEach(function(d){d.getUTCFullYear()===a&&(!c&&(c=d),b=d)}),b=new Date(b.getTime()),c=new Date(c.getTime()),b.setMonth(b.getMonth()-1),c.setMonth(c.getMonth()+1),d3.utcMonths(b,c)}).join("g");C.filter((a,b)=>b).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",3).attr("d",function(a){const b=Math.max(0,Math.min(r,p(a.getUTCDay()))),c=q.count(d3.utcYear(a),a);return`${0===b?`M${c*g},0`:b===r?`M${(c+1)*g},0`:`M${(c+1)*g},0V${b*g}H${c*g}`}V${r*g}`});var D={};C.append("text").attr("class","tick").attr("x",a=>q.count(d3.utcYear(a),q.ceil(a))*g+2).attr("y",-5).text(function(a){var b=d3.utcFormat("%b")(a),c=d3.utcFormat("%Y")(a),e=c+"-"+b,f=!1;if(j.every(function(a){var b=d3.utcFormat("%b")(a),c=d3.utcFormat("%Y")(a),d=c+"-"+b;return d!==e||(f=!0,!1)}),f&&!D[e])return D[e]=!0,b})},h=javaxt.dhtml.utils.merge,i=javaxt.dhtml.utils.onRender,j=bluewave.chart.utils.initChart,k=bluewave.chart.utils.createTooltip,l=bluewave.chart.utils.getColorRange,m=bluewave.chart.utils.getNaturalBreaks;(function(){f.setConfig(c),j(a,function(a,b){d=a,e=b})})()};if(!bluewave)var bluewave={};bluewave.chart||(bluewave.chart={}),bluewave.chart.Line=function(a){var b=this,c={color:"#6699CC",opacity:1,width:1,style:"solid",fill:{color:"#6699CC",startOpacity:0,endOpacity:0},point:{color:"#6699CC",radius:0},label:"",smoothing:"none",smoothingValue:0};this.setColor=function(b){b=d(b),b&&(a.color=b)},this.setOpacity=function(b){b=e(b),isNaN(b)||(a.opacity=b)},this.setWidth=function(b){b=parseFloat(b),!isNaN(b)&&0<b&&(a.width=b)},this.setStyle=function(b){b&&(b=(b+"").toLowerCase(),("solid"===b||"dashed"===b||"dotted"===b)&&(a.style=b))},this.setFill=function(b){if(!b)delete a.fill;else{var c=d(b.color);c&&(a.fill.color=c);var f=e(b.startOpacity);isNaN(f)||(a.fill.startOpacity=f);var f=e(b.endOpacity);isNaN(f)||(a.fill.endOpacity=f)}},this.setPoint=function(b){if(!b)delete a.point;else{var c=d(b.color);c&&(a.point.color=c);var e=parseFloat(b.radius);!isNaN(e)&&0<e&&(a.point.radius=e)}},this.setLabel=function(b){a.label=b},this.setSmoothing=function(b){if(b){switch(b=(b+"").toLowerCase(),b){case"spline":case"simple spline":b="spline";break;case"moving average":case"movingaverage":b="movingAverage";break;case"kernel density estimation":case"kde":b="kde";break;case"curvenatural":b="curveNatural";break;default:b="none";}a.smoothing=b}},this.setSmoothingValue=function(b){b=parseFloat(b),isNaN(b)||0>b||(a.smoothingValue=b)},this.getConfig=function(){return a},this.setConfig=function(a){for(var c in a)if(a.hasOwnProperty(c)){var d="set"+c.substring(0,1).toUpperCase()+c.substring(1);b[d]&&b[d].apply(b,[a[c]])}},this.getColor=()=>a.color,this.getWidth=()=>a.width,this.getStyle=()=>a.style,this.getFill=()=>a.fill,this.getPoint=()=>a.point,this.getLabel=()=>a.label,this.getSmoothing=()=>a.smoothing,this.getSmoothingValue=()=>a.smoothingValue,this.clone=function(){let b=Object.assign({},a);return new bluewave.chart.Line(b)};var d=function(a){return a},e=function(a){return a=parseFloat(a),isNaN(a)?null:0>a||1<a?null:a};(function(){if(!a)return void(a=c);var d=a;a=c,b.setConfig(d)})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.ScatterChart=function(a,b){var d,e,f,g,h,i,c=Math.max,j=this,k={pointColor:"#6699cc",pointRadius:7,pointOpacity:.8,pointLabels:!1,showRegLine:!1};this.setConfig=function(a){b=a?o(a,k):k},this.clear=function(){e&&e.selectAll("*").remove()},this.update=function(a,c,e){j.clear(),0<arguments.length&&(1===arguments.length||("string"==typeof c?(b.xAxis=c,b.yAxis=e):(j.setConfig(arguments[0]),a=arguments[1])));var f=d.node().parentNode;p(f,function(){l(a)})},this.getPointLabel=function(a){return""},this.getPointRadius=function(a){return b.pointRadius},this.getPointColor=function(a){return b.pointColor},this.getPointOpacity=function(a){return b.pointOpacity},this.getTooltipLabel=function(a){return b.xAxis+": "+a[b.xAxis]+"<br/>"+b.yAxis+": "+a[b.yAxis]},this.onClick=function(a,b,c){};var l=function(a){var k=javaxt.dhtml.utils.getRect(d.node()),l=k.width,o=k.height,p=o,r=l;f=e.append("g"),f.attr("width",l).attr("height",o);let t=b.xAxis,v=b.yAxis;if(!t||!v)return;if(q(a)&&q(a[0])&&(a=a[0]),0==a.length)return;var x=u(f,r,p,t,v,a,null,b);h=x.x,i=x.y;var y=x.margin;if(y){var C=y.left,D=y.right,E=y.top,F=y.bottom,G=0;if(b.pointLabels){var H=f.append("g");H.selectAll("text").data(a).enter().append("text").attr("x",0).attr("y",0).attr("text-anchor","start").attr("font-size",10).text(function(a){return j.getPointLabel(a)});var I=H.node().getBBox();H.remove(),G=c(I.width,G)}(0<E||0<F||0<C||0<D)&&(p-=E+F,r-=C+D,f.selectAll("*").remove(),f.attr("transform","translate("+C+","+E+")"),x=u(f,r,p,t,v,a,null,b)),y={top:E,right:D,bottom:F,left:C}}h=x.x,i=x.y;let J=s(a[t]);if(b.pointLabels){let a=G/r;h=z({scale:x.x,band:x.xBand},[0,r],a).scale,A(f,x.xAxis,h,null,null,p)}(b.xGrid||b.yGrid)&&w(f,h,i,p,r,b.xGrid,b.yGrid);var K,L=function(a){return"date"===J?h(new Date(a[t])):h(a[t])},M=function(a){return i(a[v])};!0===b.showTooltip&&(K=B());var N=function(a){if(K){var b=j.getTooltipLabel(a);K.html(b).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},O=function(){var a=d3.event;K&&K.style("top",a.clientY+"px").style("left",a.clientX+20+"px")},P=function(){K&&K.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},Q=f.append("g");if(Q.attr("name","points"),Q.selectAll("*").data(a).enter().append("circle").attr("dataset",0).attr("cx",L).attr("cy",M).attr("r",function(a){return j.getPointRadius(a)}).style("fill",function(a){return j.getPointColor(a)}).style("opacity",function(a){return j.getPointOpacity(a)}).style("stroke","white").on("mouseover",N).on("mousemove",O).on("mouseleave",P).on("click",function(a){var b=parseInt(d3.select(this).attr("dataset"));j.onClick(this,b,a)}),!0===b.pointLabels){var R=f.append("g");R.attr("name","labels"),R.append("g").selectAll("text").data(a).enter().append("text").attr("x",function(a){var b=L(a),c=j.getPointRadius(a);return b+c+1}).attr("y",M).attr("font-size",10).text(function(a){return j.getPointLabel(a)}).on("mouseover",N).on("mousemove",O).on("mouseleave",P).on("click",function(a){})}if(b.showRegLine){var S=m(a,t,v,d3.min(a,function(a){return a[t]}),d3.min(a,function(a){return a[v]}),h,i);g=d3.line().x(function(a){return a[0]}).y(function(a){return a[1]}),f.append("path").datum(S).attr("dataset",0).attr("d",g).attr("stroke",j.getPointColor()).attr("stroke-linecap","round").attr("stroke-width",2).on("click",function(a){var b=parseInt(d3.select(this).attr("dataset"));j.onClick(this,b,a)})}var I=n(f);if(I.width=1.1*(I.maxX-I.minX),I.height=1.1*(I.maxY-I.minY),I.width>l||I.height>o){var T,U=I.width-l,V=I.height-o;U>V?(T=l/I.width,1<T&&(T=1+(1-T))):V>U&&(T=o/I.height),E=(E+V/2)*T,f.attr("transform","translate("+C+","+E+") scale("+T+")")}},m=function(a,c,d,e,f,g,h){var i=a.length,j=[],k=[],l=[];a.forEach(a=>{var b={};b.x=parseFloat(g(a[c])),b.y=parseFloat(h(a[d])),b.mult=b.x*b.y,j.push(b),k.push(parseFloat(g(a[c]))),l.push(parseFloat(h(a[d])))});var n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=k.length;if(u!=l.length)throw new Error("The values in xAxis and yAxis need to have same size!");if(0===u)return[[],[]];for(var w=0;w<u;w++)s=k[w],t=l[w],n+=s,o+=t,q+=s*s,p+=s*t,r++;for(var z=(r*p-n*o)/(r*q-n*n),m=o/r-z*n/r,b=[],w=0;w<u;w++)s=k[w],t=s*z+m,b.push([s,t]);return b},n=function(a){var b=Number.MAX_VALUE,d=b,e=0,f=b,g=0;return a.selectAll("*").each(function(){var a=Math.min,b=javaxt.dhtml.utils.getRect(d3.select(this).node());d=a(b.left,d),e=c(b.right,e),f=a(b.top,f),g=c(b.bottom,g)}),{minX:d,maxX:e,minY:f,maxY:g}},o=javaxt.dhtml.utils.merge,p=javaxt.dhtml.utils.onRender,q=javaxt.dhtml.utils.isArray,r=bluewave.chart.utils.initChart,s=bluewave.chart.utils.getType,t=bluewave.chart.utils.getScale,u=bluewave.chart.utils.drawAxes,v=bluewave.chart.utils.drawLabels,w=bluewave.chart.utils.drawGridlines,z=bluewave.chart.utils.extendScale,A=bluewave.chart.utils.reDrawAxes,B=bluewave.chart.utils.createTooltip;(function(){j.setConfig(b),r(a,function(a,b){d=a,e=b})})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.PieChart=function(a,c){var e,f,d=Math.min,g=this,b={pieKey:"key",pieValue:"value",pieCutout:0,showLabels:!0,labelOffset:100,lineColor:"#777",borderColor:"#777",extendLines:!1,colors:["#6699cc","#f8f8f8"],colorScaling:"linear",otherColor:"#b8b8b8",animationSteps:1500};this.setConfig=function(a){c=a?l(a,b):b},this.getTooltipLabel=function(a){return a.key+"<br/>"+a.value},this.clear=function(){h()},this.update=function(a,b,d){h(),0<arguments.length&&(1===arguments.length||("string"==typeof b?(c.pieKey=b,c.pieValue=d):(g.setConfig(arguments[0]),a=arguments[1])));var f=e.node().parentNode;m(f,function(){i(a)})};var h=function(){f&&(f.node().innerHTML="",f.attr("transform",null))},i=function(a){var b=Math.abs,h=Math.PI;if(n(a)&&n(a[0])&&(a=a[0]),!c.pieKey||!c.pieValue)return;var i=c.pieSort;i=(i+"").toLowerCase();var l=(c.pieSortDir+"").toLowerCase();"key"===i?a.sort(function(d,a){return j(d[c.pieKey],a[c.pieKey],l)}):"value"===i&&(a=a.sort(function(d,e){return d=parseFloat(d[c.pieValue]),e=parseFloat(e[c.pieValue]),j(d,e,l)}));var m=a.length,o=parseFloat(c.maximumSlices),q=!1;if(!isNaN(o)&&0<o&&o<m){var r;if("descending"===l?(r=a.slice(o),a=a.slice(0,o)):(r=a.slice(0,m-o),a=a.slice(m-o,m)),!0===c.showOther){var s=0;r.forEach(function(a){var b=parseFloat(a[c.pieValue]);isNaN(b)||(s+=b)}),a.push({[c.pieKey]:"Other",[c.pieValue]:s}),q=!0}m=a.length}let t=a.reduce((a,b)=>(a[b[c.pieKey]]=b[c.pieValue],a),{});var u=0;"undefined"!=typeof c.piePadding&&(u=c.piePadding*h/180);var v=d3.pie().value(function(a){return a.value}).sort(null).padAngle(u);t=v(d3.entries(t));var z=javaxt.dhtml.utils.getRect(e.node()),A=z.width,B=z.height,C=f.append("g");C.attr("transform","translate("+A/2+","+B/2+")");var D=d(A,B)/2,E=c.pieCutout;null==E&&(E=.65);var F,G=D*E;!0===c.showTooltip&&(F=p());var H=function(a){if(F){var b=g.getTooltipLabel(a.data);F.html(b).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},I=function(){var a=d3.event;F&&F.style("top",a.clientY+"px").style("left",a.clientX+20+"px")},J=function(){F&&F.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},K=c.colors;K||(K=["#6699cc","#f8f8f8"]);var L=c.colorScaling;L||(L="linear");var M=c.otherColor;M||(M="#b8b8b8");var N,O=c.borderColor;if("linear"===L){var P=m-(q?2:1);N=d3.scaleLinear().domain([0,P]).range(K)}else"ordinal"===L&&(N=d3.scaleOrdinal(K));var Q=d3.arc().innerRadius(G).outerRadius(D),R=C.append("g");R.attr("name","pie"),R.selectAll("*").data(t).enter().append("path").attr("d",Q).attr("fill",function(a,b){return q&&b==m-1?M:N(b)}).attr("stroke",O).style("stroke-width","1px").on("mouseover",H).on("mousemove",I).on("mouseleave",J);var S=!0===c.showLabels;if(S&&"undefined"!==t[0].data.key&&!isNaN(t[0].value)){var T=parseFloat(c.labelOffset);(isNaN(T)||0>T)&&(T=100);var U=0;if(100<T)U=D*(T/100);else{var V=D-G;U=G+V*(T/100)}var w=!0===c.extendLines;w&&110>=T&&(w=!1);var W=d3.arc().innerRadius(G).outerRadius(G+90*(D-G)/50),X=d3.arc().innerRadius(D).outerRadius(D+2*(U-D)),Y=!1;if(Y){var Z=C.append("g").attr("name","test");Z.selectAll("*").data([{startAngle:0,endAngle:360*h/180}]).enter().append("path").attr("d",d3.arc().innerRadius(G).outerRadius(U)).attr("fill","none").attr("stroke","#ff0000").attr("stroke-width",1)}let e=[];var $=C.append("g");$.attr("name","lines"),$.selectAll("*").data(t).enter().append("polyline").attr("opacity","0").attr("stroke",c.lineColor).style("fill","none").attr("stroke-width",1).attr("points",function(c){var d=W.centroid(c),a=X.centroid(c),b=[d,a],f=c.startAngle+(c.endAngle-c.startAngle)/2,g=!!(f<h);return w&&b.push([U*(g?1:-1),a[1]]),e.push(b[b.length-1]),b}),110<T&&$.selectAll("polyline").attr("opacity","1");var _=C.append("g");_.attr("name","labels"),_.selectAll("*").data(t).enter().append("text").text(function(a){return a.data.key}).attr("transform",function(a,b){return"translate("+e[b]+")"}).style("text-anchor",function(a,b){if(b==m-1&&!w)return"middle";var c=a.startAngle+(a.endAngle-a.startAngle)/2;return c<h?"start":"end"});var aa=k(f);if(aa.width=1.1*(aa.maxX-aa.minX),aa.height=1.1*(aa.maxY-aa.minY),aa.width>A||aa.height>B){var ba,ca,da,ea=aa.width-A,fa=aa.height-B;ea>fa?(ba=A/aa.width,1<ba&&(ba=1+(1-ba)),ca=A/2,da=B/2):fa>ea&&(ba=B/aa.height,ca=A/2,da=aa.height),C.attr("transform","translate("+ca+","+da+") scale("+ba+")");var da=z.y,ca=z.x,ga=z.x+z.width/2,ha=z.y+z.height/2,z=javaxt.dhtml.utils.getRect(C.node()),ia=(B-z.height)/2,ja=(A-z.width)/2,ka=z.x+z.width/2,la=z.y+z.height/2,ja=ga-ka,ia=ha-la;0>ia&&(ia=0),0>ja&&(ja=0),C.attr("transform","translate("+(A/2+ja)+","+(B/2+ia)+") scale("+ba+")")}}var ma=c.animationSteps;if(!isNaN(ma)&&50<ma){var na=0;ma/=2;var oa=R.selectAll("path"),pa=d3.arc().innerRadius(0).outerRadius(0);if(oa.attr("d",pa),oa.transition().delay(function(a,c){var d=b(a.startAngle-a.endAngle)+a.padAngle,e=d/(2*h),f=na,g=e*ma;return na+=g,f}).duration(function(a){var c=b(a.startAngle-a.endAngle)+a.padAngle,d=c/(2*h);return d*ma}).ease(d3.easeLinear).attrTween("d",function(a){var b=d3.interpolate(a.startAngle,a.endAngle);return function(c){return a.endAngle=b(c),Q(a)}}),S){var qa=_.selectAll("text"),ra=$.selectAll("polyline");ra.attr("opacity",0),qa.attr("opacity",0);var sa=function(a,b){return b*ma/m};110<T&&ra.transition().delay(sa).duration(ma).attr("opacity",1),qa.transition().delay(sa).duration(ma).attr("opacity",1)}}},j=function(a,b,c){var d="string"==typeof a&&"string"==typeof b;return c=(c+"").toLowerCase(),"descending"===c?d?b.localeCompare(a):b-a:d?a.localeCompare(b):a-b},k=function(a){var b=Number.MAX_VALUE,c=b,e=0,f=b,g=0;return a.selectAll("*").each(function(){var a=Math.max,b=javaxt.dhtml.utils.getRect(d3.select(this).node());c=d(b.left,c),e=a(b.right,e),f=d(b.top,f),g=a(b.bottom,g)}),{minX:c,maxX:e,minY:f,maxY:g}},l=javaxt.dhtml.utils.merge,m=javaxt.dhtml.utils.onRender,n=javaxt.dhtml.utils.isArray,o=bluewave.chart.utils.initChart,p=bluewave.chart.utils.createTooltip;(function(){g.setConfig(c),o(a,function(a,b){e=a,f=b})})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.LineChart=function(a,c){var e,f,g,j,b,h,k,d=Math.max,l=this,i={xGrid:!1,yGrid:!1,scaling:"linear",stackValues:!1,endTags:!1,animationSteps:1500},m=[];this.setConfig=function(a){c=a?u(a,i):i,l.setScaling(c.scaling)},this.setScaling=function(a){c.scaling="logarithmic"===a?"logarithmic":"linear"},this.displayEndTags=function(a){c.endTags=!(!0!==a)},this.getXAxis=function(){return h},this.getYAxis=function(){return k},this.clear=function(){n(),m=[]},this.update=function(){var a=e.node().parentNode;v(a,function(){o()})},this.addLine=function(a,b,c,d){m.push({line:a,data:b,xAxis:c+"",yAxis:d+""})},this.getLayers=function(){return m},this.setLayers=function(a){m=a};var n=function(){f&&f.selectAll("*").remove()},o=function(){n();var a=c,o=m.map(a=>a.data);if(0!==o.length){var t=javaxt.dhtml.utils.getRect(e.node()),u=t.width,v=t.height,w=v,x=u;g=f.append("g"),g.attr("width",u).attr("height",v);var y=a.endTags;!0===y||!1===y||(y=1<o.length);var C=!0===a.stackValues,D=!0===a.accumulateValues,E=[];m.forEach(function(a){a.data&&a.data.forEach(function(b){for(var c=b[a.xAxis],d=!0,e=0;e<E.length;e++)if(E[e]==c){d=!1;break}d&&E.push(c)})});var F=[];for(let a=0;a<m.length;a++){if(!m[a].line)continue;let b=m[a].xAxis,c=m[a].yAxis;if(b&&c){var G=d3.nest().key(function(a){return a[b]}).rollup(function(a){return d3.sum(a,function(a){return a[c]})}).entries(m[a].data),H=m[a].line.getConfig();D&&G.forEach(function(a,b){var c=G[b].value;isNaN(c)&&(G[b].value=0),0<b&&(G[b].value+=G[b-1].value)});var I=H.smoothing;if(I){var J=H.smoothingValue;s(I,J,G)}F.push({lineConfig:H,sumData:G})}}if(C){if(D)F.sort(function(c,d){return c=c.sumData,c=c[c.length-1].value,d=d.sumData,d=d[d.length-1].value,d-c});else{var K=[];F.forEach(function(a){var b=a.sumData,c=0;b.forEach(a=>c+=a.value),K.push({sumValue:c,sumData:b,lineConfig:a.lineConfig})}),K.sort(function(c,a){return a.sumValue-c.sumValue}),F=[],K.forEach(a=>F.push({sumData:a.sumData,lineConfig:a.lineConfig}))}var L=z(E),M={};F.forEach(function(a,b){var c=a.sumData,d="none",e=0,f=0,g=0;if(2>c.length);else{for(var h=0;h<c.length-1;h++){var i=c[h].key,k=c[h+1].key;if("date"==L)i=new Date(i).getTime(),k=new Date(k).getTime(),k>=i&&e++,k<=i&&f++;else if("number"==L)i=parseFloat(i),k=parseFloat(k),k>i&&e++,k<i&&f++,k==i&&g++;else{var l=i.localeCompare(k);0>l&&e++,0<l&&f++,0==l&&g++}}e+g==c.length-1&&(d="asc"),f+g==c.length-1&&(d="desc");var m=M[d];m||(m=[],M[d]=m),m.push(b)}});var N=Object.keys(M),O=1==N.length?N[0]:null;O&&E.sort(function(c,a){return"number"==L?"asc"==O?parseFloat(c)-parseFloat(a):parseFloat(a)-parseFloat(c):"date"==L?"asc"==O?new Date(c).getTime()-new Date(a).getTime():new Date(a).getTime()-new Date(c).getTime():"asc"==O?c.localeCompare(a):a.localeCompare(c)}),F.forEach(function(a){var b=a.sumData,c=[];for(E.forEach(function(a){for(var d,e=0;e<b.length;e++){var f=b[e].key,g=b[e].value;if(f==a){d=g;break}}c.push({key:a,value:d})});0<c.length;){var d=c[0].value;if(!isNaN(d))break;isNaN(d)&&c.shift()}a.sumData=c});var P=[];F.forEach(function(a,b){var c=a.sumData,e=[];c.forEach(function(a){e.push({key:a.key,value:a.value})}),c.forEach(function(a,b){var f=a.key,g=a.value;if(isNaN(g)){for(var h,i=b-1;-1<i;i--)if(h=c[i].value,!isNaN(h)){g=h;break}isNaN(g)&&(g=0)}for(var l,m,o=0;o<P.length;o++)m=P[o].sumData,m.every(function(a){var b=a.key,c=a.value;return!!(b!=f||isNaN(c))||(l=c,!1)});isNaN(l)||(g+=l),e[b].value=g}),P.push({lineConfig:a.lineConfig,sumData:e})}),F=P}var Q=[],R=[];F.forEach(function(b){var a=b.sumData;E.forEach(function(b){var c=Math.min;b instanceof Date&&!C?b+="":!isNaN(b)&&!C&&(b+="");for(var e=0;e<a.length;e++){var f=a[e],g=f.key;if(g===b){for(var h,k=f.value,l=!1,m=0;m<Q.length;m++)h=Q[m],h.key==b&&(l=!0,h.value=c(h.value,k));l||Q.push({key:b,value:k});for(var h,l=!1,m=0;m<R.length;m++)h=R[m],h.key==b&&(l=!0,h.value=d(h.value,k));l||R.push({key:b,value:k})}}})});var S=A(g,x,w,"key","value",R,Q,c),T=S.margin;if(T){var U=T.left,V=T.right,W=T.top,X=T.bottom;if(y){var Y=0,Z=0;m.forEach(function(a,b){if(a.line){var c=a.line.getLabel();if(c||(c="Series "+(b+1)),c){var e=g.append("text").attr("dy",".35em").attr("text-anchor","start").text(c),f=e.node().getBBox();e.remove();var h=d(f.width+8,60)+5;Z=f.height,Y=d(h,Y)}}}),V=Y+5,0<Z&&(W=d(Z/2,W))}(0<W||0<X||0<U||0<V)&&(w-=W+X,x-=U+V,g.selectAll("*").remove(),g.attr("transform","translate("+U+","+W+")"),S=A(g,x,w,"key","value",R,Q,c)),T={top:W,right:V,bottom:X,left:U}}j=S.x,b=S.y,h=S.xAxis,k=S.yAxis;var $=[];for(let a=0;a<F.length;a++)$.push({area:null,line:null,line2:null,tag:null,point:null});var _=g.append("g");_.attr("name","fill");for(let a=F.length-1;-1<a;a--){var G=F[a].sumData;let d=F[a].lineConfig.fill,e=d.color,f=d.startOpacity,g=d.endOpacity;var I=F[a].lineConfig.smoothing;let h=z(G[0].key);var aa=function(a){return"date"===h?j(new Date(a.key)):j(a.key)},ba=function(a){var d=parseFloat(a.value);return"logarithmic"===c.scaling?b(d+1):b(d)};if(0===f&&0===g)continue;let i="fill-gradient-"+a;q(e,f,g,i,_),$[a].area=_.append("path").datum(G).attr("fill",`url(#${i})`).attr("d",d3.area().x(aa).y0(w).y1(ba))}var ca=g.append("g"),da=g.append("g");da.attr("name","circles"),ca.attr("name","lines");for(let a=0;a<F.length;a++){var G=F[a].sumData;let b=F[a].lineConfig,c=b.point,d=b.color,e=b.style,f=b.width,g=b.opacity,h=c.radius,i=c.color;var I=b.smoothing,ea=function(){return I&&"spline"===I?d3.line().x(aa).y(ba).curve(d3.curveMonotoneX):d3.line().x(aa).y(ba)};if($[a].line=ca.append("path").datum(G).attr("fill","none").attr("stroke",d).attr("stroke-width",f).attr("opacity",g).attr("stroke-dasharray",function(a){return"dashed"===e?"5, 5":"dotted"===e?"0, 5":void 0}).attr("stroke-linecap",function(a){if("dotted"===e)return"round"}).attr("d",ea()),$[a].line2=ca.append("path").datum(G).attr("dataset",a).attr("fill","none").attr("stroke","#ff0000").attr("stroke-width",10).attr("opacity",0).attr("d",ea()).on("click",function(a){var b=parseInt(d3.select(this).attr("dataset"));r($[b]),l.onClick(this,b,a)}),h&&($[a].point=da.selectAll("points").data(G).enter().append("circle").attr("dataset",a).attr("fill",i).attr("stroke","none").attr("cx",aa).attr("cy",ba).attr("r",h).on("click",function(a){var b=parseInt(d3.select(this).attr("dataset"));r($[b]),l.onClick(this,b,a)})),y){var fa=b.label;fa||(fa="Series "+(a+1));var ga=$[a].line2;$[a].tag=p(G,d,fa,ga)}}var ha=a.animationSteps;if(!isNaN(ha)&&50<ha){let a=ca.selectAll("path"),d=da.selectAll("circle"),e=_.selectAll("path"),f=d3.min(Q,a=>parseFloat(a.value)),g="logarithmic"===c.scaling?b(f):b(0);if(a.attr("d",d3.line().x(aa).y(g)),d.attr("cx",aa).attr("cy",g),e.attr("d",d3.area().x(aa).y0(w).y1(g)),a.transition().duration(ha).attr("d",ea()),d.transition().duration(ha).attr("cx",aa).attr("cy",ba),e.transition().duration(ha).attr("d",d3.area().x(aa).y0(w).y1(ba)),y)for(var ia=0;ia<$.length;ia++){var ja=$[ia].tag.poly,ka=$[ia].tag.text,la=ja.attr("transform"),ma=ka.attr("transform"),na=la.slice(10).split(",")[0],oa=ma.slice(10).split(",")[0];ja.attr("transform","translate("+na+","+(w-9.6)+")"),ka.attr("transform","translate("+oa+","+w+")"),ja.transition().duration(ha).attr("transform",la),ka.transition().duration(ha).attr("transform",ma)}}(a.xGrid||a.yGrid)&&B(g,j,b,w,x,a.xGrid,a.yGrid)}};this.onClick=function(a,b,c){};var p=function(e,f,i,k){var l=e[e.length-1],m=l.key,n=l.value,o=z(e[0].key);if("date"===o)var p=j(new Date(m));else var p=j(m);var q="logarithmic"===c.scaling?b(n+1):b(n),r=g.append("text").attr("dy",".35em").attr("text-anchor","start").text(i),s=r.node().getBBox();r.remove();var t=d(s.width+8,60),u=s.height,h=u/2,a=[[0,0],[t,0],[t,u],[0,u],[-h,h]],v=g.append("polygon").attr("points",a.join(" ")).attr("transform","translate("+(p+h)+","+(q-h)+")").style("fill",f).on("click",function(a){k.dispatch("click")}),w=g.append("text").attr("transform","translate("+(p+h+4)+","+q+")").attr("dy",".35em").attr("text-anchor","start").style("fill","#fff").text(i).on("click",function(a){k.dispatch("click")});return{poly:v,text:w}},q=function(a,b,c,d,e){null==b&&(b=0),null==c&&(c=0),e.append("defs").append("linearGradient").attr("id",d).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data([{offset:"0%",color:a,opacity:b},{offset:"100%",color:a,opacity:c}]).enter().append("stop").attr("offset",a=>a.offset).attr("stop-color",a=>a.color).attr("stop-opacity",a=>a.opacity)},r=function(a){if(a){a.line.raise(),a.line2.raise(),a.point&&a.point.raise();var b=a.tag;if(b){var c=b.poly.node().parentNode,d=b.poly.node().cloneNode(!0),e=b.text.node().cloneNode(!0);b.poly.remove(),b.text.remove(),c.appendChild(d),c.appendChild(e),a.tag.poly=d3.select(d),a.tag.text=d3.select(e)}}},s=function(a,b,c){if("movingAverage"===a){if(!isNaN(b)&&0<b){function a(a,b){let c=[a[0]],d=0;for(let e=1;e<b;e++)d+=a[e],c.push(d/e);for(let d,e=b;e<a.length;e++)d=d3.mean(a.slice(e-b/2,e+b/2)),c.push(d);return c}var d=c.map(a=>a.value);let e=a(d,b);c.forEach(function(a,b){a.value=e[b]})}}else if("kde"===a){var d=c.map(a=>a.value),e=d.length,f=d3.extent(d),g=f[0],h=f[1],k=d.reduce((c,a)=>c+a,0),l=(h-g)/e;l=Math.round(l);for(var m=[],n=0;n<d.length;n++)for(var o=0;o<d[n];o++)m.push(n+.5),o+=l;for(var p,q=[],r=t(b),n=0;n<d.length;n++)p=d3.mean(m,function(a){return r(n-a)}),q.push([n,p]);c.forEach(function(a,b){a.value=q[b][1]*k})}},t=function(a){return b=>1>=Math.abs(b/=a)?.75*(1-b*b)/a:0},u=javaxt.dhtml.utils.merge,v=javaxt.dhtml.utils.onRender,w=bluewave.chart.utils.initChart,z=bluewave.chart.utils.getType,A=bluewave.chart.utils.drawAxes,B=bluewave.chart.utils.drawGridlines;(function(){l.setConfig(c),w(a,function(a,b){e=a,f=b})})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.MapChart=function(a,b){var d,e,f,g,i,j,k,l,c=Math.PI,m=this,h={style:{backgroundColor:"#fff"}},n=!1,o=[],p={},q="Mercator",r=function(){b=G(b,h),J(a,function(a,b){d=a,e=b}),d.call(d3.zoom().scaleExtent([1,1]).on("zoom",u)),d.on("click",function(a){var b=m.getProjection();if(b){var c=d3.mouse(this),d=b.invert(c);m.onMouseClick(d[1],d[0],a)}})};this.addPoints=function(a,b){o.push({type:"points",features:a,config:b})},this.addLines=function(a,b){o.push({type:"lines",features:a,config:b})},this.addPolygons=function(a,b){o.push({type:"polygons",features:a,config:b})},this.addLabels=function(a,b){o.push({type:"labels",features:a,config:b})},this.addGrid=function(a){o.push({type:"grid",features:null,config:a})},this.setBackgroundColor=function(a){b.style.backgroundColor=a,a&&l&&l.attr("fill",a)},this.getProjection=function(){return f},this.setProjection=function(a){q=a,f=d3["geo"+a]()},this.getCentroid=function(a){if(!a)return null;f||m.setProjection("Mercator");var b=d3.geoPath(f);if(H(a)){var c="Point";H(a[0])&&(c="Polygon"),a={type:"Feature",geometry:{type:c,coordinates:a}}}var d=b.centroid(a);return d=f.invert(d),d},this.onRecenter=function(a,b){},this.onRedraw=function(){},this.onMouseClick=function(a,b,c){},this.enablePan=function(){n=!1},this.disablePan=function(){n=!0},this.clear=function(){s(),f=g=i=j=k=null,o=[]};var s=function(){e.node().innerHTML="",e.attr("transform",null)};this.resize=function(){e},this.setCenter=function(b,d){var e=a.offsetWidth,g=a.offsetHeight;d||(d=e/2/c),f.rotate([-b[0],0]).center([0,b[1]]).scale(d).translate([e/2,g/2])},this.getMidPoint=function(a,b,c){f||m.setProjection("Mercator"),isNaN(b)&&(b=0),c="south"===c?1:-1;var d=a.slice();d[0]=f(d[0]),d[1]=f(d[1]),0>d[1][0]-d[0][0]&&d.reverse();var e=(d[0][0]+d[1][0])/2,g=(d[0][1]+d[1][1])/2,h=d[1][0]-d[0][0],i=d[1][1]-d[0][1],j=[-i*b*c,h*b*c],k=[j[0]+e,j[1]+g];return k=f.invert(k),k},this.update=function(a){s();var b=d.node().parentNode;I(b,function(){t(b),a&&a()})};var t=function(a){s();var d=a.offsetWidth,e=a.offsetHeight,h=parseFloat(b.lat),l=parseFloat(b.lon);return isNaN(h)&&(h=0),isNaN(l)&&(l=0),f||m.setProjection("Mercator"),"AlbersUsa"===q?(f.translate([d/2,e/2]),void z()):void(f.scale(d/2/c).rotate([-l,0]).center([0,h]).translate([d/2,e/2]),g=f.scale(),i=f.translate(),j=f.rotate(),k=f.center(),v(p),z())},u=function(){var a=m.getProjection();if(a&&!n){var b=javaxt.dhtml.utils.getRect(d.node()),c=b.width,e=b.height,f=d3.event.transform,g=c/2-f.x,h=e/2-f.y,l=a.invert([g,h]),o=d3.scaleLinear().domain([0,e]).range([0,180]),p=d3.scaleLinear().domain([0,c]).range([0,360]),q=i[0]-f.invertX(i[0]),r=i[1]-f.invertY(i[1]),s=o(r)/2+k[1],t=p(q)+j[0];a.rotate([t,j[1],j[2]]),a.center([0,s]),z(),m.onRecenter(l[1],l[0])}};this.getExtent=function(){var a=m.getProjection();if(a){var b=javaxt.dhtml.utils.getRect(d.node()),c=b.width,e=b.height,f=a.invert([0,0]),g=a.invert([c,e]);return{left:f[0],right:g[0],top:f[1],bottom:g[1]}}},this.setExtent=function(a,b,c){p.upperLeft=a,p.lowerRight=b,f?(v(p),c&&c()):m.update(function(){v(p),c&&c()})};var v=function(a,b=10){var c=Math.abs;if(!(0>b||isNaN(b))&&f&&"AlbersUsa"!==q&&a.upperLeft&&a.lowerRight){var e=a.upperLeft,g=a.lowerRight,i=f.scale(),j=m.getExtent(),k=javaxt.dhtml.utils.getRect(d.node()),l=k.width,n=k.height;"Albers"==q&&f.parallels([g[1]+c(g[1]*(1/6)),e[1]-c(e[1]*(1/6))]);var h=f([j.left,j.top]),o=f([j.right,j.bottom]),p=c(h[0]-o[0]),r=c(h[1]-o[1]);f(e)[0]>f(g)[0]&&f.rotate([-e[0]-180,0]);var s,t=f(e),u=f(g),w=c(t[0]-u[0]);s=w/p,f.scale(i/s),t=f(e),u=f(g);var x=[t[0]+l/2,t[1]+n/2],y=f.invert(x);f.rotate([-y[0],0]).center([0,y[1]]),y=m.getMidPoint([e,g]);var z=m.getExtent(),A=c(g[1]-z.bottom);if(g[1]<z.bottom){let a=z.top-z.bottom,b=A/a;b++;let c=f.scale();f.scale(c/b)}f.rotate([-y[0],0]).center([0,y[1]]),v(a,--b)}},z=function(){s();var a=e.append("g");a.attr("name","background"),l=a.append("rect").attr("width","100%").attr("height","100%"),b.style.backgroundColor&&l.attr("fill",b.style.backgroundColor);var c=e.append("g");c.attr("name","layers");var d=d3.geoPath(f);o.forEach(function(a,b){a.config||(a.config={});var e=a.config.name;e||(e="layer"+b);var f=c.append("g");f.attr("name",e),"points"===a.type?A(a,f,d):"lines"===a.type&&B(a,f,d),"polygons"===a.type?D(a,f,d):"labels"===a.type?E(a,f,d):"grid"===a.type&&C(a,f,d)})},A=function(a,b,c){a.config||(a.config={});var d=a.config,e=a.config.style;e||(e={});var g;!0===d.showTooltip&&(g=K());var h=!1;(g||d.onClick)&&(h=!0);var i=e.fill;i||(i="red");var j=e.opacity;j||(j=1);var k=parseInt(e.radius);isNaN(k)&&(k=3),0>k&&(k=1);var l=parseFloat(e.outlineWidth);isNaN(l)&&(l=1);var n=e.outlineColor,o=b.selectAll("*").data(a.features).enter().append("circle").attr("r",function(a){return"function"==typeof e.radius?e.radius(a):k}).attr("transform",function(a){var b=F(a);return b&&(b=f(b)),b?"translate("+b+")":""}).attr("opacity",j).style("fill",i).attr("stroke",n).attr("stroke-width",l).attr("stroke-opacity",j).on("click",function(b,c,f){if(d.onClick){var g=d3.event;d.onClick.apply(m,[{feature:b,element:f[c],layer:a,event:g}])}});a.elements=o},B=function(a,b,c){a.config||(a.config={});var d=a.config.style;d||(d={});var e=parseInt(d.width);isNaN(e)&&(e=1);var g=d.lineStyle;g||(g="solid");var h=d.smoothing;h&&"none"!==h||(h="curveLinear");var i=d.color;i||(i="red");var j=d.opacity;j||(j=1);var k=b.selectAll("*").data(a.features).enter().append("path").attr("d",function(a){var b=d3.line().curve(d3[h]),c=a.map(a=>f(a));return b(c)}).attr("fill","none").attr("opacity",j).style("stroke",i).style("stroke-width",e).attr("stroke-dasharray",function(a){if("dashed"===g)return"10, 10";return"dotted"===g?"0, 10":void 0}).attr("stroke-linecap",function(a){if("dotted"===g)return"round"});a.elements=k},C=function(a,b,c){a.config||(a.config={});var d=a.config.style;d||(d={});var e=parseInt(d.width);isNaN(e)&&(e=.5);var f=d.lineStyle;f||(f="solid");var g=d.color;g||(g="gray");var h=d.opacity;h||(h=.5);var i=d.longSteps;i||(i=10);var j=d.latSteps;j||(j=10);var k=d3.geoGraticule().step([i,j]),l=b.selectAll("*").data([k()]).enter().append("path").attr("d",c).attr("fill","none").attr("opacity",h).style("stroke",g).style("stroke-width",e).attr("stroke-dasharray",function(a){if("dashed"===f)return"10, 10";return"dotted"===f?"0, 10":void 0}).attr("stroke-linecap",function(a){if("dotted"===f)return"round"});a.elements=l},D=function(a,b,c){a.config||(a.config={});var f=a.config,g=a.config.style;g||(g={});var h;!0===f.showTooltip&&(h=K());var i=!1;(h||f.onClick)&&(i=!0);var j=function(b,c,e){var g=b;if(h){var d=m.getTooltipLabel(g.data),j=getHighestElements(),k=j.zIndex;j.contains(h.node())||k++,h.html(d).style("opacity",1).style("display","block").style("z-index",k)}var l=d3.select(this);i&&(l.transition().duration(100),l.attr("opacity","0.8")),f.onMouseOver&&f.onMouseOver.apply(m,[{feature:b,element:l,layer:a}])},k=function(){var a=d3.event;h&&h.style("top",a.clientY+"px").style("left",a.clientX+20+"px")},l=function(b,c,d){h&&h.style("opacity",0).style("display","none");var e=d3.select(this);i&&(e.transition().duration(100),e.attr("opacity","1")),f.onMouseLeave&&f.onMouseLeave.apply(m,[{feature:b,element:e,layer:a}])},n=g.fill;n||(n="#DEDDE0");var o=g.stroke;o||(o="#fff");var p=b.selectAll("*").data(a.features).enter().append("path").attr("d",c).attr("fill",function(a){return"function"==typeof g.fill?g.fill(a):n}).attr("stroke",o).style("stroke-width",.4).on("mouseover",j).on("mousemove",k).on("mouseleave",l).on("click",function(b,c,d){if(f.onClick){var g=d3.event;f.onClick.apply(m,[{feature:b,element:d[c],layer:a,event:g}])}});a.elements=p},E=function(a,b,c){a.config||(a.config={});var d=a.config,e=a.config.style;e||(e={});var g=parseFloat(e.fontSize);isNaN(g)&&(g=12);var h=e.color;h||(h=e.fill),h||(h="#000");var i=e.textAlign;i||(i="left");var j=b.selectAll("text").data(a.features).enter().append("text").attr("transform",function(a){var b=F(a);if(b){b=f(b);var c=b[0],d=b[1];return isNaN(c)||isNaN(d)?"":`translate(  ${c}, ${d}  )`}return""}).attr("font-size",g).attr("text-anchor",()=>"center"==i?"middle":i).style("fill",h).text(b=>b.properties&&a.config.label?b.properties[a.config.label]:"").on("click",function(b,c,e){d.onClick&&d.onClick.apply(m,[{feature:b,element:e[c],layer:a}])});a.elements=j},F=function(a){if(H(a))return a;return a.geometry?a.geometry.coordinates:null},G=javaxt.dhtml.utils.merge,H=javaxt.dhtml.utils.isArray,I=javaxt.dhtml.utils.onRender,J=bluewave.chart.utils.initChart,K=bluewave.chart.utils.createTooltip;r()};if(!bluewave)var bluewave={};bluewave.chart||(bluewave.chart={}),bluewave.chart.utils={initChart:function(a,b,c){var d;if(a instanceof d3.selection)d=a;else if(a instanceof SVGElement)d=d3.select(a);else{var e=d3.select(a).append("div").classed("svg-container",!0),d=e.append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("height","100%").attr("width","100%").attr("viewBox","0 0 600 400").classed("svg-content-responsive",!0);javaxt.dhtml.utils.onRender(a,function(){var b=a.offsetWidth,c=a.offsetHeight;d.attr("viewBox",`0 0 ${b} ${c}`)})}var f=d.append("g");b&&b.apply(c,[d,f])},drawGridlines:function(a,b,c,d,e,f,g){f&&a.append("g").attr("class","grid").attr("transform","translate(0,"+d+")").call(d3.axisBottom(b).tickSize(-d).tickFormat("")),g&&a.append("g").attr("class","grid").call(d3.axisLeft(c).tickSize(-e).tickFormat(""))},drawLabels:function(a,b,c,d,e,f,g,h){if(b){var i=d;f&&(i+=f.bottom-2),a.append("text").attr("x",e/2).attr("y",i).style("text-anchor","middle").text(g)}if(c){var j=0;f&&(j-=f.left),a.append("text").attr("transform","rotate(-90)").attr("x",0-d/2).attr("y",j).attr("dy","1em").style("text-anchor","middle").text(h)}},drawAxes:function(a,b,c,d,e,f,g,h,i){var j=Math.max,k=Math.min,l=Number.MAX_VALUE;h||(h={});var m,n,o,p,q,s,u,v=bluewave.chart.utils.getType,w=bluewave.chart.utils.getScale,z=bluewave.chart.utils.getDateFormat;let A=v(f[0][d]);"barChart"==i&&"date"==A&&(A="string"),u=w(d,A,[0,b],f,g,null,h.xMin,h.xMax),q=u.scale,o=u.band;let B=v(f[0][e]);"barChart"==i&&"date"==B&&(B="string");var C="logarithmic"===h.scaling?"logarithmic":"linear";u=w(e,B,[c,0],f,g,C),s=u.scale,p=u.band;var D,E=q.domain().length,F=function(a,c){let d=parseInt(b/10);return 0===c||!(c%d)},G=function(a,b){var c,e,f;a.selectAll("text").each(function(a,d,g){var h=g[d].textContent;if("number"===b){if(isNaN(c)&&(c=0,g.forEach(function(a){var b=0==parseFloat(a.textContent)%1;b&&c++})),c==g.length){var i=d3.format(",");g[d].textContent=i(h)}}else if("date"===b){if(e||(e={},f={},g.forEach(function(a){var b=new Date(a.textContent),c=b.getFullYear(),g=b.getDate();e[c+""]=!0,f[g+""]=!0}),e=Object.keys(e),f=Object.keys(f)),1<e.length){if(1==f.length){var i=d3.timeFormat("%m/%y");h=i(a)}}else if(1==f.length){var i=d3.timeFormat("%b");h=i(a)}0===h.indexOf("0")&&(h=h.substring(1)),h=h.replaceAll("/0","/"),g[d].textContent=h}})},H=function(a,b){var c;if("date"===a)c=d3.timeFormat(z(b));else if("number"===a){c=d3.format(".1f")}return c},I=function(a){var b=[];return a.selectAll("text").each(function(){var a=javaxt.dhtml.utils.getRect(this);b.push({left:a.x,right:a.x+a.width,top:a.y,bottom:a.y+a.height})}),b},J=function(a,c=0){var d=!1;a.forEach(function(a){a.top-=c,a.left-=c,a.right+=c,a.bottom+=c});for(var e,f=0;f<a.length;f++){e=a[f];for(var g=0;g<a.length;g++)if(g!==f){var h=a[g];if(javaxt.dhtml.utils.intersects(e,h)){d=!0;break}}if(d)break}return d},K=H(A,h.xFormat);if(!0===h.xTicks||!1===h.xTicks||(D=h.xTicks),m=a.append("g").attr("transform","translate(0,"+c+")"),!1===h.xTicks)m.call(d3.axisBottom(q).ticks(D).tickSize([0,0])),m.selectAll("text").each(function(){d3.select(this).remove()}),m.selectAll("path").each(function(){d3.select(this).remove()});else{m.call(d3.axisBottom(q).ticks(D).tickValues(10*E<b?null:q.domain().filter(F)).tickFormat(K)),h.xFormat||G(m,A);var L=I(m),M=J(L,0);M&&m.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end")}var N=H(B,h.yFormat);if(n=a.append("g"),!1===h.yTicks)n.call("linear"===C?d3.axisLeft(s).tickFormat(N).tickSize([0,0]):d3.axisLeft(s).ticks(10,",").tickFormat(N).tickSize([0,0])),n.selectAll("text").each(function(){d3.select(this).remove()}),n.selectAll("path").each(function(){d3.select(this).remove()});else{n.call("linear"===C?d3.axisLeft(s).tickFormat(N):d3.axisLeft(s).ticks(10,",").tickFormat(N)),h.yFormat||G(n,B);var O=I(n),P=J(O,-1);if(P){let a=n.selectAll("text").size();n.selectAll("text").attr("visibility",function(b,c){return a%2?0==(c+1)%2?"hidden":"visible":0==c%2?"hidden":"visible"})}}var Q=javaxt.dhtml.utils.getRect(m.node()),R=javaxt.dhtml.utils.getRect(n.node()),S=l,T=0,U=l,V=0;m.selectAll("line").each(function(){var a=javaxt.dhtml.utils.getRect(this);S=k(a.x,S),T=j(a.x+a.width,T)}),n.selectAll("line").each(function(){var a=javaxt.dhtml.utils.getRect(this);U=k(a.y,U),V=j(a.y+a.height,V)}),n.selectAll("path").each(function(){var a=javaxt.dhtml.utils.getRect(this);U=k(a.y,U),V=j(a.y+a.height,V)});var W=Q.left-S;0>W&&(W=0);var X=Q.right-T;0>X&&(X=0),W=j(R.width,W);var Y=U-R.top,Z=Q.height,$=16,_=h.xLabel;if(_){var aa=m.append("text").attr("x",(Q.right-Q.left)/2).attr("y",Z+$).attr("class","chart-axis-label").style("text-anchor","middle").text(_),ba=javaxt.dhtml.utils.getRect(aa.node());Z+=ba.height+$}var ca=h.yLabel;if(ca){var aa=n.append("text").attr("transform","rotate(-90)").attr("x",-(R.height/2)).attr("y",-(R.width+$)).attr("class","chart-axis-label").style("text-anchor","middle").text(ca),ba=javaxt.dhtml.utils.getRect(aa.node());W=j(W+(ba.width+$),W)}return{xAxis:m,yAxis:n,xBand:o,yBand:p,x:q,y:s,margin:{top:Y,right:X,bottom:Z,left:W}}},getScale:function(a,b,c,d,e,f,g,h){let i,j;switch(b){case"string":i=d3.scaleBand().domain(d.map(function(b){return b[a]})).range(c).padding(.2);break;case"date":var k=[new Date(d3.min(d,b=>b[a])),new Date(d3.max(d,b=>b[a]))];d.map(b=>(b[a]=new Date(b[a]),b)),i=d3.scaleTime().domain(k).rangeRound(c),j=d3.scaleBand().domain(d3.timeDay.range(...i.domain())).rangeRound(c).padding(.2);break;default:var l,m;if(!e){var n=d3.extent(d,function(b){return parseFloat(b[a])});l=0,m=n[1]}else l=d3.min(e,function(b){return parseFloat(b[a])}),m=d3.max(d,function(b){return parseFloat(b[a])});l===m&&(m=l+1),f||(f="linear"),"linear"===f?(0<l&&(l=0),!isNaN(g)&&(l=g),!isNaN(h)&&(m=h),i=d3.scaleLinear().domain([l,m])):"logarithmic"==f&&(1>l&&(l=1),i=d3.scaleLog().domain([l,m+1])),i.range(c);}return{scale:i,band:j}},extendScale:function(a,b,c,d){var f,g,e=Math.ceil,h=a.scale.domain(),i=bluewave.chart.utils.getType;if(d||(d=i(h[0])),c||(c=1),"date"===d){let a=h[1],d=h[0],e=a.getTime(),i=(a-d)*c,j=new Date(e+i);f=d3.scaleTime().domain([d,j]).rangeRound(b),g=d3.scaleBand().domain(d3.timeDay.range(...f.domain())).rangeRound(b).padding(.2)}else if("string"===d){let a=e(h.length*c),d="",g=h;for(let b=0;b<a;b++)d+=" ",g.push(d);f=d3.scaleBand().domain(g).range(b).padding(.2)}else{let a=[h[0],h[1]*(c+1)];f=d3.scaleLinear().domain(a).range(b)}return{scale:f,band:g}},reDrawAxes:function(a,b,c,d,e,f){b&&(b.remove(),b=a.append("g").attr("transform","translate(0,"+f+")").call(d3.axisBottom(c))),d&&(d.remove(),d=a.append("g").call(d3.axisLeft(e)))},getType:function(a){var b=javaxt.dhtml.utils.isArray(a)?a:[a],c=function(a){let b;switch(typeof a){case"string":b=a.match(/^[\+\-]?\d*\.?\d+(?:[Ee][\+\-]?\d+)?$/)?"number":Date.parse(a)?"date":"string";break;case"number":b="number";break;case"object":b="date";break;default:}return b},d=0,e=0,f=0,g=0;return b.forEach(function(a){var b=c(a);"string"===b?f++:"number"===b?d++:"date"===b?e++:g++}),e==b.length?"date":d==b.length?"number":f==b.length?"string":null},getDateFormat:function(a){var b="%m/%d/%Y";return a&&(b=a,b=b.replace("YYYY","%Y"),b=b.replace("YY","%y"),b=b.replace("MMMM","%B"),b=b.replace("MM","%m"),b=b.replace("M","%m"),b=b.replace("DD","%d"),b=b.replace("D","%d"),b=b.replace("A","%p"),b=b.replace("dddd","%A"),b=b.replace("HH","%H"),b=b.replace("h","%I"),b=b.replace("mm","%M"),b=b.replace("ss","%S")),b},getColorRange:function(a,b){var c=[];if(2<b.length){var d=b.length-1,e=a/d,f=0==e%1;f||(e=Math.floor(e));for(var g=0;g<b.length-1;g++)for(var h=[b[g],b[g+1]],k=d3.scaleLinear().domain([0,e-1]).range(h),l=0;l<e;l++)c.push(d3.color(k(l)).formatHex())}else for(var k=d3.scaleLinear().domain([0,a-1]).range(b),g=0;g<a;g++)c.push(d3.color(k(g)).formatHex());return c},getNaturalBreaks:function(a,b){var c=Math.min;function d(a,b,c){var d=a.length-1,e=[],f=c;for(e[c]=a[a.length-1],e[0]=a[0];1<f;)e[f-1]=a[b[d][f]-2],d=b[d][f]-1,f--;return e}var e=[...new Set(a)].length;if(b=c(b,e-1),b>a.length)return null;a=a.slice().sort(function(c,a){return c-a});var f=function c(a,b){var d,e,f=[],g=[],h=0;for(d=0;d<a.length+1;d++){var k=[],n=[];for(e=0;e<b+1;e++)k.push(0),n.push(0);f.push(k),g.push(n)}for(d=1;d<b+1;d++)for(f[1][d]=1,g[1][d]=0,e=2;e<a.length+1;e++)g[e][d]=1/0;for(var o=2;o<a.length+1;o++){for(var p=0,q=0,r=0,s=0,t=1;t<o+1;t++){var u=o-t+1,v=a[u-1];if(r++,p+=v,q+=v*v,h=q-p*p/r,s=u-1,0!==s)for(e=2;e<b+1;e++)g[o][e]>=h+g[s][e-1]&&(f[o][e]=u,g[o][e]=h+g[s][e-1])}f[o][1]=1,g[o][1]=h}return{lower_class_limits:f,variance_combinations:g}}(a,b),g=f.lower_class_limits,h=[];try{h=d(a,g,b),h.unshift(0),h=[...new Set(h)]}catch(a){console.log(a)}return h},createTooltip:function(){var a=bluewave.chart.utils.Tooltip,b=javaxt.dhtml.utils.getHighestElements;return a||(a=bluewave.chart.utils.Tooltip=d3.select(document.body).append("div").style("opacity",0).style("top",0).style("left",0).style("display","none").attr("class","tooltip"),a.show=function(){var c=b(),d=c.zIndex;c.contains(a.node())||d++,a.style("opacity",1).style("display","block").style("z-index",d)},a.hide=function(){a.style("opacity",0).style("display","none")}),a}};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.TreeMapChart=function(a,b){var c,d,e=this,f={keyLabel:!0,groupLabel:!0,valueLabel:!0,key:"name",value:"value",groupBy:null,colors:["#0d90f2","#14e8eb","#1ce35b","#402D54","#D18975","#8FD175","#cc0a12","#b8eb14"]},g=[];this.setConfig=function(a){b=a?k(a,f):f},this.clear=function(){d&&d.selectAll("*").remove()},this.update=function(a,b){e.clear(),e.setConfig(a);var d=c.node().parentNode;l(d,function(){j(b)})};var h=(a,b,c)=>{if(Array.isArray(a))for(const d of a){const a=h(d,b,c);if(a)return d}else{if(a.hasOwnProperty(b)&&a[b]===c)return a;for(const d of Object.keys(a))if("object"==typeof a[d]){const e=h(a[d],b,c);if(null!==e&&"undefined"!=typeof e)return e}return null}},i=function(a){g=[];var c;if(null!==b.groupBy){function d(a,b,c){return c.indexOf(a)===b}a.forEach(a=>{var c=a[b.groupBy];g.push(c)}),c=g.filter(d)}a.forEach(a=>{var c=a[b.value];a[b.value]=parseFloat(c)});var d={children:[],name:"all"};if(null!==b.groupBy)c.forEach(c=>{d.children.push({name:c,children:[],colname:"level2"});var e=h(d.children,"name",c);a.forEach(a=>{var d=a[b.key],f=a[b.groupBy],g=a[b.value];if(c===f)if("undefined"!=typeof h(e.children,"name",d)){var i=h(e.children,"name",d);i.value+=g}else e.children.push({name:d,group:f,colname:"level3",value:g})})});else{d.children.push({name:"",children:[],colname:"level2"});var e=h(d.children,"name","");a.forEach(a=>{var c=a[b.key],d=a[b.value],f="";if("undefined"!=typeof h(e.children,"name",c)){var g=h(e.children,"name",c);g.value+=d}else e.children.push({name:c,group:f,colname:"level3",value:d})})}return d},j=function(a){var e=b,f=javaxt.dhtml.utils.getRect(c.node()),j=f.width,k=f.height;a=i(a);var l=d3.hierarchy(a).sum(a=>a.value);if(d3.treemap().size([j,k]).paddingTop(28).paddingRight(7).paddingInner(3)(l),"undefined"!=typeof g)var m=d3.scaleOrdinal().domain(g).range(e.colors);else var m=d3.scaleOrdinal().range(e.colors);var n=function(b,c){var d=h(a.children,"name",c),e=[];d.children.forEach(a=>{e.push(a.value)});var f=d3.scaleLinear().domain([d3.min(e),d3.max(e)]).range([.5,1]);return f(b)};d.selectAll("rect").data(l.leaves()).enter().append("rect").attr("x",a=>a.x0).attr("y",a=>a.y0).attr("width",a=>a.x1-a.x0).attr("height",a=>a.y1-a.y0).style("stroke","black").style("fill",a=>m(a.parent.data.name)).style("opacity",a=>n(a.data.value,a.data.group)),e.keyLabel&&d.selectAll("text").data(l.leaves()).enter().append("text").attr("x",a=>a.x0+5).attr("y",a=>a.y0+20).text(a=>a.data.name).attr("font-size","19px").attr("fill","white"),e.valueLabel&&d.selectAll("vals").data(l.leaves()).enter().append("text").attr("x",a=>a.x0+5).attr("y",a=>a.y0+35).text(a=>a.data.value).attr("font-size","11px").attr("fill","white"),e.groupLabel&&d.selectAll("titles").data(l.descendants().filter(a=>1==a.depth)).enter().append("text").attr("x",a=>a.x0).attr("y",a=>a.y0+21).text(a=>a.data.name).attr("font-size","19px").attr("fill",a=>m(a.data.name)),d.append("text").attr("x",0).attr("y",14).attr("font-size","19px").attr("fill","grey")},k=javaxt.dhtml.utils.merge,l=javaxt.dhtml.utils.onRender,m=bluewave.chart.utils.initChart;(function(){e.setConfig(b),m(a,function(a,b){c=a,d=b})})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.BarChart=function(a,b){var c,d,e,f,g,h,i,j=this,k={layout:"vertical",animationSteps:1500,stackValues:!1,colors:d3.schemeCategory10},l=[];this.setConfig=function(a){b=a?p(a,k):k},this.getBarColor=function(a,c,d){var e=b.colors,f=b["barColor"+c];return f||(f=e[c%e.length],b["barColor"+c]=f),f},this.getTooltipLabel=function(a,b,c){return a.key+"<br/>"+a.value},this.getXAxis=function(){return h},this.getYAxis=function(){return i},this.clear=function(){d&&d.selectAll("*").remove()},this.addLine=function(a,b,c,d){l.push({line:a,data:b,xAxis:c+"",yAxis:d+""})},this.update=function(a,b){j.clear(),1<arguments.length?j.setConfig(a):b=arguments[0];var d=c.node().parentNode;q(d,function(){m(b)})};var m=function(a){var k=b,m=javaxt.dhtml.utils.getRect(c.node()),p=m.width,q=m.height,r=q,w=p;e=d.append("g"),e.attr("width",p).attr("height",q);var x,y,z=k.layout,A=!0===k.stackValues,B=k.barType;if("histogram"===B?(x=k.values,y=x):"horizontal"===z?(y=k.xAxis,x=k.yAxis):(x=k.xAxis,y=k.yAxis),null!==x&&void 0!==x&&null!==y&&void 0!==y){var C=a,D=d3.merge(C),E=d3.nest().key(function(a){return a[x]}).rollup(function(a){return d3.sum(a,function(a){return parseFloat(a[y])})}).entries(D);if(0<l.length){let a=d3.max(E,a=>parseFloat(a.value));l.forEach(function(b){let c=b.data,e=b.xAxis,f=b.yAxis,g=d3.max(c,a=>parseFloat(a[f]));g>a&&(E=d3.nest().key(function(a){return a[e]}).rollup(function(a){return d3.sum(a,function(a){return parseFloat(a[f])})}).entries(c))})}var F=k.sort;F&&E.sort(function(c,a){return d3[F](c.value,a.value)});var G=k.group;if(null!==G&&void 0!==G&&""!==G){var H=d3.nest().key(function(a){return a[G]}).entries(a[0]);A||(E=d3.nest().key(function(a){return a[x]}).rollup(function(a){return d3.max(a,function(a){return parseFloat(a[y])})}).entries(D));let b=[];H.forEach(function(a){b.push(a.values)}),C=b}else A=!1;var I=[];for(let a=0;a<C.length;a++){let b=k[`xAxis${a+1}`],c=k[`yAxis${a+1}`];if(b&&c||G||"histogram"===B||!(0<a)){k.hasOwnProperty(`xAxis${a+1}`)&&k.hasOwnProperty(`yAxis${a+1}`)&&(x=b,y=c);var J=d3.nest().key(function(a){return a[x]}).rollup(function(a){return d3.sum(a,function(a){return a[y]})}).entries(C[a]);I.push(J)}}var K,L,M,N;"histogram"===B?(M="key",N="key","vertical"===z?(K="Frequency",L=k.xAxis):"horizontal"===z&&(K=k.xAxis,L="Frequency")):"vertical"===z?(M="key",N="value",K=k.yAxis,L=k.xAxis):"horizontal"===z&&(M="value",N="key",K=k.xAxis,L=k.yAxis);var O=s(e,w,r,M,N,E,null,k,"barChart"),P=O.margin;if(P){var Q=P.left,R=P.right,S=P.top,T=P.bottom;(0<S||0<T||0<Q||0<R)&&(r-=S+T,w-=Q+R,e.selectAll("*").remove(),e.attr("transform","translate("+Q+","+S+")"),O=s(e,w,r,M,N,E,null,k,"barChart")),P={top:S,right:R,bottom:T,left:Q}}f=O.x,g=O.y,h=O.xAxis,i=O.yAxis,q-=P.top+P.bottom,p-=P.left+P.right;var U={};for(let a=0;a<C.length;a++){var J=I[a];let b=parseFloat(k["fillOpacity"+a]);if((isNaN(b)||0>b||1<b)&&(b=1),A){let c=v(J[0].key);"date"==c&&(c="string");let h=function(a){return"date"===c?f(new Date(a.key)):f(a.key)},i=function(a){var b=parseFloat(a.value);return g(b)},j=function(a){return f.bandwidth?f.bandwidth():h(a)};e.append("g").selectAll("mybar").data(J).enter().append("rect").attr("x",h).attr("y",function(a){var b=a.key,c=a.value;U[b]||(U[b]=0);var d=parseFloat(c);return U[b]+=d,g(U[b])}).attr("height",function(a){return g.bandwidth?g.bandwidth():q-i(a)}).attr("width",function(a){return j(a)}).attr("opacity",b).attr("barID",a)}if(!A)if("histogram"===B){let c=parseInt(k.binWidth);(isNaN(c)||1>c)&&(c=10),f.nice();var V=d3.histogram().value(function(a){return a.key}).domain(f.domain()).thresholds(f.ticks(c)),W=V(J),X=d3.max(W,a=>a.length),Y=d3.scaleLinear().range("vertical"===z?[q,0]:[0,p]);Y.domain([0,X]),"vertical"===z?n(f,Y,r):"horizontal"===z&&n(Y,g,r),e.selectAll("rect").data(W).enter().append("rect").attr("x",function(a){return"vertical"===z?f(a.x0):0}).attr("y",function(a){return"vertical"===z?Y(a.length):q-f(a.x1)/(p/q)}).attr("width",function(a){return"vertical"===z?f(a.x1)-f(a.x0)-.5:Y(a.length)}).attr("height",function(a){return"vertical"===z?q-Y(a.length):(f(a.x1)-f(a.x0))/(p/q)-.5}).attr("opacity",b).attr("barID",a)}else{let c=v(J[0].key);"date"==c&&(c="string");var Z=function(a){return"date"===c?f(new Date(a.key)):f(a.key)},$=function(a){var b=parseFloat(a.value);return g(b)};if(!(g.bandwidth||f.bandwidth))"vertical"===k.layout?!G&&e.selectAll("mybar").data(J).enter().append("rect").attr("x",function(a){return Z(a)-p/J.length/2}).attr("y",$).attr("height",function(a){return q-$(a)}).attr("width",function(a){return p/J.length-5}).attr("opacity",b).attr("barID",function(b,c,d){return G?a:0}):"horizontal"===k.layout&&e.selectAll("mybar").data(J).enter().append("rect").attr("x",function(a){return 0}).attr("y",function(a){return"date"===c?g(new Date(a.key))-q/J.length/2:g(a.key)-q/J.length/2}).attr("height",function(a){return q/J.length-5}).attr("width",function(a){return f(a.value)}).attr("opacity",b).attr("barID",function(b,c,d){return G?a:0});else if("vertical"===k.layout){var _=function(a){return G?f.bandwidth?f.bandwidth()/C.length:Z(a):f.bandwidth?f.bandwidth():Z(a)};e.selectAll("mybar").data(J).enter().append("rect").attr("x",function(b){var c=_(b),d=f.bandwidth?Z(b):0;return G?d+c*a:Z(b)}).attr("y",$).attr("height",function(a){return g.bandwidth?g.bandwidth():q-$(a)}).attr("width",function(a){return _(a)}).attr("opacity",b).attr("barID",function(b,c,d){return G?a:0})}else"horizontal"===k.layout&&e.selectAll("mybar").data(J).enter().append("rect").attr("x",function(a){return 0}).attr("y",function(b){var c=g.bandwidth?g.bandwidth()/C.length:q-g(b.key),d=g.bandwidth?g(b.key):0;return G?d+c*a:g(b.key)}).attr("height",function(a){return G?g.bandwidth?g.bandwidth()/C.length:q-g(a.value):g.bandwidth?g.bandwidth():q-g(a.value)}).attr("width",function(a){return f.bandwidth?f.bandwidth():f(a.value)}).attr("opacity",b).attr("barID",function(b,c,d){return G?a:0})}}var aa=function(a,b){for(var c=[],d=C[a],e=0;e<d.length;e++)d[e][x]===b.key&&c.push(d[e]);return c},ba=e.selectAll("rect");ba.each(function(a,b){let c=d3.select(this),d=parseInt(c.attr("barID"));var e=aa(d,a);c.attr("fill",j.getBarColor(a,d,e))});var ca=k.animationSteps;!isNaN(ca)&&50<ca&&(ba.attr("yInitial",function(){return this.getAttribute("y")}).attr("heightInitial",function(){return this.getAttribute("height")}).attr("widthInitial",function(){return this.getAttribute("width")}),"vertical"===z?(ba.attr("y",q).attr("height",0),ba.transition().duration(ca).attr("y",function(){return parseFloat(this.getAttribute("yInitial"))}).attr("height",function(){return parseFloat(this.getAttribute("heightInitial"))})):"horizontal"===z&&(ba.attr("x",0).attr("width",0),ba.transition().duration(ca).attr("width",function(){return parseFloat(this.getAttribute("widthInitial"))})));var da;!0===b.showTooltip&&(da=t());var ea=function(a){if(da){let d=d3.select(this),e=parseInt(d.attr("barID"));var b=aa(e,a),c=j.getTooltipLabel(a,e,b);da.html(c).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},fa=function(){var a=d3.event;da&&da.style("top",a.clientY+"px").style("left",a.clientX+20+"px")},ga=function(){da&&da.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},ha=function(){ca||(ca=0),setTimeout(function(){ba.on("mouseover",ea),ba.on("mousemove",fa),ba.on("mouseleave",ga)},ca)},ia=function(a){var b=[];return ba.each(function(){b.push(this)}),b};ba.on("click",function(a){var b=parseInt(d3.select(this).attr("barID"));j.onClick(this,b,a)}),ba.on("dblclick",function(){j.onDblClick(this,ia(this))}),l.forEach(function(a){o(a)}),(k.xGrid||k.yGrid)&&u(e,f,g,r,w,k.xGrid,k.yGrid),ha()}};this.onClick=function(a,b){},this.onDblClick=function(a,b){};var n=function(a,b,c){h&&h.selectAll("*").remove(),i&&i.selectAll("*").remove(),h=e.append("g").attr("transform","translate(0,"+c+")").call(d3.axisBottom(a)),h.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),i=e.append("g").call(d3.axisLeft(b))},o=function(a){var b,c=a.xAxis,d=a.yAxis;a.line.getConfig&&(b=a.line.getConfig()),b||(b=new bluewave.chart.Line().getConfig());let h=b.color,i=b.style,j=b.width,k=b.opacity,l=b.smoothing;var m=function(a){var b=f.bandwidth()/2;return"date"===q?f(new Date(a.key))+b:f(a.key)+b},n=function(a){var b=parseFloat(a.value);return g(b)},o=function(){return l&&"none"!==l?d3.line().x(m).y(n).curve(d3[l]):d3.line().x(m).y(n)},p=d3.nest().key(function(a){return a[c]}).rollup(function(a){return d3.sum(a,function(a){return a[d]})}).entries(a.data);let q=v(p[0].key);"date"==q&&(q="string"),e.append("path").datum(p).attr("fill","none").attr("stroke",h).attr("stroke-width",j).attr("opacity",k).attr("stroke-dasharray",function(a){if("dashed"===i)return"5, 5";return"dotted"===i?"0, 5":void 0}).attr("stroke-linecap",function(a){if("dotted"===i)return"round"}).attr("d",o())},p=javaxt.dhtml.utils.merge,q=javaxt.dhtml.utils.onRender,r=bluewave.chart.utils.initChart,s=bluewave.chart.utils.drawAxes,t=bluewave.chart.utils.createTooltip,u=bluewave.chart.utils.drawGridlines,v=bluewave.chart.utils.getType;(function(){j.setConfig(b),r(a,function(a,b){c=a,d=b})})()};if(!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.SankeyChart=function(a,b){var c,d,e,f=this,g={margin:{top:10,right:10,bottom:10,left:10},links:{color:"#ccc",opacity:.3}},h=[],i=[],j=d3.scaleOrdinal(d3.schemeCategory10);this.setConfig=function(a){b=a?m(a,g):g},this.getChart=function(){return e},this.getNodeColor=function(a){return j(a.name.replace(/ .*/,""))},this.getNodeLabel=function(a){return a.name},this.addNode=function(a,b){if(a){var c;return c=a.name?a:{name:a,group:b},h.push(c),c}},this.addLink=function(a,b,c){if(a&&b){a.name&&(a=a.name),b.name&&(b=b.name);var d={source:a,target:b,value:c};return i.push(d),d}},this.clear=function(){k(),h=[],i=[]},this.update=function(a,b){f.setConfig(a),b&&(f.clear(),b.nodes&&(h=b.nodes),b.links&&(i=b.links));var d=c.node().parentNode;n(d,function(){l(d)})};var k=function(){d&&d.selectAll("*").remove()},l=function(a){var c=Math.max;k();var g=a.offsetWidth,j=a.offsetHeight;e=d.append("g"),e.attr("name","sankey").attr("width",g).attr("height",j);var l=d3.sankey().nodeId(a=>a.name).nodeWidth(20).nodePadding(20).iterations([6]).size([g,j]);let m=l({nodes:h,links:i});var n=l.size(),g=n[0],o=d3.format(",.0f"),p=e.append("g");p.attr("name","links");var q=p.selectAll("*").data(m.links).enter().append("path").attr("class","sankey-link").attr("d",d3.sankeyLinkHorizontal()).attr("stroke-width",function(a){return c(a.width,1)}).style("stroke-opacity",function(a){return a.opacity=b.links.opacity}).style("stroke",function(a){return b.links.color}).on("mouseover",function(a){var c=Math.min(1,1.3*b.links.opacity);d3.select(this).style("stroke-opacity",c)}).on("mouseout",function(a){d3.select(this).style("stroke-opacity",a.opacity)}),r=e.append("g");r.attr("name","nodes");var s=r.selectAll("*").data(m.nodes).enter().append("g").attr("class","sankey-node");s.append("rect").attr("x",function(a){return a.x0}).attr("y",function(a){return a.y0}).attr("height",function(a){return c(a.y1-a.y0,1)}).attr("width",l.nodeWidth()).style("fill",function(a){return a.color=f.getNodeColor(a)}).style("stroke",function(a){return d3.rgb(a.color).darker(2)}).append("title").text(function(a){return a.name+"\n"+o(a.value)}),"source"===b.links.color&&q.each(function(){var a=d3.select(this);a.style("stroke",function(a){return a.source.color})}),q.append("title").text(function(a){return a.source.name+" \u2192 "+a.target.name+"\n"+o(a.value)}),s.append("text").attr("x",function(a){return a.x0-6}).attr("y",function(a){return(a.y1+a.y0)/2}).attr("dy","0.35em").attr("text-anchor","end").text(function(a){return f.getNodeLabel(a)}).filter(function(a){return a.x0<g/2}).attr("x",function(a){return a.x1+6}).attr("text-anchor","start")},m=javaxt.dhtml.utils.merge,n=javaxt.dhtml.utils.onRender,o=bluewave.chart.utils.initChart;(function(){f.setConfig(b),o(a,function(a,b){c=a,d=b})})()};