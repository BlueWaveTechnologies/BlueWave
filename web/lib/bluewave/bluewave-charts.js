//Bluewave Charts 1.0.3
if(!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.BarChart=function(t,e){var a,l,r,n,o,i,s,c=this,d={layout:"vertical",animationSteps:1500,stackValues:!1,colors:d3.schemeCategory10,showTooltip:!1},h=[];this.setConfig=function(t){e=t?m(t,d):d},this.getBarColor=function(t,a,l){var r=e.colors,i=e["barColor"+a];return i||(i=r[a%r.length],e["barColor"+a]=i),i},this.getTooltipLabel=function(t,a,l){var r=c.getKeyLabel(t.key,t)+"<br/>"+c.getValueLabel(t.value),i=e.group;if(i&&(i=(i+"").trim(),0<i.length))try{r=i+": "+l[0][e.group]+"<br/>"+r}catch(t){}return r},this.getKeyLabel=function(t,a){var l,r,i=e.layout;return"horizontal"===i?(r=e.xAxis,l=e.yAxis):(l=e.xAxis,r=e.yAxis),l+": "+t},this.getValueLabel=function(t,a){var l,r,i=e.layout;"horizontal"===i?(r=e.xAxis,l=e.yAxis):(l=e.xAxis,r=e.yAxis);var n=bluewave.chart.utils.parseFloat(t);return isNaN(n)||(t=L(n,2)),r+": "+t},this.getXAxis=function(){return i},this.getYAxis=function(){return s},this.clear=function(){l&&l.selectAll("*").remove()},this.addLine=function(t,e,a,l){h.push({line:t,data:e,xAxis:a+"",yAxis:l+""})},this.update=function(t,e){c.clear(),1<arguments.length?c.setConfig(t):e=arguments[0];var l=a.node().parentNode;f(l,function(){p(e)})};var p=function(t){var d=e,p=javaxt.dhtml.utils.getRect(a.node()),y=p.width,m=p.height,f=m,x=y;r=l.append("g"),r.attr("width",y).attr("height",m);var k,L,T=d.layout,D=!0===d.stackValues,E=d.barType;if("histogram"===E?(k=d.values,L=k):"horizontal"===T?(L=d.xAxis,k=d.yAxis):(k=d.xAxis,L=d.yAxis),null!==k&&void 0!==k&&null!==L&&void 0!==L){var F=t,R=d3.merge(F),B=C(R,k,L);if(0<h.length){let t=d3.max(B,t=>bluewave.chart.utils.parseFloat(t.value));h.forEach(function(e){let a=e.data,l=e.xAxis,r=e.yAxis,i=d3.max(a,t=>bluewave.chart.utils.parseFloat(t[r]));i>t&&(B=C(a,l,r))})}var P=d.sort;P&&B.sort(function(t,e){return d3[P](t.value,e.value)});var S=d.group;if(S&&(S=(S+"").trim(),0===S.length&&(S=null)),S){F=[];var O=d3.group(R,t=>t[S]);for(var M of O.keys()){var Y=O.get(M),z=Y[0][S],K={};for(var M in Y.forEach(t=>{var e=t[k],a=bluewave.chart.utils.parseFloat(t[L]);isNaN(a)&&(a=0),K.hasOwnProperty(e)?K[e]+=a:K[e]=a}),Y=[],K)if(K.hasOwnProperty(M)){var V=K[M],j={};j[S]=z,j[k]=M,j[L]=V,Y.push(j)}F.push(Y)}}else D=!1;var Y=[];for(let t=0;t<F.length;t++){var N=0<t?t+1:"";let e=d[`xAxis${t+1}`],a=d[`yAxis${t+1}`];if(e&&a||S||"histogram"===E||!(0<t)){d.hasOwnProperty(`xAxis${t+1}`)&&d.hasOwnProperty(`yAxis${t+1}`)&&(k=e,L=a);var I=C(F[t],k,L);Y.push(I)}}D?B=C(d3.merge(Y),"key","value"):(B=[],Y.forEach(t=>{B.push(...t)}));var G,X,H,U;"histogram"===E?(H="key",U="key","vertical"===T?(G="Frequency",X=d.xAxis):"horizontal"===T&&(G=d.xAxis,X="Frequency")):"vertical"===T?(H="key",U="value",G=d.yAxis,X=d.xAxis):"horizontal"===T&&(H="value",U="key",G=d.xAxis,X=d.yAxis);var W=b(r,x,f,H,U,B,null,d,"barChart"),_=W.margin;if(_){var q=_.left,Z=_.right,J=_.top,Q=_.bottom;(0<J||0<Q||0<q||0<Z)&&(f-=J+Q,x-=q+Z,r.selectAll("*").remove(),r.attr("transform","translate("+q+","+J+")"),W=b(r,x,f,H,U,B,null,d,"barChart")),_={top:J,right:Z,bottom:Q,left:q}}n=W.x,o=W.y,i=W.xAxis,s=W.yAxis,m-=_.top+_.bottom,y-=_.left+_.right;var $={};for(let t=0;t<F.length;t++){var I=Y[t];let e=parseFloat(d["fillOpacity"+t]);if((isNaN(e)||0>e||1<e)&&(e=1),D){let a=w(I[0].key);"date"==a&&(a="string");let l=function(t){return"date"===a?n(new Date(t.key)):n(t.key)},i=function(t){var e=bluewave.chart.utils.parseFloat(t.value);return o(e)},s=function(t){return n.bandwidth?n.bandwidth():l(t)};r.append("g").selectAll("mybar").data(I).enter().append("rect").attr("x",l).attr("y",function(t){var e=t.key,a=t.value;$[e]||($[e]=0);var l=bluewave.chart.utils.parseFloat(a);return $[e]+=l,o($[e])}).attr("height",function(t){return o.bandwidth?o.bandwidth():m-i(t)}).attr("width",function(t){return s(t)}).attr("opacity",e).attr("barID",t)}if(!D)if("histogram"===E){let a=parseInt(d.binWidth);(isNaN(a)||1>a)&&(a=10),n.nice();var tt=d3.histogram().value(function(t){return t.key}).domain(n.domain()).thresholds(n.ticks(a)),et=tt(I),at=d3.max(et,t=>t.length),lt=d3.scaleLinear().range("vertical"===T?[m,0]:[0,y]);lt.domain([0,at]),"vertical"===T?u(n,lt,f):"horizontal"===T&&u(lt,o,f),r.selectAll("rect").data(et).enter().append("rect").attr("x",function(t){return"vertical"===T?n(t.x0):0}).attr("y",function(t){return"vertical"===T?lt(t.length):m-n(t.x1)/(y/m)}).attr("width",function(t){return"vertical"===T?n(t.x1)-n(t.x0)-.5:lt(t.length)}).attr("height",function(t){return"vertical"===T?m-lt(t.length):(n(t.x1)-n(t.x0))/(y/m)-.5}).attr("opacity",e).attr("barID",t)}else{let a=w(I[0].key);"date"==a&&(a="string");var rt=function(t){return"date"===a?n(new Date(t.key)):n(t.key)},it=function(t){var e=bluewave.chart.utils.parseFloat(t.value);return o(e)};if(!(o.bandwidth||n.bandwidth))"vertical"===d.layout?r.selectAll("mybar").data(I).enter().append("rect").attr("x",function(e){var a=rt(e)-y/I.length/2;if(S){var l=y/I.length,r=l/F.length;a+=r*t}return a}).attr("y",it).attr("height",function(t){return m-it(t)}).attr("width",function(t){var e=y/I.length;return S?e/F.length:e-5}).attr("opacity",e).attr("barID",function(e,a,l){return S?t:0}):"horizontal"===d.layout&&r.selectAll("mybar").data(I).enter().append("rect").attr("x",function(t){return 0}).attr("y",function(t){return"date"===a?o(new Date(t.key))-m/I.length/2:o(t.key)-m/I.length/2}).attr("height",function(t){return m/I.length-5}).attr("width",function(t){return n(t.value)}).attr("opacity",e).attr("barID",function(e,a,l){return S?t:0});else if("vertical"===d.layout){var nt=function(t){return S?n.bandwidth?n.bandwidth()/F.length:rt(t):n.bandwidth?n.bandwidth():rt(t)};r.selectAll("mybar").data(I).enter().append("rect").attr("x",function(e){var a=nt(e),l=n.bandwidth?rt(e):0;return S?l+a*t:rt(e)}).attr("y",it).attr("height",function(t){return o.bandwidth?o.bandwidth():m-it(t)}).attr("width",function(t){return nt(t)}).attr("opacity",e).attr("barID",function(e,a,l){return S?t:0})}else"horizontal"===d.layout&&r.selectAll("mybar").data(I).enter().append("rect").attr("x",function(t){return 0}).attr("y",function(e){var a=o.bandwidth?o.bandwidth()/F.length:m-o(e.key),l=o.bandwidth?o(e.key):0;return S?l+a*t:o(e.key)}).attr("height",function(t){return S?o.bandwidth?o.bandwidth()/F.length:m-o(t.value):o.bandwidth?o.bandwidth():m-o(t.value)}).attr("width",function(t){return n.bandwidth?n.bandwidth():n(t.value)}).attr("opacity",e).attr("barID",function(e,a,l){return S?t:0})}}var ot=function(t,e){for(var a=[],l=F[t],r=0;r<l.length;r++)l[r][k]===e.key&&a.push(l[r]);return a},st=r.selectAll("rect");st.each(function(t,e){let a=d3.select(this),l=parseInt(a.attr("barID"));var r=ot(l,t);a.attr("fill",c.getBarColor(t,l,r))});var dt=d.animationSteps;!isNaN(dt)&&50<dt&&(st.attr("yInitial",function(){return this.getAttribute("y")}).attr("heightInitial",function(){return this.getAttribute("height")}).attr("widthInitial",function(){return this.getAttribute("width")}),"vertical"===T?(st.attr("y",m).attr("height",0),st.transition().duration(dt).attr("y",function(){return parseFloat(this.getAttribute("yInitial"))}).attr("height",function(){return parseFloat(this.getAttribute("heightInitial"))})):"horizontal"===T&&(st.attr("x",0).attr("width",0),st.transition().duration(dt).attr("width",function(){return parseFloat(this.getAttribute("widthInitial"))})));var ct;!0===e.showTooltip&&(ct=v());var ht=function(t,e){if(ct){let t=d3.select(this),r=parseInt(t.attr("barID"));var a=ot(r,e),l=c.getTooltipLabel(e,r,a);ct.html(l).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},pt=function(t){ct&&ct.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},ut=function(){ct&&ct.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},gt=function(){dt||(dt=0),setTimeout(function(){st.on("mouseover",ht),st.on("mousemove",pt),st.on("mouseleave",ut)},dt)},yt=function(t){var e=[];return st.each(function(){e.push(this)}),e};st.on("click",function(t,e){var a=parseInt(d3.select(this).attr("barID"));c.onClick(this,a,e)}),st.on("dblclick",function(t,e){c.onDblClick(this,yt(this))}),h.forEach(function(t){g(t)}),(d.xGrid||d.yGrid)&&A(r,n,o,f,x,d.xGrid,d.yGrid),gt()}};this.onClick=function(t,e){},this.onDblClick=function(t,e){};var u=function(t,e,a){i&&i.selectAll("*").remove(),s&&s.selectAll("*").remove(),i=r.append("g").attr("transform","translate(0,"+a+")").call(d3.axisBottom(t)),i.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),s=r.append("g").call(d3.axisLeft(e))},g=function(t){var e,a=t.xAxis,l=t.yAxis;t.line.getConfig&&(e=t.line.getConfig()),e||(e=new bluewave.chart.Line().getConfig());let i=e.color,s=e.style,d=e.width,c=e.opacity,h=e.smoothing;var p=function(t){var e=n.bandwidth()/2;return"date"===m?n(new Date(t.key))+e:n(t.key)+e},u=function(t){var e=bluewave.chart.utils.parseFloat(t.value);return o(e)},g=function(){return h&&"none"!==h?d3.line().x(p).y(u).curve(d3[h]):d3.line().x(p).y(u)},y=C(t.data,a,l);let m=w(y[0].key);"date"==m&&(m="string"),r.append("path").datum(y).attr("fill","none").attr("stroke",i).attr("stroke-width",d).attr("opacity",c).attr("stroke-dasharray",function(t){if("dashed"===s)return"5, 5";return"dotted"===s?"0, 5":void 0}).attr("stroke-linecap",function(t){if("dotted"===s)return"round"}).attr("d",g())},m=javaxt.dhtml.utils.merge,f=bluewave.chart.utils.onRender,k=bluewave.chart.utils.initChart,b=bluewave.chart.utils.drawAxes,v=bluewave.chart.utils.createTooltip,A=bluewave.chart.utils.drawGridlines,w=bluewave.chart.utils.getType,C=bluewave.chart.utils.createKeyValueDataset,L=javaxt.dhtml.utils.round;(function(){c.setConfig(e),k(t,function(t,e){a=t,l=e})})()},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.ScatterChart=function(t,e){var i,n,o,s,c,h,a=Math.min,l=Number.MAX_VALUE,r=Math.max,p=this,d={pointColor:"#6699cc",pointRadius:7,pointOpacity:.8,pointLabels:!1,showRegLine:!1,showTooltip:!1},u=function(){p.setConfig(e),A(t,function(t,e){i=t,n=e})};this.setConfig=function(t){e=t?k(t,d):d},this.clear=function(){n&&n.selectAll("*").remove()},this.update=function(t,a,l){p.clear(),0<arguments.length&&(1===arguments.length||("string"==typeof a?(e.xAxis=a,e.yAxis=l):(p.setConfig(arguments[0]),t=arguments[1])));var r=i.node().parentNode;b(r,function(){g(t)})},this.getPointLabel=function(t){return""},this.getPointRadius=function(t){return e.pointRadius},this.getPointColor=function(t){return e.pointColor},this.getPointOpacity=function(t){return e.pointOpacity},this.getTooltipLabel=function(t){return e.xAxis+": "+t[e.xAxis]+"<br/>"+e.yAxis+": "+t[e.yAxis]},this.onClick=function(t,e,a){};var g=function(t){var a=javaxt.dhtml.utils.getRect(i.node()),l=a.width,d=a.height,u=d,g=l;o=n.append("g"),o.attr("width",l).attr("height",d);let y=e.xAxis,x=e.yAxis;if(!y||!x)return;if(v(t)&&v(t[0])&&(t=t[0]),0==t.length)return;var k=L(o,g,u,y,x,t,null,e);c=k.x,h=k.y;var b=k.margin;if(b){var A=b.left,C=b.right,T=b.top,B=b.bottom,P=0;if(e.pointLabels){var S=o.append("g");S.selectAll("text").data(t).enter().append("text").attr("x",0).attr("y",0).attr("text-anchor","start").attr("font-size",10).text(function(t){return p.getPointLabel(t)});var O=S.node().getBBox();S.remove(),P=r(O.width,P)}(0<T||0<B||0<A||0<C)&&(u-=T+B,g-=A+C,o.selectAll("*").remove(),o.attr("transform","translate("+A+","+T+")"),k=L(o,g,u,y,x,t,null,e)),b={top:T,right:C,bottom:B,left:A}}c=k.x,h=k.y;let M=w(t[y]);if(e.pointLabels){let t=P/g;c=E({scale:k.x,band:k.xBand},[0,g],t).scale,F(o,k.xAxis,c,null,null,u)}(e.xGrid||e.yGrid)&&D(o,c,h,u,g,e.xGrid,e.yGrid);var Y,z=function(t){return"date"===M?c(new Date(t[y])):c(t[y])},K=function(t){return h(t[x])};!0===e.showTooltip&&(Y=R());var V=function(t,e){if(Y){var a=p.getTooltipLabel(e);Y.html(a).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},j=function(t){Y&&Y.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},N=function(){Y&&Y.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},I=o.append("g");if(I.attr("name","points"),I.selectAll("*").data(t).enter().append("circle").attr("dataset",0).attr("cx",z).attr("cy",K).attr("r",function(t){return p.getPointRadius(t)}).style("fill",function(t){return p.getPointColor(t)}).style("opacity",function(t){return p.getPointOpacity(t)}).style("stroke","white").on("mouseover",V).on("mousemove",j).on("mouseleave",N).on("click",function(t,e){var a=parseInt(d3.select(this).attr("dataset"));p.onClick(this,a,e)}),!0===e.pointLabels){var G=o.append("g");G.attr("name","labels"),G.append("g").selectAll("text").data(t).enter().append("text").attr("x",function(t){var e=z(t),a=p.getPointRadius(t);return e+a+1}).attr("y",K).attr("font-size",10).text(function(t){return p.getPointLabel(t)}).on("mouseover",V).on("mousemove",j).on("mouseleave",N).on("click",function(t){})}if(e.showRegLine){var X=m(t,y,x,d3.min(t,function(t){return t[y]}),d3.min(t,function(t){return t[x]}),c,h);s=d3.line().x(function(t){return t[0]}).y(function(t){return t[1]}),o.append("path").datum(X).attr("dataset",0).attr("d",s).attr("stroke",p.getPointColor()).attr("stroke-linecap","round").attr("stroke-width",2).on("click",function(t,e){var a=parseInt(d3.select(this).attr("dataset"));p.onClick(this,a,e)})}var O=f(o);if(O.width=1.1*(O.maxX-O.minX),O.height=1.1*(O.maxY-O.minY),O.width>l||O.height>d){var H,U=O.width-l,W=O.height-d;U>W?(H=l/O.width,1<H&&(H=1+(1-H))):W>U&&(H=d/O.height),T=(T+W/2)*H,o.attr("transform","translate("+A+","+T+") scale("+H+")")}},m=function(t,e,a,l,r,i,o){var s=t.length,n=[],d=[],c=[];t.forEach(t=>{var l={};l.x=parseFloat(i(t[e])),l.y=parseFloat(o(t[a])),l.mult=l.x*l.y,n.push(l),d.push(parseFloat(i(t[e]))),c.push(parseFloat(o(t[a])))});var h=0,p=0,u=0,g=0,f=0,k=0,A=0,w=d.length;if(w!=c.length)throw new Error("The values in xAxis and yAxis need to have same size!");if(0===w)return[[],[]];for(var C=0;C<w;C++)k=d[C],A=c[C],h+=k,p+=A,g+=k*k,u+=k*A,f++;for(var L=(f*u-h*p)/(f*g-h*h),m=p/f-L*h/f,b=[],C=0;C<w;C++)k=d[C],A=k*L+m,b.push([k,A]);return b},f=function(t){var e=l,i=0,n=l,o=0;return t.selectAll("*").each(function(){var t=javaxt.dhtml.utils.getRect(d3.select(this).node());e=a(t.left,e),i=r(t.right,i),n=a(t.top,n),o=r(t.bottom,o)}),{minX:e,maxX:i,minY:n,maxY:o}},k=javaxt.dhtml.utils.merge,b=bluewave.chart.utils.onRender,v=bluewave.chart.utils.isArray,A=bluewave.chart.utils.initChart,w=bluewave.chart.utils.getType,C=bluewave.chart.utils.getScale,L=bluewave.chart.utils.drawAxes,T=bluewave.chart.utils.drawLabels,D=bluewave.chart.utils.drawGridlines,E=bluewave.chart.utils.extendScale,F=bluewave.chart.utils.reDrawAxes,R=bluewave.chart.utils.createTooltip;u()},!bluewave)var bluewave={};if(bluewave.chart||(bluewave.chart={}),bluewave.chart.utils={initChart:function(t,e,a){var l;if(t instanceof d3.selection)l=t;else if(t instanceof SVGElement)l=d3.select(t);else{var r=d3.select(t).append("div").classed("svg-container",!0),l=r.append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("height","100%").attr("width","100%").attr("viewBox","0 0 600 400").classed("svg-content-responsive",!0);bluewave.chart.utils.onRender(t,function(){var e=t.offsetWidth,a=t.offsetHeight;l.attr("viewBox",`0 0 ${e} ${a}`)})}var i=l.append("g");e&&e.apply(a,[l,i])},onRender:function(t,e){var a=t.offsetWidth;if(0===a||isNaN(a)){var l,r=function(){var a=t.offsetWidth;0===a||isNaN(a)?l=setTimeout(r,100):(clearTimeout(l),e&&e.apply(t,[t]))};l=setTimeout(r,100)}else e&&e.apply(t,[t])},drawGridlines:function(t,e,a,l,r,i,n){i&&t.append("g").attr("class","grid").attr("transform","translate(0,"+l+")").call(d3.axisBottom(e).tickSize(-l).tickFormat("")),n&&t.append("g").attr("class","grid").call(d3.axisLeft(a).tickSize(-r).tickFormat(""))},drawLabels:function(t,e,a,l,r,i,n,o){if(e){var s=l;i&&(s+=i.bottom-2),t.append("text").attr("x",r/2).attr("y",s).style("text-anchor","middle").text(n)}if(a){var d=0;i&&(d-=i.left),t.append("text").attr("transform","rotate(-90)").attr("x",0-l/2).attr("y",d).attr("dy","1em").style("text-anchor","middle").text(o)}},drawAxes:function(e,a,l,i,n,o,s,d,c){var h=Math.min,p=Number.MAX_VALUE,u=Math.max;d||(d={});var g=bluewave.chart.utils.getType,m=bluewave.chart.utils.getScale,f=bluewave.chart.utils.getDateFormat,k=[],b=[];o.forEach(t=>{k.push(t[i]),b.push(t[n])});var v=g(k),A=g(b);if("barChart"==c&&("date"==v&&(v="string"),"date"==A&&(A="string"),"number"==v||"currency"==v)){var w=d.layout;if("vertical"===w){var C=p,L=0;k.forEach(t=>{var e=bluewave.chart.utils.parseFloat(t);C=h(e,C),L=u(e,L)}),d.xMin=C}}var T=m(i,v,[0,a],o,s,null,d.xMin,d.xMax),D=T.scale,x=T.band,E="logarithmic"===d.scaling?"logarithmic":"linear";T=m(n,A,[l,0],o,s,E);var F,R=T.scale,y=T.band,B=10,P=D.domain().length,S=P*B<a,O=function(t,e){let l=parseInt(a/B);return!(0!==e)||!(e%l)},M=function(t,e){var a,l,r;t.selectAll("text").each(function(t,i,n){var o=n[i].textContent;if("number"===e){if(isNaN(a)&&(a=0,n.forEach(function(t){var e=0==bluewave.chart.utils.parseFloat(t.textContent)%1;e&&a++})),a==n.length){var s=d3.format(",");n[i].textContent=s(o)}}else if("date"===e){if(l||(l={},r={},n.forEach(function(t){var e=new Date(t.textContent),a=e.getFullYear(),i=e.getDate();l[a+""]=!0,r[i+""]=!0}),l=Object.keys(l),r=Object.keys(r)),1<l.length){if(1==r.length){var s=d3.timeFormat("%m/%y");o=s(t)}}else if(1==r.length){var s=d3.timeFormat("%b");o=s(t)}0===o.indexOf("0")&&(o=o.substring(1)),o=o.replaceAll("/0","/"),n[i].textContent=o}})},Y=function(t,e){var a;if("date"===t)a=d3.timeFormat(f(e));else if("number"===t){var l=1;a=d3.format(".1f")}return a},z=function(t){var e=[];return t.selectAll("text").each(function(t,a){var l=javaxt.dhtml.utils.getRect(this);e.push({left:l.x,right:l.x+l.width,top:l.y,bottom:l.y+l.height})}),e},K=function(t,e=0){var a=!1;t.forEach(function(t){t.top-=e,t.left-=e,t.right+=e,t.bottom+=e});for(var l,r=0;r<t.length;r++){l=t[r];for(var n=0;n<t.length;n++)if(n!==r){var o=t[n];if(javaxt.dhtml.utils.intersects(l,o)){a=!0;break}}if(a)break}return a},V=Y(v,d.xFormat);!0===d.xTicks||!1===d.xTicks||(F=d.xTicks);var j=e.append("g").attr("transform","translate(0,"+l+")");if(!1===d.xTicks)j.call(d3.axisBottom(D).ticks(F).tickSize([0,0])),j.selectAll("text").each(function(t,e){d3.select(this).remove()}),j.selectAll("path").each(function(t,e){d3.select(this).remove()});else{j.call(d3.axisBottom(D).ticks(F).tickValues(S?null:D.domain().filter(O)).tickFormat(V)),d.xFormat||M(j,v);var N=z(j),I=K(N,0);I&&j.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end")}var G=Y(A,d.yFormat),X=e.append("g");if(!1===d.yTicks)X.call("linear"===E?d3.axisLeft(R).tickFormat(G).tickSize([0,0]):d3.axisLeft(R).ticks(10,",").tickFormat(G).tickSize([0,0])),X.selectAll("text").each(function(t,e){d3.select(this).remove()}),X.selectAll("path").each(function(t,e){d3.select(this).remove()});else{X.call("linear"===E?d3.axisLeft(R).tickFormat(G):d3.axisLeft(R).ticks(10,",").tickFormat(G)),d.yFormat||M(X,A);var H=z(X),U=K(H,-1);if(U){let t=X.selectAll("text").size();X.selectAll("text").attr("visibility",function(e,a){return t%2?0==(a+1)%2?"hidden":"visible":0==a%2?"hidden":"visible"})}}var W=javaxt.dhtml.utils.getRect(j.node()),_=javaxt.dhtml.utils.getRect(X.node()),q=p,Z=0,J=p,Q=0;j.selectAll("line").each(function(t,e){var a=javaxt.dhtml.utils.getRect(this);q=h(a.x,q),Z=u(a.x+a.width,Z)}),X.selectAll("line").each(function(t,e){var a=javaxt.dhtml.utils.getRect(this);J=h(a.y,J),Q=u(a.y+a.height,Q)}),X.selectAll("path").each(function(t,e){var a=javaxt.dhtml.utils.getRect(this);J=h(a.y,J),Q=u(a.y+a.height,Q)});var $=W.left-q;0>$&&($=0);var tt=W.right-Z;0>tt&&(tt=0),$=u(_.width,$);var et=J-_.top,at=W.height,lt=16,rt=d.xLabel;if(rt){var it=j.append("text").attr("x",(W.right-W.left)/2).attr("y",at+lt).attr("class","chart-axis-label").style("text-anchor","middle").text(rt),nt=javaxt.dhtml.utils.getRect(it.node());at+=nt.height+lt}var ot=d.yLabel;if(ot){var it=X.append("text").attr("transform","rotate(-90)").attr("x",-(_.height/2)).attr("y",-(_.width+lt)).attr("class","chart-axis-label").style("text-anchor","middle").text(ot),nt=javaxt.dhtml.utils.getRect(it.node());$=u($+(nt.width+lt),$)}return{xAxis:j,yAxis:X,xBand:x,yBand:y,x:D,y:R,margin:{top:et,right:tt,bottom:at,left:$}}},getScale:function(t,e,a,l,r,i,n,o){let s,d;switch(e){case"string":s=d3.scaleBand().domain(l.map(function(e){return e[t]})).range(a).padding(.2);break;case"date":var c=[new Date(d3.min(l,e=>e[t])),new Date(d3.max(l,e=>e[t]))];l.map(e=>(e[t]=new Date(e[t]),e)),s=d3.scaleTime().domain(c).rangeRound(a),d=d3.scaleBand().domain(d3.timeDay.range(...s.domain())).rangeRound(a).padding(.2);break;default:var h,p;if(!r){var u=d3.extent(l,function(e){return bluewave.chart.utils.parseFloat(e[t])});h=0,p=u[1]}else h=d3.min(r,function(e){return bluewave.chart.utils.parseFloat(e[t])}),p=d3.max(l,function(e){return bluewave.chart.utils.parseFloat(e[t])});h===p&&(p=h+1),i||(i="linear"),"linear"===i?(0<h&&(h=0),!isNaN(n)&&(h=n),!isNaN(o)&&(p=o),s=d3.scaleLinear().domain([h,p])):"logarithmic"==i&&(1>h&&(h=1),s=d3.scaleLog().domain([h,p+1])),s.range(a)}return{scale:s,band:d}},extendScale:function(t,e,a,l){var i,n,r=Math.ceil,o=t.scale.domain(),s=bluewave.chart.utils.getType;if(l||(l=s(o[0])),a||(a=1),"date"===l){let t=o[1],l=o[0],r=t.getTime(),s=t-l,d=s*a,c=new Date(r+d);i=d3.scaleTime().domain([l,c]).rangeRound(e),n=d3.scaleBand().domain(d3.timeDay.range(...i.domain())).rangeRound(e).padding(.2)}else if("string"===l){let t=r(o.length*a),l="",n=o;for(let e=0;e<t;e++)l+=" ",n.push(l);i=d3.scaleBand().domain(n).range(e).padding(.2)}else{let t=[o[0],o[1]*(a+1)];i=d3.scaleLinear().domain(t).range(e)}return{scale:i,band:n}},reDrawAxes:function(t,e,a,l,r,i){e&&(e.remove(),e=t.append("g").attr("transform","translate(0,"+i+")").call(d3.axisBottom(a))),l&&(l.remove(),l=t.append("g").call(d3.axisLeft(r)))},getType:function(t){var e=bluewave.chart.utils.getType,a=bluewave.chart.utils.isDate,l=bluewave.chart.utils.isNumber,r=bluewave.chart.utils.isCurrency,i=bluewave.chart.utils.isArray;if(i(t)){var n=t.length,o=0,d=0,c=0,h=0,p=0,u=0;return t.forEach(function(t){var a=e(t);switch(a){case"string":var l=(t+"").trim();(0===l.length||"null"===l)&&p++,h++;break;case"number":o++;break;case"currency":d++;break;case"date":c++;break;default:u++}}),c===n||c+p===n?"date":o===n||o+p===n?"number":d===n||d+p===n||d+o+p===n?"currency":h===n?"string":null}switch(typeof t){case"string":return l(t)?"number":a(t)?"date":r(t)?"currency":"string";break;case"number":return"number";break;case"object":if(a(t))return"date";break;default:}return null},parseFloat:function(t){if("number"==typeof t)return t;if("string"==typeof t){if(bluewave.chart.utils.isDate(t))return parseFloat(null);if(bluewave.chart.utils.isCurrency(t))return bluewave.chart.utils.parseCurrency(t)}return parseFloat(t)},parseCurrency:function(t){for(var e=t.split(" "),a=0;a<e.length;a++)if(t=e[a].trim(),bluewave.chart.utils.isCurrency(t)){var l=1;0==t.indexOf("-")&&(l=-1),0==t.indexOf("(")&&t.lastIndexOf(")")==t.length-1&&(l=-1);var r=t.indexOf("."),o=t.indexOf(",");0>r&&(r=0),0>o&&(o=0);var s;return s=r>o&&r?r:!!(o>r&&o)&&o,!1==s?parseFloat(t.replace(/[^\d]/g,""))*l:parseFloat(t.substr(0,s).replace(/[^\d]/g,"")+"."+t.substr(s+1,t.length).replace(/[^0-9]/,""))*l}return parseFloat(null)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isNumber:function(t){return!("number"!=typeof t)||("string"!=typeof t&&(t=""+t),!isNaN(parseFloat(t))&&!isNaN(t-0))},isCurrency:function(e){if(bluewave.chart.utils.isNumber(e))return!0;if(bluewave.chart.utils.isDate(e))return!1;"string"!=typeof e&&(e=""+e);var a=e.replace(/[-+,.a-zA-Z0-9() ]+/g,"");if(a=a.replace(/[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/,""),0<a.length)return!1;for(var l,r=0,o=e.split(" "),s=0;s<o.length;s++){if(l=o[s].trim(),0<l.length){(0==l.indexOf("-")||0==l.indexOf("+"))&&(l=l.substring(1).trim()),0==l.indexOf("(")&&l.lastIndexOf(")")==l.length-1&&(l=l.substring(1,l.length-1).trim());var d=/^\d/.test(l),c=/[0-9]+$/.test(l);if(d&&c){var a=l.replace(/[^0-9,.]+/g,"");return a===l}if(d||c)return bluewave.chart.utils.isNumber(e.replace(/[^0-9.-]+/g,""));r++}if(3<r)return!1}return!1},isDate:function(t){if("string"==typeof t||"number"==typeof t){var e=(t+"").replace(/[^-+0-9,.]+/g,"");if(t===e)return!1}return!isNaN(Date.parse(t))},getDateFormat:function(t){var e="%m/%d/%Y";return t&&(e=t,e=e.replace("YYYY","%Y"),e=e.replace("YY","%y"),e=e.replace("MMMM","%B"),e=e.replace("MM","%m"),e=e.replace("M","%m"),e=e.replace("DD","%d"),e=e.replace("D","%d"),e=e.replace("A","%p"),e=e.replace("dddd","%A"),e=e.replace("HH","%H"),e=e.replace("h","%I"),e=e.replace("mm","%M"),e=e.replace("ss","%S")),e},mixColors:function(t,e,a){if("undefined"!=typeof chroma)return chroma.mix(t,e,a,"rgb").hex();var l=d3.scaleLinear().domain([0,1]).range([t,e]);return d3.color(l(a)).formatHex()},getColorRange:function(t,e){if("undefined"!=typeof chroma)return chroma.scale(e).colors(t);for(var a,l=[-1],r=2/(e.length-1),n=0;n<e.length-2;n++)a=l[l.length-1],l.push(a+r);l.push(1);for(var o=d3.scaleLinear().domain(l).range(e),s=[],n=0;n<t;n++){var d=n/(t-1),c=2*d-1,h=d3.color(o(c)).formatHex();s.push(h)}return s},getNaturalBreaks:function(t,e){var a=Math.min;function l(t,e){var a,r,n=[],o=[],s=0;for(a=0;a<t.length+1;a++){var d=[],c=[];for(r=0;r<e+1;r++)d.push(0),c.push(0);n.push(d),o.push(c)}for(a=1;a<e+1;a++)for(n[1][a]=1,o[1][a]=0,r=2;r<t.length+1;r++)o[r][a]=1/0;for(var h=2;h<t.length+1;h++){for(var p=0,u=0,g=0,y=0,f=1;f<h+1;f++){var x=h-f+1,k=t[x-1];if(g++,p+=k,u+=k*k,s=u-p*p/g,y=x-1,0!==y)for(r=2;r<e+1;r++)o[h][r]>=s+o[y][r-1]&&(n[h][r]=x,o[h][r]=s+o[y][r-1])}n[h][1]=1,o[h][1]=s}return{lower_class_limits:n,variance_combinations:o}}function r(t,e,a){var l=t.length-1,r=[],i=a;for(r[a]=t[t.length-1],r[0]=t[0];1<i;)r[i-1]=t[e[l][i]-2],l=e[l][i]-1,i--;return r}var i=[...new Set(t)].length;if(e=a(e,i-1),e>t.length)return null;t=t.slice().sort(function(t,e){return t-e});var n=l(t,e),o=n.lower_class_limits,s=[];try{s=r(t,o,e),s=[...new Set(s)]}catch(t){console.log(t)}return s},createTooltip:function(){var t=bluewave.chart.utils.Tooltip,e=javaxt.dhtml.utils.getHighestElements;return t||(t=bluewave.chart.utils.Tooltip=d3.select(document.body).append("div").style("opacity",0).style("top",0).style("left",0).style("display","none").attr("class","tooltip"),t.show=function(){var a=e(),l=a.zIndex;a.contains(t.node())||l++,t.style("opacity",1).style("display","block").style("z-index",l)},t.hide=function(){t.style("opacity",0).style("display","none")}),t},setStyle:function(t,e){if(null!==t&&0!==t&&null!==e){var a=t.nodeName;if(!a&&t.node&&(t=t.node(),a=t.nodeName),"string"==typeof e||e instanceof String)t.setAttribute("class",e);else for(var l in e){var r=e[l];"text"===a&&"color"===l&&(l="fill"),t.setAttribute(l,r)}}},clipPolygon:function(t,e){function l([t,e],[a,l],[r,i]){return(r-a)*(e-l)<(i-l)*(t-a)}function r([t,e],[a,l],[r,i],[n,o]){const s=a-t,d=l-e,c=n-r,h=o-i,p=(s*(i-e)-d*(r-t))/(d*c-s*h);return[r+p*c,i+p*h]}function i(t){const[e,a]=t[0],[l,r]=t[t.length-1];return e===l&&a===r}const o=i(e),s=t.length-i(t);e=e.slice();for(let n,h,c,d=0,i=t[s-1];d<s;++d){const a=e.slice(),s=a.length-o;e.length=0,n=t[d],h=a[s-1];for(let t=0;t<s;++t)c=a[t],l(c,i,n)?(!l(h,i,n)&&e.push(r(h,c,i,n)),e.push(c)):l(h,i,n)&&e.push(r(h,c,i,n)),h=c;o&&e.push(e[0]),i=n}return e.length?e:null},createKeyValueDataset:function(e,a,l){var r=[],i=[];e.forEach(t=>{var e=t[a],n=t[l];r.push({key:e+"",value:n}),i.push(n)});var n=bluewave.chart.utils.getType(i);if("number"===n||"currency"===n){r.forEach(t=>{var e=bluewave.chart.utils.parseFloat(t.value);isNaN(e)&&(e=0),t.value=e});var t={};for(var a in r.forEach((e,a)=>{var l=r[a].value;t.hasOwnProperty(e.key)?t[e.key]+=l:t[e.key]=l}),r=[],t)if(t.hasOwnProperty(a)){var o=t[a];r.push({key:a,value:o})}}return r}},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.PieChart=function(t,e){var o,d,c,a=Math.abs,l=Math.PI,r=Math.min,i=Number.MAX_VALUE,n=Math.max,h=this,s={pieKey:"key",pieValue:"value",pieCutout:0,pieSort:!1,pieSortDir:"ascending",maximumSlices:null,showLabels:!0,labelOffset:100,lineColor:"#777",borderColor:"#777",extendLines:!1,colors:["#6699cc","#f8f8f8"],otherColor:"#b8b8b8",animationSteps:1500},p=function(){h.setConfig(e),b(t,function(t,e){o=t,d=e})};this.setConfig=function(t){e=t?f(t,s):s},this.getTooltipLabel=function(t,e){return h.getKeyLabel(t.key,t)+"<br/>"+h.getValueLabel(t.value)},this.getKeyLabel=function(t,e){return t},this.getValueLabel=function(t,e){var a=bluewave.chart.utils.parseFloat(t);return isNaN(a)?t:L(a,2)},this.getNumSlices=function(){return c},this.clear=function(){u(),c=0},this.update=function(t,a,l){u(),0<arguments.length&&(1===arguments.length||("string"==typeof a?(e.pieKey=a,e.pieValue=l):(h.setConfig(arguments[0]),t=arguments[1])));var r=o.node().parentNode;x(r,function(){g(t)})};var u=function(){d&&(d.node().innerHTML="",d.attr("transform",null))},g=function(t){if(k(t)&&k(t[0])&&(t=t[0]),e.pieKey&&e.pieValue){var i=C(t,e.pieKey,e.pieValue),n=(e.pieSort+"").toLowerCase(),s=(e.pieSortDir+"").toLowerCase(),p=parseFloat(e.maximumSlices);"key"===n?i.sort(function(t,e){return y(t.key,e.key,s)}):"value"===n?i.sort(function(t,e){return y(t.value,e.value,s)}):p=null,c=i.length;var u=!1;if(!isNaN(p)&&0<p&&p<c){var g;if("descending"===s?(g=i.slice(p),i=i.slice(0,p)):(g=i.slice(0,c-p),i=i.slice(c-p,c)),!0===e.showOther){var f=0;g.forEach(function(t){var e=t.value;isNaN(e)||(f+=e)}),i.push({key:"Other",value:f}),u=!0}c=i.length}var b=0;"undefined"!=typeof e.piePadding&&(b=e.piePadding*l/180);var L=d3.pie().value(function(t){return t.value}).sort(null).padAngle(b);i=L(i);var T=javaxt.dhtml.utils.getRect(o.node()),D=T.width,E=T.height,F=d.append("g");F.attr("transform","translate("+D/2+","+E/2+")");var R=r(D,E)/2,B=e.pieCutout;null==B&&(B=.65);var P,S=R*B;!0===e.showTooltip&&(P=A());var O=function(t,e){if(P){var a=h.getTooltipLabel(e.data);P.html(a).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},M=function(t){P&&P.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},Y=function(){P&&P.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},z=u?c-1:c,K=v(z,e.colors);u&&K.push(e.otherColor);var V=d3.arc().innerRadius(S).outerRadius(R),j=F.append("g");j.attr("name","pie"),j.selectAll("*").data(i).enter().append("path").attr("d",V).attr("fill",function(t,e){return K[e]}).attr("stroke",e.borderColor).style("stroke-width","1px").on("mouseover",O).on("mousemove",M).on("mouseleave",Y);var N,I=!0===e.showLabels;if(I&&"undefined"!==i[0].data.key&&!isNaN(i[0].value)){N=F.append("g"),N.attr("name","labels");var G=parseFloat(e.labelOffset);(isNaN(G)||0>G)&&(G=100);var X=0;if(100<G)X=R*(G/100);else{var H=R-S;X=S+H*(G/100)}var w=!0===e.extendLines;w&&110>=G&&(w=!1);var U,W=d3.arc().innerRadius(S).outerRadius(S+90*(R-S)/50),_=d3.arc().innerRadius(R).outerRadius(R+2*(X-R)),q=!1;let t=[];var Z=F.append("g");Z.attr("name","lines"),Z.selectAll("*").data(i).enter().append("polyline").attr("opacity","0").attr("stroke",e.lineColor).style("fill","none").attr("stroke-width",1).attr("points",function(e){var r=W.centroid(e),a=_.centroid(e),i=[r,a],n=e.startAngle+(e.endAngle-e.startAngle)/2,o=!!(n<l);return w&&i.push([X*(o?1:-1),a[1]]),t.push(i[i.length-1]),i}),110<G&&Z.selectAll("polyline").attr("opacity","1"),N.selectAll("*").data(i).enter().append("text").text(function(t){return h.getKeyLabel(t.data.key,t.data)}).attr("transform",function(e,a){return"translate("+t[a]+")"}).style("text-anchor",function(t,e){if(e==c-1&&!w)return"middle";var a=t.startAngle+(t.endAngle-t.startAngle)/2;return a<l?"start":"end"});var J=m(d);if(J.width=1.1*(J.maxX-J.minX),J.height=1.1*(J.maxY-J.minY),J.width>D||J.height>E){var Q,$,tt,et=J.width-D,at=J.height-E;et>at?(Q=D/J.width,1<Q&&(Q=1+(1-Q)),$=D/2,tt=E/2):at>et&&(Q=E/J.height,$=D/2,tt=J.height),F.attr("transform","translate("+$+","+tt+") scale("+Q+")");var tt=T.y,$=T.x,lt=T.x+T.width/2,rt=T.y+T.height/2,T=javaxt.dhtml.utils.getRect(F.node()),it=(E-T.height)/2,nt=(D-T.width)/2,ot=T.x+T.width/2,st=T.y+T.height/2,nt=lt-ot,it=rt-st;0>it&&(it=0),0>nt&&(nt=0),F.attr("transform","translate("+(D/2+nt)+","+(E/2+it)+") scale("+Q+")")}}var dt=e.animationSteps;if(!isNaN(dt)&&50<dt){var ct=0;dt/=2;var ht=j.selectAll("path"),pt=d3.arc().innerRadius(0).outerRadius(0);if(ht.attr("d",pt),ht.transition().delay(function(t,e){var r=a(t.startAngle-t.endAngle)+t.padAngle,i=r/(2*l),n=ct,o=i*dt;return ct+=o,n}).duration(function(t){var e=a(t.startAngle-t.endAngle)+t.padAngle,r=e/(2*l);return r*dt}).ease(d3.easeLinear).attrTween("d",function(e){var a=d3.interpolate(e.startAngle,e.endAngle);return function(l){return e.endAngle=a(l),V(e)}}),I){var ut=N.selectAll("text"),gt=Z.selectAll("polyline");gt.attr("opacity",0),ut.attr("opacity",0);var yt=function(t,e){return e*dt/c};110<G&&gt.transition().delay(yt).duration(dt).attr("opacity",1),ut.transition().delay(yt).duration(dt).attr("opacity",1)}}}},y=function(t,e,a){var l="string"==typeof t&&"string"==typeof e;return a=(a+"").toLowerCase(),"descending"===a?l?e.localeCompare(t):e-t:l?t.localeCompare(e):t-e},m=function(t){var e=i,a=0,l=i,o=0;return t.selectAll("*").each(function(){var t=javaxt.dhtml.utils.getRect(d3.select(this).node());e=r(t.left,e),a=n(t.right,a),l=r(t.top,l),o=n(t.bottom,o)}),{minX:e,maxX:a,minY:l,maxY:o}},f=javaxt.dhtml.utils.merge,x=bluewave.chart.utils.onRender,k=bluewave.chart.utils.isArray,b=bluewave.chart.utils.initChart,v=bluewave.chart.utils.getColorRange,A=bluewave.chart.utils.createTooltip,C=bluewave.chart.utils.createKeyValueDataset,L=javaxt.dhtml.utils.round;p()},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.MapChart=function(t,e){var r,i,n,o,s,d,c,h,a=Math.abs,l=Math.PI,u=this,p={style:{backgroundColor:"#fff"}},g=!1,y=[],m={},f="Mercator",x=function(){e=B(e,p),O(t,function(t,e){r=t,i=e}),r.call(d3.zoom().scaleExtent([1,1]).on("zoom",v)),r.on("click",function(t){var e=u.getProjection();if(e){var a=d3.pointer(t),l=e.invert(a);u.onMouseClick(l[1],l[0],t)}})};this.addPoints=function(t,e){y.push({type:"points",features:t,config:e})},this.addLines=function(t,e){y.push({type:"lines",features:t,config:e})},this.addPolygons=function(t,e){y.push({type:"polygons",features:t,config:e})},this.addLabels=function(t,e){y.push({type:"labels",features:t,config:e})},this.addGrid=function(t){y.push({type:"grid",features:null,config:t})},this.setBackgroundColor=function(t){e.style.backgroundColor=t,t&&h&&h.attr("fill",t)},this.getProjection=function(){return n},this.setProjection=function(t){f=t,n=d3["geo"+t]()},this.getCentroid=function(t){if(!t)return null;n||u.setProjection("Mercator");var e=d3.geoPath(n);if(P(t)){var a="Point";P(t[0])&&(a="Polygon"),t={type:"Feature",geometry:{type:a,coordinates:t}}}var l=e.centroid(t);return l=n.invert(l),l},this.onRecenter=function(t,e){},this.onRedraw=function(){},this.onMouseClick=function(t,a,l){},this.enablePan=function(){g=!1},this.disablePan=function(){g=!0},this.clear=function(){k(),n=o=s=d=c=null,y=[]};var k=function(){i.node().innerHTML="",i.attr("transform",null)};this.resize=function(){i},this.setCenter=function(e,a){var r=t.offsetWidth,i=t.offsetHeight;a||(a=r/2/l),n.rotate([-e[0],0]).center([0,e[1]]).scale(a).translate([r/2,i/2])},this.getMidPoint=function(t,e,a){n||u.setProjection("Mercator"),isNaN(e)&&(e=0),a="south"===a?1:-1;var l=t.slice();l[0]=n(l[0]),l[1]=n(l[1]),0>l[1][0]-l[0][0]&&l.reverse();var r=(l[0][0]+l[1][0])/2,i=(l[0][1]+l[1][1])/2,o=l[1][0]-l[0][0],s=l[1][1]-l[0][1],d=[-s*e*a,o*e*a],c=[d[0]+r,d[1]+i];return c=n.invert(c),c},this.update=function(t){k();var e=r.node().parentNode;S(e,function(){b(e),t&&t()})};var b=function(t){k();var a=t.offsetWidth,r=t.offsetHeight,i=parseFloat(e.lat),h=parseFloat(e.lon);return isNaN(i)&&(i=0),isNaN(h)&&(h=0),n||u.setProjection("Mercator"),"AlbersUsa"===f?(n.translate([a/2,r/2]),void C()):void(n.scale(a/2/l).rotate([-h,0]).center([0,i]).translate([a/2,r/2]),o=n.scale(),s=n.translate(),d=n.rotate(),c=n.center(),A(m),C())},v=function(a){var e=u.getProjection();if(e&&!g){var l=javaxt.dhtml.utils.getRect(r.node()),i=l.width,n=l.height,o=a.transform,t=i/2-o.x,h=n/2-o.y,y=e.invert([t,h]),p=d3.scaleLinear().domain([0,n]).range([0,180]),m=d3.scaleLinear().domain([0,i]).range([0,360]),f=s[0]-o.invertX(s[0]),x=s[1]-o.invertY(s[1]),k=p(x)/2+c[1],b=m(f)+d[0];e.rotate([b,d[1],d[2]]),e.center([0,k]),C(),u.onRecenter(y[1],y[0])}};this.getExtent=function(){var t=u.getProjection();if(t){var e=javaxt.dhtml.utils.getRect(r.node()),a=e.width,l=e.height,i=t.invert([0,0]),n=t.invert([a,l]);return{left:i[0],right:n[0],top:i[1],bottom:n[1]}}},this.setExtent=function(t,e,a){m.upperLeft=t,m.lowerRight=e,n?(A(m),a&&a()):u.update(function(){A(m),a&&a()})};var A=function(t,e=10){if(!(0>e||isNaN(e))&&n&&"AlbersUsa"!==f&&t.upperLeft&&t.lowerRight){var l=t.upperLeft,i=t.lowerRight,o=n.scale(),s=u.getExtent(),d=javaxt.dhtml.utils.getRect(r.node()),c=d.width,p=d.height;"Albers"==f&&n.parallels([i[1]+a(i[1]*(1/6)),l[1]-a(l[1]*(1/6))]);var h=n([s.left,s.top]),g=n([s.right,s.bottom]),y=a(h[0]-g[0]),m=a(h[1]-g[1]);n(l)[0]>n(i)[0]&&n.rotate([-l[0]-180,0]);var x,k=n(l),b=n(i),v=a(k[0]-b[0]);x=v/y,n.scale(o/x),k=n(l),b=n(i);var w=[k[0]+c/2,k[1]+p/2],C=n.invert(w);n.rotate([-C[0],0]).center([0,C[1]]),C=u.getMidPoint([l,i]);var L=u.getExtent(),T=a(i[1]-L.bottom);if(i[1]<L.bottom){let t=L.top-L.bottom,e=T/t;e++;let a=n.scale();n.scale(a/e)}n.rotate([-C[0],0]).center([0,C[1]]),A(t,--e)}},C=function(){k();var t=i.append("g");t.attr("name","background"),h=t.append("rect").attr("width","100%").attr("height","100%"),e.style.backgroundColor&&h.attr("fill",e.style.backgroundColor);var a=i.append("g");a.attr("name","layers");var l=d3.geoPath(n);y.forEach(function(t,e){t.config||(t.config={});var r=t.config.name;r||(r="layer"+e);var i=a.append("g");i.attr("name",r),"points"===t.type?L(t,i,l):"lines"===t.type&&T(t,i,l),"polygons"===t.type?E(t,i,l):"labels"===t.type?F(t,i,l):"grid"===t.type&&D(t,i,l)})},L=function(t,e,a){t.config||(t.config={});var l=t.config,r=t.config.style;r||(r={});var i;!0===l.showTooltip&&(i=M());var o=!1;(i||l.onClick)&&(o=!0);var s=r.fill;s||(s="red");var d=r.opacity;d||(d=1);var c=parseInt(r.radius);isNaN(c)&&(c=3),0>c&&(c=1);var h=parseFloat(r.outlineWidth);isNaN(h)&&(h=1);var p=r.outlineColor,g=e.selectAll("*").data(t.features).enter().append("circle").attr("r",function(t){return"function"==typeof r.radius?r.radius(t):c}).attr("transform",function(t){var e=R(t);return e&&(e=n(e)),e?"translate("+e+")":""}).attr("opacity",d).style("fill",s).attr("stroke",p).attr("stroke-width",h).attr("stroke-opacity",d).on("click",function(a,e,r,i){l.onClick&&l.onClick.apply(u,[{feature:e,element:i[r],layer:t,event:a}])});t.elements=g},T=function(t,e,a){t.config||(t.config={});var l=t.config.style;l||(l={});var r=parseInt(l.width);isNaN(r)&&(r=1);var i=l.lineStyle;i||(i="solid");var o=l.smoothing;o&&"none"!==o||(o="curveLinear");var s=l.color;s||(s="red");var d=l.opacity;d||(d=1);var c=e.selectAll("*").data(t.features).enter().append("path").attr("d",function(t){var e=d3.line().curve(d3[o]),a=t.map(t=>n(t));return e(a)}).attr("fill","none").attr("opacity",d).style("stroke",s).style("stroke-width",r).attr("stroke-dasharray",function(t){if("dashed"===i)return"10, 10";return"dotted"===i?"0, 10":void 0}).attr("stroke-linecap",function(t){if("dotted"===i)return"round"});t.elements=c},D=function(t,e,a){t.config||(t.config={});var l=t.config.style;l||(l={});var r=parseInt(l.width);isNaN(r)&&(r=.5);var i=l.lineStyle;i||(i="solid");var n=l.color;n||(n="gray");var o=l.opacity;o||(o=.5);var s=l.longSteps;s||(s=10);var d=l.latSteps;d||(d=10);var c=d3.geoGraticule().step([s,d]),h=e.selectAll("*").data([c()]).enter().append("path").attr("d",a).attr("fill","none").attr("opacity",o).style("stroke",n).style("stroke-width",r).attr("stroke-dasharray",function(t){if("dashed"===i)return"10, 10";return"dotted"===i?"0, 10":void 0}).attr("stroke-linecap",function(t){if("dotted"===i)return"round"});t.elements=h},E=function(t,e,a){t.config||(t.config={});var l=t.config,r=t.config.style;r||(r={});var i,n;!0===l.showTooltip&&(n=l.getTooltipLabel,n&&(i=M()));var o=!1;(i||l.onClick)&&(o=!0);var s=function(a,e){if(i){var r=n(e);i.html(r).show()}var s=d3.select(this);o&&(s.transition().duration(100),s.attr("opacity","0.8")),l.onMouseOver&&l.onMouseOver.apply(u,[{feature:e,element:s,layer:t}])},d=function(t){i&&i.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},c=function(a,e){i&&i.style("opacity",0).style("display","none");var r=d3.select(this);o&&(r.transition().duration(100),r.attr("opacity","1")),l.onMouseLeave&&l.onMouseLeave.apply(u,[{feature:e,element:r,layer:t}])},h=r.fill;h||(h="#DEDDE0");var p=r.stroke;p||(p="#fff");var g=e.selectAll("*").data(t.features).enter().append("path").attr("d",a).attr("fill",function(t){return"function"==typeof r.fill?r.fill(t):h}).attr("stroke",p).style("stroke-width",.4).on("mouseover",s).on("mousemove",d).on("mouseleave",c).on("click",function(a,e,r,i){l.onClick&&l.onClick.apply(u,[{feature:e,element:i[r],layer:t,event:a}])});t.elements=g},F=function(t,e,a){t.config||(t.config={});var l=t.config,r=t.config.style;r||(r={});var i=parseFloat(r.fontSize);isNaN(i)&&(i=12);var o=r.color;o||(o=r.fill),o||(o="#000");var s=r.textAlign;s||(s="left");var d=e.selectAll("text").data(t.features).enter().append("text").attr("transform",function(t){var e=R(t);if(e){e=n(e);var a=e[0],l=e[1];return isNaN(a)||isNaN(l)?"":`translate(  ${a}, ${l}  )`}return""}).attr("font-size",i).attr("text-anchor",()=>"center"==s?"middle":s).style("fill",o).text(e=>e.properties&&t.config.label?e.properties[t.config.label]:"").on("click",function(e,a,r){l.onClick&&l.onClick.apply(u,[{feature:e,element:r[a],layer:t}])});t.elements=d},R=function(t){if(P(t))return t;return t.geometry?t.geometry.coordinates:null},B=javaxt.dhtml.utils.merge,P=bluewave.chart.utils.isArray,S=bluewave.chart.utils.onRender,O=bluewave.chart.utils.initChart,M=bluewave.chart.utils.createTooltip;x()},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.CalendarChart=function(t,e){var a,l,r=this,i={dayLabel:!0,yearLabel:!0,date:"date",value:"value",weekday:"monday",cellSize:17,colors:["#fff","#ebf5dc","#cbe9a5","#2a671a"],showTooltip:!1},n=function(){r.setConfig(e),c(t,function(t,e){a=t,l=e})};this.setConfig=function(t){e=t?s(t,i):i},this.onClick=function(t,e){},this.getCell=function(t){t=new Date(t);var e=t.getFullYear(),a=t.getMonth(),r=t.getDate(),i=null;return l.selectAll("rect").each(function(t){var l=t.getFullYear(),n=t.getMonth(),o=t.getDate();l===e&&n===a&&o===r&&(i=this)}),i},this.getTooltipLabel=function(t){return d3.utcFormat("%m/%d/%Y")(t.date)+"<br/>"+d3.format(",")(t.value)},this.clear=function(){l&&l.selectAll("*").remove()},this.update=function(t,l){r.clear(),1<arguments.length?e=s(t,i):l=arguments[0];var n=a.node().parentNode;d(n,function(){o(l)})};var o=function(t){r.clear();var a=e,n=e.cellSize,o=e.weekday,s=t=>"SMTWTFS"[t];t.forEach(t=>{var a=t[e.date],l=t[e.value];t[e.date]=new Date(a),t[e.value]=bluewave.chart.utils.parseFloat(l)}),t.sort(function(t,a){return a[e.date].getTime()-t[e.date].getTime()});var c=[],g=[],y={};t.forEach(t=>{var a=t[e.date],l=t[e.value];c.push(a),g.push(l);var r=a.getUTCFullYear();y[r+""]=r}),y=Object.values(y),y.sort(function(t,e){return e-t});const m="sunday"===o?t=>t:t=>(t+6)%7,f="sunday"===o?d3.utcSunday:d3.utcMonday,x="weekday"===o?5:7,k=n*(x+2);var b,v=10,A=u(g,10),w=p(A.length+1,e.colors),C=function(t){for(var e=0;e<A.length-1;e++){var a=A[e],l=A[e+1],r=w[e];if(t>=a&&t<l)return r;if(t==A[A.length-1])return w[w.length-1]}};!0===e.showTooltip&&(b=h());var L=function(t,e){if(b){var a=F.nodes().indexOf(this),l=r.getTooltipLabel({date:e,value:g[a]});b.html(l).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},T=function(t){b&&b.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},D=function(){b&&b.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},E=l.selectAll("*").data(y).join("g").attr("transform",(t,e)=>`translate(40.5,${k*e+1.5*n})`);a.yearLabel&&E.append("text").attr("class","chart-axis-label").attr("x",-5).attr("y",-5).attr("text-anchor","end").text(t=>t),a.dayLabel&&E.append("g").attr("class","tick").attr("text-anchor","middle").selectAll("text").data(function(t){var e=d3.range(7);return e.forEach(function(a,l){e[l]={day:a,year:t}}),e}).join("text").attr("x",-10).attr("y",function(t){return(m(t.day)+.5)*n}).attr("dy","0.31em").text(function(t){var e=t.day,a=t.year,l=!1;if(c.every(function(t){if(t.getUTCFullYear()===a){var r=t.getUTCDay();if(r===e)return l=!0,!1}return!0}),l||0<e&&6>e)return s(e)});var F=E.append("g").selectAll("*").data(function(t){var e=[];return c.forEach(function(a){a.getUTCFullYear()===t&&e.push(a)}),e}).join("rect").attr("width",n-1).attr("height",n-1).attr("x",t=>f.count(d3.utcYear(t),t)*n+.5).attr("y",t=>m(t.getUTCDay())*n+.5).attr("fill",function(t,a){var l=g[a],r=C(l);return r===e.colors[0]&&0<l&&(r=w[1]),r}).on("mouseover",L).on("mousemove",T).on("mouseleave",D).on("click",function(t,e){var a=F.nodes().indexOf(this);r.onClick(this,{date:e,value:g[a]})}),R=E.append("g").selectAll("g").data(function(t){var e,a;return c.forEach(function(l){l.getUTCFullYear()===t&&(!a&&(a=l),e=l)}),e=new Date(e.getTime()),a=new Date(a.getTime()),e.setMonth(e.getMonth()-1),a.setMonth(a.getMonth()+1),d3.utcMonths(e,a)}).join("g");R.filter((t,e)=>e).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",3).attr("d",function(t){const e=Math.max(0,Math.min(x,m(t.getUTCDay()))),a=f.count(d3.utcYear(t),t);return`${0===e?`M${a*n},0`:e===x?`M${(a+1)*n},0`:`M${(a+1)*n},0V${e*n}H${a*n}`}V${x*n}`});var B={};R.append("text").attr("class","tick").attr("x",t=>f.count(d3.utcYear(t),f.ceil(t))*n+2).attr("y",-5).text(function(t){var e=d3.utcFormat("%b")(t),a=d3.utcFormat("%Y")(t),l=a+"-"+e,r=!1;if(c.every(function(t){var e=d3.utcFormat("%b")(t),a=d3.utcFormat("%Y")(t),i=a+"-"+e;return i!==l||(r=!0,!1)}),r&&!B[l])return B[l]=!0,e})},s=javaxt.dhtml.utils.merge,d=bluewave.chart.utils.onRender,c=bluewave.chart.utils.initChart,h=bluewave.chart.utils.createTooltip,p=bluewave.chart.utils.getColorRange,u=bluewave.chart.utils.getNaturalBreaks;n()},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.TreeMapChart=function(t,e){var l,r,n,o,s,a=Math.max,c=this,i={key:"name",value:"value",shape:"square",groupBy:null,colors:d3.schemeCategory10,keyLabel:!0,valueLabel:!0,groupLabel:!0,showTooltip:!1,style:{keyLabel:{"font-size":"14px",color:"#fff"},valueLabel:{"font-size":"11px",color:"#fff"},groupLabel:{"font-size":"16px"}}},d=function(){c.setConfig(e),C(t,function(t,e){l=t,r=e})};this.setConfig=function(t){e=t?v(t,i):i,n=!(!0!==e.showTooltip)&&L()},this.getTooltipLabel=function(t,e){var a=t.name;return t.group&&0<t.group.length&&(a+=" ("+t.group+")"),a+"<br/>"+c.getValueLabel(t.value)},this.getKeyLabel=function(t,e){return t},this.getValueLabel=function(t,e){var a=bluewave.chart.utils.parseFloat(t);return isNaN(a)?t:w(a,2)},this.onClick=function(t,e){},this.onDblClick=function(t,e){},this.clear=function(){r&&r.selectAll("*").remove(),s=null},this.update=function(t,e){c.clear(),1<arguments.length?c.setConfig(t):e=arguments[0];var a=l.node().parentNode;A(a,function(){u(e)})},this.getGroup=function(t){var e=[];return s&&s.each(function(a){a.data.group===t&&e.push({rect:d3.select(this).node(),data:a.data})}),e};var h=(t,e,a)=>{if(!t)return null;if(Array.isArray(t))for(const l of t){const t=h(l,e,a);if(t)return l}else{if(t.hasOwnProperty(e)&&t[e]===a)return t;for(const l of Object.keys(t))if("object"==typeof t[l]){const r=h(t[l],e,a);if(null!==r&&"undefined"!=typeof r)return r}return null}},p=function(t){var a=[];if(null!==e.groupBy){var l={};t.forEach(t=>{var a=t[e.groupBy];l[a]=!0}),a=Object.keys(l)}var r=[];t.forEach(t=>{var a=t[e.value],l=bluewave.chart.utils.parseFloat(a);0==l||isNaN(l)||(t[e.value]=l,r.push(t))}),r.length!==t.length&&(t=r);var n={children:[],name:"all"};if(null!==e.groupBy){a.forEach(a=>{n.children.push({name:a,children:[],colname:"level2"});var l=h(n.children,"name",a);t.forEach(t=>{var r=t[e.key],i=t[e.groupBy],n=t[e.value];if(a===i)if("undefined"!=typeof h(l.children,"name",r)){var o=h(l.children,"name",r);o.value+=n}else l.children.push({name:r,group:i,colname:"level3",value:n})})});var o={};n.children.forEach(t=>{var e=0;t.children.forEach(t=>{e+=t.value}),o[t.name]=e});var s=[];for(var c in o)if(o.hasOwnProperty(c)){var p=o[c];0==p&&s.push(c)}for(;0<s.length;)for(var u=s.shift(),g=0;g<n.children.length;g++)if(n.children[g].name==u){n.children.splice(g,1);break}n.children.sort((t,e)=>o[e.name]-o[t.name]),a=[],n.children.forEach(t=>{a.push(t.name)})}else{n.children.push({name:"",children:[],colname:"level2"});var y=h(n.children,"name","");t.forEach(t=>{var a=t[e.key],l=t[e.value],r="";if("undefined"!=typeof h(y.children,"name",a)){var i=h(y.children,"name",a);i.value+=l}else y.children.push({name:a,group:r,colname:"level3",value:l})})}var m=d3.hierarchy(n).sum(t=>t.value),f=m.leaves(),x=m.descendants().filter(t=>1==t.depth);return{root:m,leaves:f,descendants:x,groupNames:a,children:n.children}},u=function(t){t=p(t);var a=t.groupNames;o="undefined"==typeof a?d3.scaleOrdinal().range(e.colors):d3.scaleOrdinal().domain(a).range(e.colors);var r=javaxt.dhtml.utils.getRect(l.node());"circle"===e.shape?y(t,r):g(t,r)},g=function(t,l){var i=0;if(e.groupLabel&&1<t.descendants.length){var n=r.append("text").attr("x",0).attr("y",0).attr("text-anchor","start").text("Iq");T(n,e.style.groupLabel),i=n.node().getBBox().height,n.remove()}d3.treemap().size([l.width,l.height]).paddingTop(i).paddingInner(0)(t.root);var p=function(e,a){var l=h(t.children,"name",a),r=[];l.children.forEach(t=>{r.push(t.value)});var i=d3.scaleLinear().domain([d3.min(r),d3.max(r)]).range([.5,1]);return i(e)};s=r.selectAll("rect").data(t.leaves).enter().append("rect").attr("x",t=>t.x0).attr("y",t=>t.y0).attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).style("stroke","white").style("fill",t=>o(t.parent.data.name)).style("opacity",t=>p(t.data.value,t.data.group)).on("mouseover",f).on("mousemove",x).on("mouseleave",k).on("click",function(t,e){c.onClick(this,e.data)}).on("dblclick",function(t,e){c.onDblClick(this,e.data)});var u=[],g=3;if(e.keyLabel&&s.each(function(a){var l=c.getKeyLabel(a.data.name,a.data),i=d3.select(this).node(),n=i.getBBox(),o=n.x+n.width,s=n.y+n.height,d=r.append("text").attr("x",n.x+2).attr("y",n.y).attr("text-anchor","start").text(l);T(d,e.style.keyLabel);var h=d.node().getBBox();d.attr("y",n.y+h.height/2+g),h=d.node().getBBox();var p=h.x+h.width,y=h.y+h.height,m=0;p>o?d.remove():y>s?d.remove():m=h.y+h.height,u.push(m)}),e.valueLabel&&s.each(function(a,l){var i=u[l];if(!(0===i&&e.keyLabel)){var n=c.getValueLabel(a.data.value,a.data),o=d3.select(this).node(),s=o.getBBox(),d=s.x+s.width,h=s.y+s.height,p=r.append("text").attr("x",s.x+2).attr("y",s.y).attr("text-anchor","start").text(n);T(p,e.style.valueLabel);var g=p.node().getBBox();p.attr("y",i+g.height/2),g=p.node().getBBox();var y=g.x+g.width,m=g.y+g.height;y>d?p.remove():m>h&&p.remove()}}),e.groupLabel&&0<i){var y=r.selectAll("titles").data(t.descendants).enter().append("text").attr("x",t=>t.x0+1).attr("y",t=>t.y0+i-g).text(t=>t.data.name).attr("fill",t=>o(t.data.name)),m=[];y.each(function(t,l){T(this,e.style.groupLabel);var r=this.getBBox(),i=r.x+r.width,n=0;t.children.forEach(t=>{n=a(t.x1,n)}),i>n&&m.push(d3.select(this))}),m.forEach(t=>{t.remove()})}},y=function(t,a){var l=a.width,i=a.height,n=Math.min(l,i)/2-5,d=[l/2,i/2],h=r.append("g").attr("transform","translate("+d+")"),p=m(60,n);h.append("path").attr("transform","translate("+[-n,-n]+")").attr("d","M"+p.join(",")+"Z"),d3.voronoiTreemap().clip(p)(t.root),s=h.append("g").attr("transform","translate("+[-n,-n]+")").selectAll("path").data(t.leaves).enter().append("path").attr("d",function(t){return"M"+t.polygon.join(",")+"z"}).style("fill",t=>o(t.parent.data.name)).style("stroke","white").on("mouseover",f).on("mousemove",x).on("mouseleave",k).on("click",function(t,e){c.onClick(this,e.data)}).on("dblclick",function(t,e){c.onDblClick(this,e.data)});var u,g;(e.keyLabel||e.valueLabel)&&(u=h.append("g").attr("transform","translate("+[-n,-n]+")"),g=[],s.each(function(t){var e=d3.polygonCentroid(t.polygon);g.push(e)}));var y=[];e.keyLabel&&s.each(function(a,l){var r=c.getKeyLabel(a.data.name,a.data),i=g[l],n=u.append("text").attr("x",i[0]).attr("y",i[1]).attr("text-anchor","middle").attr("dominant-baseline","middle").text(r);T(n,e.style.keyLabel);var o=0;if(b(n,a))n.remove();else{var s=n.node().getBBox();o=s.y+s.height+4}y.push(o)}),e.valueLabel&&s.each(function(a,l){var r=y[l];if(!(0===r&&e.keyLabel)){var i=c.getValueLabel(a.data.value,a.data),n=g[l],o=u.append("text").attr("x",n[0]).attr("y",r).attr("text-anchor","middle").attr("dominant-baseline","middle").text(i);T(o,e.style.valueLabel);var s=o.node().getBBox();s.y<r&&o.attr("y",r),b(o,a)&&o.remove()}})},m=function(t,e){for(var l=2*Math.PI/t,r=[],n=0,o=0;o<t;o++,n+=l)r.push([e+e*Math.cos(n),e+e*Math.sin(n)]);return r},f=function(t,e){if(n){var a=s.nodes().indexOf(this),l=c.getTooltipLabel(e.data,a);n.html(l).show()}d3.select(this).transition().duration(100).attr("opacity","0.8")},x=function(t){n&&n.style("top",t.clientY+"px").style("left",t.clientX+20+"px")},k=function(){n&&n.hide(),d3.select(this).transition().duration(100).attr("opacity","1")},b=function(e,l){var r=e.node().getBBox(),t=[[r.x,r.y],[r.x+r.width,r.y],[r.x+r.width,r.y+r.height],[r.x,r.y+r.height],[r.x,r.y]],n=bluewave.chart.utils.clipPolygon(l.polygon,t),o=!0;if(!n)o=!1;else if(5===n.length){for(var s=0,d=0;d<n.length;d++){var c=n[d],h=t[d];c[0]===h[0]&&c[1]===h[1]&&s++}5===s&&(o=!1)}return o},v=javaxt.dhtml.utils.merge,A=bluewave.chart.utils.onRender,w=javaxt.dhtml.utils.round,C=bluewave.chart.utils.initChart,L=bluewave.chart.utils.createTooltip,T=bluewave.chart.utils.setStyle;d()},!bluewave)var bluewave={};if(bluewave.chart||(bluewave.chart={}),bluewave.chart.Line=function(t){var e=this,a={color:"#6699CC",opacity:1,width:1,style:"solid",fill:{color:"#6699CC",startOpacity:0,endOpacity:0},point:{color:"#6699CC",radius:0},label:"",smoothing:"none",smoothingValue:0},l=function(){if(!t)return void(t=a);var l=t;t=a,e.setConfig(l)};this.setColor=function(e){e=r(e),e&&(t.color=e)},this.setOpacity=function(e){e=i(e),isNaN(e)||(t.opacity=e)},this.setWidth=function(e){e=parseFloat(e),!isNaN(e)&&0<e&&(t.width=e)},this.setStyle=function(e){e&&(e=(e+"").toLowerCase(),("solid"===e||"dashed"===e||"dotted"===e)&&(t.style=e))},this.setFill=function(e){if(!e)delete t.fill;else{var a=r(e.color);a&&(t.fill.color=a);var l=i(e.startOpacity);isNaN(l)||(t.fill.startOpacity=l);var l=i(e.endOpacity);isNaN(l)||(t.fill.endOpacity=l)}},this.setPoint=function(e){if(!e)delete t.point;else{var a=r(e.color);a&&(t.point.color=a);var l=parseFloat(e.radius);!isNaN(l)&&0<l&&(t.point.radius=l)}},this.setLabel=function(e){t.label=e},this.setSmoothing=function(e){if(e){switch(e=(e+"").toLowerCase(),e){case"spline":case"simple spline":e="spline";break;case"moving average":case"movingaverage":e="movingAverage";break;case"kernel density estimation":case"kde":e="kde";break;case"curvenatural":e="curveNatural";break;default:e="none"}t.smoothing=e}},this.setSmoothingValue=function(e){e=parseFloat(e),isNaN(e)||0>e||(t.smoothingValue=e)},this.getConfig=function(){return t},this.setConfig=function(t){for(var a in t)if(t.hasOwnProperty(a)){var l="set"+a.substring(0,1).toUpperCase()+a.substring(1);e[l]&&e[l].apply(e,[t[a]])}},this.getColor=()=>t.color,this.getWidth=()=>t.width,this.getStyle=()=>t.style,this.getFill=()=>t.fill,this.getPoint=()=>t.point,this.getLabel=()=>t.label,this.getSmoothing=()=>t.smoothing,this.getSmoothingValue=()=>t.smoothingValue,this.clone=function(){let e=Object.assign({},t);return new bluewave.chart.Line(e)};var r=function(t){return t},i=function(t){return t=parseFloat(t),isNaN(t)?null:0>t||1<t?null:t};l()},!bluewave)var bluewave={};if(bluewave.charts||(bluewave.charts={}),bluewave.charts.SankeyChart=function(t,a){var r,i,n,l=Math.max,o=this,e={margin:{top:10,right:10,bottom:10,left:10},links:{color:"#ccc",opacity:.3}},s=[],d=[],c=d3.scaleOrdinal(d3.schemeCategory10),h=function(){o.setConfig(a),m(t,function(t,e){r=t,i=e})};this.setConfig=function(t){a=t?g(t,e):e},this.getChart=function(){return n},this.getNodeColor=function(t){return c(t.name.replace(/ .*/,""))},this.getNodeLabel=function(t){return t.name},this.addNode=function(t,e){if(t){var a;return a=t.name?t:{name:t,group:e},s.push(a),a}},this.addLink=function(t,e,a){if(t&&e){t.name&&(t=t.name),e.name&&(e=e.name);var l={source:t,target:e,value:a};return d.push(l),l}},this.clear=function(){p(),s=[],d=[]},this.update=function(t,e){o.setConfig(t),e&&(o.clear(),e.nodes&&(s=e.nodes),e.links&&(d=e.links));var a=r.node().parentNode;y(a,function(){u(a)})};var p=function(){i&&i.selectAll("*").remove()},u=function(t){p();var e=t.offsetWidth,r=t.offsetHeight;n=i.append("g"),n.attr("name","sankey").attr("width",e).attr("height",r);var c=d3.sankey().nodeId(t=>t.name).nodeWidth(20).nodePadding(20).iterations([6]).size([e,r]);let h=c({nodes:s,links:d});var u=c.size(),e=u[0],g=d3.format(",.0f"),y=function(t,e){var l;return l="source"===a.links.color?t.source.color:a.links.color,f(l,"white",1-e)},m=n.append("g");m.attr("name","links");var x=m.selectAll("*").data(h.links).enter().append("path").attr("class","sankey-link").attr("d",d3.sankeyLinkHorizontal()).attr("stroke-width",function(t){return l(t.width,1)}).on("mouseover",function(t,e){var l=Math.min(1,1.3*a.links.opacity),r=y(e,l);d3.select(this).style("stroke",r)}).on("mouseout",function(t,e){var l=y(e,a.links.opacity);d3.select(this).style("stroke",l)}),k=n.append("g");k.attr("name","nodes");var b=k.selectAll("*").data(h.nodes).enter().append("g").attr("class","sankey-node");b.append("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("height",function(t){return l(t.y1-t.y0,1)}).attr("width",c.nodeWidth()).style("fill",function(t){return t.color=o.getNodeColor(t)}).style("stroke",function(t){return d3.rgb(t.color).darker(2)}).append("title").text(function(t){return t.name+"\n"+g(t.value)}),x.each(function(){var t=d3.select(this);t.style("stroke",function(t){return y(t,a.links.opacity)})}),x.append("title").text(function(t){return t.source.name+" \u2192 "+t.target.name+"\n"+g(t.value)}),b.append("text").attr("x",function(t){return t.x0-6}).attr("y",function(t){return(t.y1+t.y0)/2}).attr("dy","0.35em").attr("text-anchor","end").text(function(t){return o.getNodeLabel(t)}).filter(function(t){return t.x0<e/2}).attr("x",function(t){return t.x1+6}).attr("text-anchor","start")},g=javaxt.dhtml.utils.merge,y=bluewave.chart.utils.onRender,m=bluewave.chart.utils.initChart,f=bluewave.chart.utils.mixColors;h()},!bluewave)var bluewave={};bluewave.charts||(bluewave.charts={}),bluewave.charts.LineChart=function(t,e){var r,n,o,s,c,d,h,a=Math.min,l=Math.max,p=this,i={xGrid:!1,yGrid:!1,scaling:"linear",stackValues:!1,endTags:!1,animationSteps:1500},u=[],g=function(){p.setConfig(e),T(t,function(t,e){r=t,n=e})};this.setConfig=function(t){e=t?C(t,i):i,p.setScaling(e.scaling)},this.setScaling=function(t){e.scaling="logarithmic"===t?"logarithmic":"linear"},this.displayEndTags=function(t){e.endTags=!(!0!==t)},this.getXAxis=function(){return d},this.getYAxis=function(){return h},this.clear=function(){m(),u=[]},this.update=function(){var t=r.node().parentNode;L(t,function(){f()})},this.addLine=function(t,e,a,l){u.push({line:t,data:e,xAxis:a+"",yAxis:l+""})},this.getLayers=function(){return u},this.setLayers=function(t){u=t};var m=function(){n&&n.selectAll("*").remove()},f=function(){m();var t=e,g=u.map(t=>t.data);if(0!==g.length){var y=javaxt.dhtml.utils.getRect(r.node()),f=y.width,x=y.height,w=x,C=f;o=n.append("g"),o.attr("width",f).attr("height",x);var L=t.endTags;!0===L||!1===L||(L=1<g.length);var T=!0===t.stackValues,B=!0===t.accumulateValues,P=[];u.forEach(function(t){t.data&&t.data.forEach(function(e){for(var a=e[t.xAxis],l=!0,r=0;r<P.length;r++)if(P[r]==a){l=!1;break}l&&P.push(a)})});var S=[];for(let t=0;t<u.length;t++){if(!u[t].line)continue;let e=u[t].xAxis,a=u[t].yAxis;if(e&&a){var O=R(u[t].data,e,a),M=u[t].line.getConfig();B&&O.forEach(function(t,e){var a=O[e].value;isNaN(a)&&(O[e].value=0),0<e&&(O[e].value+=O[e-1].value)});var Y=M.smoothing;if(Y){var z=M.smoothingValue;A(Y,z,O)}S.push({lineConfig:M,sumData:O})}}if(T){if(B)S.sort(function(t,e){return t=t.sumData,t=t[t.length-1].value,e=e.sumData,e=e[e.length-1].value,e-t});else{var K=[];S.forEach(function(t){var e=t.sumData,a=0;e.forEach(t=>a+=t.value),K.push({sumValue:a,sumData:e,lineConfig:t.lineConfig})}),K.sort(function(t,e){return e.sumValue-t.sumValue}),S=[],K.forEach(t=>S.push({sumData:t.sumData,lineConfig:t.lineConfig}))}var V=D(P),N={};S.forEach(function(t,e){var a=t.sumData,l="none",r=0,i=0,n=0;if(2>a.length);else{for(var o=0;o<a.length-1;o++){var s=a[o].key,d=a[o+1].key;if("date"==V)s=new Date(s).getTime(),d=new Date(d).getTime(),d>=s&&r++,d<=s&&i++;else if("number"==V||"currency"==V)s=bluewave.chart.utils.parseFloat(s),d=bluewave.chart.utils.parseFloat(d),d>s&&r++,d<s&&i++,d==s&&n++;else{var c=s.localeCompare(d);0>c&&r++,0<c&&i++,0==c&&n++}}r+n==a.length-1&&(l="asc"),i+n==a.length-1&&(l="desc");var h=N[l];h||(h=[],N[l]=h),h.push(e)}});var I=Object.keys(N),G=1==I.length?I[0]:null;G&&P.sort(function(t,e){return"number"==V||"currency"==V?"asc"==G?bluewave.chart.utils.parseFloat(t)-bluewave.chart.utils.parseFloat(e):bluewave.chart.utils.parseFloat(e)-bluewave.chart.utils.parseFloat(t):"date"==V?"asc"==G?new Date(t).getTime()-new Date(e).getTime():new Date(e).getTime()-new Date(t).getTime():"asc"==G?t.localeCompare(e):e.localeCompare(t)}),S.forEach(function(t){var e=t.sumData,a=[];for(P.forEach(function(t){for(var l,r=0;r<e.length;r++){var n=e[r].key,o=e[r].value;if(n==t){l=o;break}}a.push({key:t,value:l})});0<a.length;){var l=a[0].value;if(!isNaN(l))break;isNaN(l)&&a.shift()}t.sumData=a});var X=[];S.forEach(function(t,e){var a=t.sumData,l=[];a.forEach(function(t){l.push({key:t.key,value:t.value})}),a.forEach(function(t,e){var r=t.key,i=t.value;if(isNaN(i)){for(var o,s=e-1;-1<s;s--)if(o=a[s].value,!isNaN(o)){i=o;break}isNaN(i)&&(i=0)}for(var c,h,p=0;p<X.length;p++)h=X[p].sumData,h.every(function(t){var e=t.key,a=t.value;return!!(e!=r||isNaN(a))||(c=a,!1)});isNaN(c)||(i+=c),l[e].value=i}),X.push({lineConfig:t.lineConfig,sumData:l})}),S=X}var H=[],U=[];S.forEach(function(t){var e=t.sumData;P.forEach(function(t){t instanceof Date&&!T?t+="":!isNaN(t)&&!T&&(t+="");for(var r=0;r<e.length;r++){var n=e[r],o=n.key;if(o===t){for(var s,c=n.value,h=!1,p=0;p<H.length;p++)s=H[p],s.key==t&&(h=!0,s.value=a(s.value,c));h||H.push({key:t,value:c});for(var s,h=!1,p=0;p<U.length;p++)s=U[p],s.key==t&&(h=!0,s.value=l(s.value,c));h||U.push({key:t,value:c})}}})});var W=E(o,C,w,"key","value",U,H,e),_=W.margin;if(_){var q=_.left,Z=_.right,J=_.top,Q=_.bottom;if(L){var $=0,tt=0;u.forEach(function(t,e){if(t.line){var a=t.line.getLabel();if(a||(a="Series "+(e+1)),a){var r=o.append("text").attr("dy",".35em").attr("text-anchor","start").text(a),i=r.node().getBBox();r.remove();var n=l(i.width+8,60)+5;tt=i.height,$=l(n,$)}}}),Z=$+5,0<tt&&(J=l(tt/2,J))}(0<J||0<Q||0<q||0<Z)&&(w-=J+Q,C-=q+Z,o.selectAll("*").remove(),o.attr("transform","translate("+q+","+J+")"),W=E(o,C,w,"key","value",U,H,e)),_={top:J,right:Z,bottom:Q,left:q}}s=W.x,c=W.y,d=W.xAxis,h=W.yAxis;var et=[];for(let t=0;t<S.length;t++)et.push({area:null,line:null,line2:null,tag:null,point:null});var at=o.append("g");at.attr("name","fill");for(let t=S.length-1;-1<t;t--){var O=S[t].sumData;let a=S[t].lineConfig.fill,l=a.color,r=a.startOpacity,i=a.endOpacity;var Y=S[t].lineConfig.smoothing;let n=D(O[0].key);var lt=function(t){return"date"===n?s(new Date(t.key)):s(t.key)},rt=function(t){var a=bluewave.chart.utils.parseFloat(t.value);return"logarithmic"===e.scaling?c(a+1):c(a)};if(0===r&&0===i)continue;let o="fill-gradient-"+t;b(l,r,i,o,at),et[t].area=at.append("path").datum(O).attr("fill",`url(#${o})`).attr("d",d3.area().x(lt).y0(w).y1(rt))}var it=o.append("g"),nt=o.append("g");nt.attr("name","circles"),it.attr("name","lines");for(let t=0;t<S.length;t++){var O=S[t].sumData;let e=S[t].lineConfig,a=e.point,l=e.color,r=e.style,i=e.width,n=e.opacity,o=a.radius,s=a.color;var Y=e.smoothing,ot=function(){return Y&&"spline"===Y?d3.line().x(lt).y(rt).curve(d3.curveMonotoneX):d3.line().x(lt).y(rt)};if(et[t].line=it.append("path").datum(O).attr("fill","none").attr("stroke",l).attr("stroke-width",i).attr("opacity",n).attr("stroke-dasharray",function(t){return"dashed"===r?"5, 5":"dotted"===r?"0, 5":void 0}).attr("stroke-linecap",function(t){if("dotted"===r)return"round"}).attr("d",ot()),et[t].line2=it.append("path").datum(O).attr("dataset",t).attr("fill","none").attr("stroke","#ff0000").attr("stroke-width",10).attr("opacity",0).attr("d",ot()).on("click",function(t,e){var a=parseInt(d3.select(this).attr("dataset"));v(et[a]),p.onClick(this,a,e)}),o&&(et[t].point=nt.selectAll("points").data(O).enter().append("circle").attr("dataset",t).attr("fill",s).attr("stroke","none").attr("cx",lt).attr("cy",rt).attr("r",o).on("click",function(t,e){var a=parseInt(d3.select(this).attr("dataset"));v(et[a]),p.onClick(this,a,e)})),L){var st=e.label;st||(st="Series "+(t+1));var dt=et[t].line2;et[t].tag=k(O,l,st,dt)}}var ct=t.animationSteps;if(!isNaN(ct)&&50<ct){let t=it.selectAll("path"),a=nt.selectAll("circle"),l=at.selectAll("path"),r=d3.min(H,t=>bluewave.chart.utils.parseFloat(t.value)),i="logarithmic"===e.scaling?c(r):c(0);if(t.attr("d",d3.line().x(lt).y(i)),a.attr("cx",lt).attr("cy",i),l.attr("d",d3.area().x(lt).y0(w).y1(i)),t.transition().duration(ct).attr("d",ot()),a.transition().duration(ct).attr("cx",lt).attr("cy",rt),l.transition().duration(ct).attr("d",d3.area().x(lt).y0(w).y1(rt)),L)for(var ht=0;ht<et.length;ht++){var j=et[ht].tag.poly,pt=et[ht].tag.text,ut=j.attr("transform"),gt=pt.attr("transform"),yt=ut.slice(10).split(",")[0],mt=gt.slice(10).split(",")[0];j.attr("transform","translate("+yt+","+(w-9.6)+")"),pt.attr("transform","translate("+mt+","+w+")"),j.transition().duration(ct).attr("transform",ut),pt.transition().duration(ct).attr("transform",gt)}}(t.xGrid||t.yGrid)&&F(o,s,c,w,C,t.xGrid,t.yGrid)}};this.onClick=function(t,e,a){};var k=function(t,r,i,n){var d=t[t.length-1],p=d.key,u=d.value,g=D(t[0].key);if("date"===g)var y=s(new Date(p));else var y=s(p);var m="logarithmic"===e.scaling?c(u+1):c(u),f=o.append("text").attr("dy",".35em").attr("text-anchor","start").text(i),x=f.node().getBBox();f.remove();var k=l(x.width+8,60),b=x.height,h=b/2,a=[[0,0],[k,0],[k,b],[0,b],[-h,h]],v=o.append("polygon").attr("points",a.join(" ")).attr("transform","translate("+(y+h)+","+(m-h)+")").style("fill",r).on("click",function(t,e){n.dispatch("click")}),A=o.append("text").attr("transform","translate("+(y+h+4)+","+m+")").attr("dy",".35em").attr("text-anchor","start").style("fill","#fff").text(i).on("click",function(t,e){n.dispatch("click")});return{poly:v,text:A}},b=function(t,e,a,l,r){null==e&&(e=0),null==a&&(a=0),r.append("defs").append("linearGradient").attr("id",l).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data([{offset:"0%",color:t,opacity:e},{offset:"100%",color:t,opacity:a}]).enter().append("stop").attr("offset",t=>t.offset).attr("stop-color",t=>t.color).attr("stop-opacity",t=>t.opacity)},v=function(t){if(t){t.line.raise(),t.line2.raise(),t.point&&t.point.raise();var e=t.tag;if(e){var a=e.poly.node().parentNode,l=e.poly.node().cloneNode(!0),r=e.text.node().cloneNode(!0);e.poly.remove(),e.text.remove(),a.appendChild(l),a.appendChild(r),t.tag.poly=d3.select(l),t.tag.text=d3.select(r)}}},A=function(t,e,a){if("movingAverage"===t){if(!isNaN(e)&&0<e){function t(t,e){let a=[t[0]],l=0;for(let r=1;r<e;r++)l+=t[r],a.push(l/r);for(let l,r=e;r<t.length;r++)l=d3.mean(t.slice(r-e/2,r+e/2)),a.push(l);return a}var l=a.map(t=>t.value);let r=t(l,e);a.forEach(function(t,e){t.value=r[e]})}}else if("kde"===t){var l=a.map(t=>t.value),r=l.length,n=d3.extent(l),o=n[0],s=n[1],c=l.reduce((t,e)=>t+e,0),h=(s-o)/r;h=Math.round(h);for(var p=[],u=0;u<l.length;u++)for(var d=0;d<l[u];d++)p.push(u+.5),d+=h;for(var g,y=[],m=w(e),u=0;u<l.length;u++)g=d3.mean(p,function(t){return m(u-t)}),y.push([u,g]);a.forEach(function(t,e){t.value=y[e][1]*c})}},w=function(t){return e=>1>=Math.abs(e/=t)?.75*(1-e*e)/t:0},C=javaxt.dhtml.utils.merge,L=bluewave.chart.utils.onRender,T=bluewave.chart.utils.initChart,D=bluewave.chart.utils.getType,E=bluewave.chart.utils.drawAxes,F=bluewave.chart.utils.drawGridlines,R=bluewave.chart.utils.createKeyValueDataset;g()};
