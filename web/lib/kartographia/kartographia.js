if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!kartographia){var kartographia={}}kartographia.Map=function(m,I){this.className="com.kartographia.Map";var r=this;var S={basemap:"osm",layers:[],center:[45,20],zoom:5,maxZoom:19,style:{info:{background:"rgba(255, 255, 255, 0.5)",fontFamily:'"MS Sans Serif",tahoma,arial,helvetica,sans-serif',fontSize:"8pt",color:"rgba(0,0,0,0.85)",cursor:"default"},coord:{padding:"0 3px 0 0",margin:"0 0 0 -5px",overflowX:"hidden",width:"100px",textAlign:"right"}},coordinateFormat:"DMS",renderers:{zoomControl:null}};var v,K;var s;var f=false;var x=new ol.format.WKT();var T=new ol.source.Vector();var c=new ol.layer.Vector({source:new ol.source.Vector({})});var A;var E;var a,L,e,y;var F;var C=[];var u=-1;var N=false;var l=false;var R=function(){if(typeof m==="string"){m=document.getElementById(m)}if(!m){return}var Z={};J(Z,I);var Y=Z.basemap;if(Y){delete Z.basemap}J(Z,S);I=Z;if(Y){I.basemap=Y}var W=document.createElement("div");W.style.position="relative";W.style.height="100%";W.setAttribute("desc",r.className);m.appendChild(W);r.el=W;a=document.createElement("div");G(a,I.style.info);a.style.position="absolute";a.style.left=0;a.style.bottom=0;a.style.zIndex=1;W.appendChild(a);L=document.createElement("div");G(L,I.style.info);L.style.position="absolute";L.style.right=0;L.style.bottom=0;L.style.zIndex=1;W.appendChild(L);e=document.createElement("div");G(e,I.style.coord);e.style.display="inline-block";L.appendChild(e);y=e.cloneNode();L.appendChild(y);v=new ol.Map({controls:ol.control.defaults({zoom:I.renderers.zoomControl?false:true,attribution:false}),interactions:ol.interaction.defaults({doubleClickZoom:false}),target:W,view:new ol.View({center:ol.proj.transform([I.center[1],I.center[0]],"EPSG:4326","EPSG:3857"),zoom:I.zoom,maxZoom:I.maxZoom,constrainResolution:true})});K=v.getViewport();if(I.renderers.zoomControl){I.renderers.zoomControl(W)}if(I.basemap){r.addBaseMap(I.basemap,"basemap")}if(I.layers){for(var X=0;X<I.layers.length;X++){o(I.layers[X])}}o(c).set("name","featureLayer");o(new ol.layer.Vector({source:T})).set("name","drawingLayer");var ab=new ol.style.Fill({color:[180,0,0,1]});var ac=new ol.style.Stroke({color:[180,0,0,1],width:1});var U=new ol.style.Style({image:new ol.style.Circle({fill:ab,stroke:ac,radius:3}),fill:ab,stroke:ac});c.setStyle(U);if(typeof ol.Overlay.Popup!=="undefined"){A=new ol.Overlay.Popup();v.addOverlay(A)}E=new ol.interaction.DragBox({condition:ol.events.condition.always,style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})});E.setActive(false);E.on("boxstart",function(ad){l=true;T.clear(true)});E.on("boxend",function(ad){l=false;var ae=ad.target.getGeometry();T.addFeature(new ol.Feature({geometry:ae}));var ag=M(ae);var af=H(ag);r.onBoxSelect(af,ae)});var aa=ol.interaction.DragBox.handleEvent;if(aa){E.handleEvent=function(ad){if(ad.pointerEvent&&ad.pointerEvent.pointerType==="touch"){ad.pointerEvent.pointerType="mouse"}return aa.apply(this,arguments)}}else{}v.addInteraction(E);v.on("moveend",function(){if(N===false){if(u<C.length-1){for(var ad=C.length-1;ad>u;ad--){C.pop()}}C.push({extent:v.getView().calculateExtent(v.getSize()),navStep:v.getSize(),zoom:v.getView().getZoom()});u=u+1}r.onExtentChange()});var V=function(ae){var af=ol.proj.transform(ae.coordinate,"EPSG:3857","EPSG:4326");var ad=af[0];if(ad<-180){while(ad<-180){ad=ad+360}}else{if(ad>180){while(ad>180){ad=ad-360}}}af[0]=ad;return af};v.on("pointermove",function(ad){var ae=V(ad);w(ae[1],ae[0]);r.onMouseMove(ae[1],ae[0])});v.on("singleclick",function(ad){var ae=V(ad);r.onMouseClick(ae[1],ae[0],ad.originalEvent)});v.on("contextmenu",function(ad){var ae=V(ad);r.onMouseClick(ae[1],ae[0],ad.originalEvent)});v.on("dblclick",function(ad){if(!l){var ae=V(ad);r.onDoubleClick(ae[1],ae[0])}});d(K,function(){var ag=function(){r.resize(true);s=P(m,r.resize)};var af=K.getElementsByTagName("canvas").length;if(af===0||isNaN(af)){var ae;var ad=function(){var ah=K.getElementsByTagName("canvas").length;if(ah===0||isNaN(ah)){ae=setTimeout(ad,100)}else{clearTimeout(ae);if(ag){ag.apply(r,[])}}};ae=setTimeout(ad,100)}else{if(ag){ag.apply(r,[])}}})};this.getCanvas=function(){return K.getElementsByTagName("canvas")[0]};this.back=function(){if(u>0){N=true;v.getView().fit(C[u-1].extent,C[u-1].navStep);v.getView().setZoom(C[u-1].zoom);setTimeout(function(){N=false},360);u=u-1}};this.next=function(){if(u<C.length-1){N=true;v.getView().fit(C[u+1].extent,C[u+1].navStep);v.getView().setZoom(C[u+1].zoom);setTimeout(function(){N=false},360);u=u+1}};this.getMap=function(){return v};this.getStatusDiv=function(){return a};this.getCoordinateDiv=function(){return L};this.setCoordinateFormat=function(U){I.coordinateFormat=U};this.updateSize=function(){r.resize()};this.resize=function(W){v.updateSize();var V=K.getElementsByTagName("canvas");for(var Y=0;Y<V.length;Y++){var X=V[Y];if(q(X,"width")&&q(X,"height")){var Z=X.parentNode.offsetWidth;var U=X.parentNode.offsetHeight;X.style.width=Z+"px";X.style.height=U+"px";if(f&&q(X,"transform")){X.style.transform=""}}}if(W!==true){r.onResize()}};var q=function(W,U){var V=W.style[U];if(V){return V.length>0}return false};this.zoomIn=function(){O(true)};this.zoomOut=function(){O(false)};var O=function(W){var U=v.getView();var V=U.getZoom()+(W?1:-1);U.animate({zoom:V,duration:200})};this.getZoomLevel=function(){return v.getView().getZoom()};this.getResolution=function(){return v.getView().getResolution()};this.getProjection=function(){return v.getView().getProjection().getCode()};this.getExtent=function(){var U=v.getView();var W=U.calculateExtent(v.getSize());var V=ol.geom.Polygon.fromExtent(W);var Y=M(V);var X=H(Y);return X};this.setExtent=function(V,X){if(V){V=D(V);var U=v.getView();try{U.fit(V,v.getSize())}catch(W){console.log(W)}}if(X!=null){X.call()}};this.containsExtent=function(V){V=D(V);var U=v.getView().calculateExtent(v.getSize());return ol.extent.containsExtent(U,V)};var D=function(W){if(typeof(W)==="string"||W instanceof String){var V=x.readFeature(W);var U=V.getGeometry();U.transform("EPSG:4326","EPSG:3857");W=U.getExtent()}else{if(W instanceof ol.geom.Geometry){W=W.getExtent()}else{if(W instanceof ol.Feature){var U=W.getGeometry();W=U.getExtent()}}}return W};this.setCenter=function(U,W,V){v.getView().setCenter(ol.proj.transform([W,U],"EPSG:4326","EPSG:3857"));if(V){v.getView().setZoom(V)}};this.getCenter=function(){var U=v.getView().getCenter();var V=new ol.geom.Point(U).transform("EPSG:3857","EPSG:4326").getCoordinates();return[V[1],V[0]]};this.onExtentChange=function(){};this.onResize=function(){};this.beforeLoad=function(U){};this.onLoad=function(U){};this.onMouseMove=function(U,V){};this.onMouseClick=function(V,W,U){};this.onDoubleClick=function(U,V){};this.onSelect=function(){};this.onBoxSelect=function(U,V){};this.panTo=function(V,W,Y){var U=v.getView();if(W!=null){var X=ol.animation.pan({duration:W,source:U.getCenter()});v.beforeRender(X)}r.setExtent(V,Y)};this.popup=function(W,V){if(typeof(W)==="string"||W instanceof String){var U=x.readFeature(W);W=U.getGeometry();W.transform("EPSG:4326","EPSG:3857");W=W.getCoordinates()}A.show(W,V)};this.hidePopup=function(){A.hide()};this.enableBoxSelect=function(){if(arguments.length===1&&arguments[0]===false){E.setActive(false)}else{E.setActive(true)}};this.clearBoxSelect=function(){r.clearDrawings()};this.drawLine=function(U,V){if(U==null){U=new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399cc",width:1})})}z("LineString",U,V)};this.drawPolygon=function(U,V){if(U==null){U=new ol.style.Style({image:null,stroke:new ol.style.Stroke({color:"#3399cc",width:1}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.4)"})})}z("Polygon",U,V)};this.clearDrawings=function(){T.clear(true);k()};var z=function(W,V,X){k();l=true;var U=new ol.interaction.Draw({source:T,type:W,style:V});U.on("drawstart",function(Y){T.clear(true)});U.on("drawend",function(Y){setTimeout(function(){var Z=Y.feature.getGeometry();var ab=M(Z);var aa=H(ab);k();if(X){X.apply(r,[aa,Z])}},100)});v.addInteraction(U)};var k=function(){v.getInteractions().forEach(function(U){if(U instanceof ol.interaction.Draw){v.removeInteraction(U)}});l=false};this.addBaseMap=function(X,W){if(typeof X==="string"){var V=X.toLowerCase();if((V.indexOf("{x}")>-1&&V.indexOf("{y}")>-1&&V.indexOf("{z}")>-1)){X=new ol.layer.Tile({source:new ol.source.XYZ({url:X})})}else{if(V=="osm"){X=new ol.layer.Tile({source:new ol.source.OSM({crossOrigin:null})})}}}var U=o(X,0);if(W){U.set("name",W)}return U};this.addLayer=function(V,U){var W=v.getLayers().getLength();if(U==null){U=W-2}else{if(U>W-2){U=U-2}}return o(V,U)};var o=function(V,U){if(V==null){return}if(U!=null){v.getLayers().insertAt(U,V)}else{v.addLayer(V)}var X=V.getSource();if(X instanceof ol.source.Vector){V.addFeature=function(Y){try{this.getSource().addFeature(g(Y))}catch(Z){console.log(Z)}};V.getFeatures=function(){return this.getSource().getFeatures()};V.clear=function(){this.getSource().clear(true)};V.getExtent=function(){return this.getSource().getExtent()}}else{V.clear=function(){};V.getExtent=function(){}}V.show=function(Z,aa){if(isNaN(Z)){this.setVisible(true)}else{var Y=this.getOpacity();if(Y>0){this.setOpacity(0);this.setVisible(true);n(this,0,Y,Z,aa)}else{this.setVisible(true);if(aa){aa.apply(r,[this])}}}};V.hide=function(Z,aa){if(isNaN(Z)){this.setVisible(false)}else{var Y=this.getOpacity();if(Y>0){n(this,Y,0,Z,function(ab){ab.setVisible(false);ab.setOpacity(Y);if(aa){aa.apply(r,[ab])}})}else{this.setVisible(false);if(aa){aa.apply(r,[this])}}}};V.isVisible=function(){return this.getVisible()};V.setOpacity_=V.setOpacity;V.setOpacity=function(Y,Z,aa){if(isNaN(Z)){this.setOpacity_(Y)}else{n(this,this.getOpacity(),Y,Z,aa)}};if(V instanceof ol.layer.Tile){var W=V.getSource();W.on("tileloadstart",function(){r.beforeLoad(V);clearTimeout(F);a.innerHTML="Loading..."});W.on(["tileloadend","tileloaderror"],function(){clearTimeout(F);F=setTimeout(function(){a.innerHTML="";r.onLoad(V)},800)});V.refresh=function(){var Y=this.getSource();Y.tileCache.expireCache({});Y.tileCache.clear();if(Y.clear){Y.refresh()}}}return V};this.getLayers=function(){return p(v.getLayers())};var p=function(U){var V=[];U.forEach(function(W){if(W instanceof ol.layer.Group){V.push(W.getLayers())}else{V.push(W)}});return V};this.removeLayer=function(U){v.removeLayer(U)};this.addFeature=function(U){c.addFeature(g(U))};var g=function(W){if(W instanceof ol.Feature){return W}else{var U;if(W!=null){if(W.geom){U=j(W.geom)}else{if(W.geometry){U=j(W.geometry)}else{U=j(W)}}}var V=new ol.Feature({});if(U){V.setGeometry(U)}return V}};var j=function(V){if(typeof V==="string"||V instanceof String){var U=x.readFeature(V);V=U.getGeometry();V.transform("EPSG:4326","EPSG:3857");return V}else{if(V instanceof ol.geom.Geometry){return V}else{return null}}};this.clearFeatures=function(){c.getSource().clear()};this.createPointLayer=function(U,W){var V=new ol.layer.Vector({source:new ol.source.Vector({}),style:i(U,W),visible:true});r.addLayer(V);t(V);return V};var i=function(U,V){if(typeof U==="string"){U=ol.color.asArray(U)}var X=new ol.style.Fill({color:U});var W=new ol.style.Stroke({color:U,width:0});return new ol.style.Style({image:new ol.style.Circle({fill:X,stroke:W,radius:V}),fill:X,stroke:W})};this.createVectorLayer=function(U){var W;if(U){W=new ol.style.Style({stroke:new ol.style.Stroke({color:U,width:1})})}else{W=new ol.layer.Vector().getStyleFunction()()}var V=new ol.layer.Vector({source:new ol.source.Vector({}),style:function(Y){var Z=Y.get("style");if(Z){return Z}var aa=Y.get("color");var ab=Y.get("fill");if(aa||ab){var X={};if(aa){X.stroke=new ol.style.Stroke({color:aa,width:1})}if(ab){X.fill=new ol.style.Fill({color:ab})}return new ol.style.Style(X)}return W}});r.addLayer(V);t(V);return V};var t=function(U){U.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([-20026376.39,-20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}));U.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([20026376.39,20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}))};this.getTilePreview=function(V,ab,aa){if(!aa){return}var W=ol.proj.get("EPSG:3857");var U=function(){var ac=V.getSource().getTileUrlFunction();var ad=[3,2,3];var ae=ac(ad,1,W);if(ae){if(ae.indexOf("-4")>-1){ae=ae.replace("-4","3")}}return ae};var Y=U();if(Y){aa.apply(r,[Y])}else{var Z;var X=function(){var ac=U();if(ac){clearTimeout(Z);aa.apply(r,[ac])}else{Z=setTimeout(X,1000)}};Z=setTimeout(X,1000)}};this.getTileGeom=function(ad,ab,Z){var V=B(ab,Z);var Y=B(ab+1,Z);var af=h(ad,Z);var aa=h(ad+1,Z);var U=[aa,V];var X=[aa,Y];var ae=[af,Y];var W=[af,V];var ac=[U,W,ae,X,U];return new ol.geom.Polygon([ac])};var h=function(U,V){return U/Math.pow(2,V)*360-180};var B=function(X,V){var W=Math.PI-(2*Math.PI*X)/Math.pow(2,V);var U=Math.atan(Math.sinh(W));return U*(180/Math.PI)};var b=function(Y){var W=(Y.getTileGrid())?Y.getTileGrid():ol.tilegrid.getForProjection(v.getView().getProjection()),X=W.getZForResolution(v.getView().getResolution()),V=W.getTileRangeForExtentAndZ(v.getView().calculateExtent(v.getSize()),X),U=V.maxX-V.minX+1,Z=V.maxY-V.minY+1;return U*Z};var n=function(X,af,ac,V,ae,U,W){if(!U){U=new Date().getTime()}if(!W){W=V}var Y=new Date().getTime();var ab=Y-U;if(W<=ab){X.setOpacity(ac);if(ae){ae.apply(r,[X])}return}W-=ab;var aa=1-(W/V);var Z;var ad=Math.abs(af-ac);if(af<ac){Z=af+(ad*aa)}else{Z=af-(ad*aa)}X.setOpacity(Z);setTimeout(function(){n(X,af,ac,V,ae,Y,W)},33)};var M=function(W){W=W.clone().transform("EPSG:3857","EPSG:4326");var X=W.getExtent();var Z=0;var U=X[0];if(U<-180){while(U<-180){U=U+360;Z+=360}}else{if(U>180){while(U>180){U=U-360;Z=Z-360}}}var Y=W.getCoordinates()[0];for(var V=0;V<Y.length;V++){var aa=Y[V];aa[0]+=Z}return Y};var H=function(W){var V="POLYGON((";for(var U=0;U<W.length;U++){if(U>0){V+=","}V+=W[U].join(" ")}V+="))";return V};var w=function(ad,V){if(V>180){while(V>360){V=V-360}}else{if(V<180){while(V<-360){V=V+360}}}if(V>180){V=-180-(180-V)}if(V<-180){V=180+(V+180)}var Z=(ad>=0)?"N":"S";var X=(V>=0)?"E":"W";if(I.coordinateFormat==="DMS"){var ac=1;if(ad<0){ac=-1}var ab=Math.abs(Math.round(ad*1000000));var af=1;if(V<0){af=-1}var ae=Math.abs(Math.round(V*1000000));var W=Math.floor(((ab/1000000)-Math.floor(ab/1000000))*60);var Y=Math.floor(((ae/1000000)-Math.floor(ae/1000000))*60);if(W<10){W="0"+W}if(Y<10){Y="0"+Y}var ag=(Math.floor(((((ab/1000000)-Math.floor(ab/1000000))*60)-Math.floor(((ab/1000000)-Math.floor(ab/1000000))*60))*100000)*60/100000);var U=(Math.floor(((((ae/1000000)-Math.floor(ae/1000000))*60)-Math.floor(((ae/1000000)-Math.floor(ae/1000000))*60))*100000)*60/100000);if(ag<10){ag="0"+ag}if(U<10){U="0"+U}if(ag.toString().indexOf(".")<0){ag+=".0000"}if(U.toString().indexOf(".")<0){U+=".0000"}ad=((Math.floor(ab/1000000)*ac)+"&deg;"+W+"'"+ag);V=((Math.floor(ae/1000000)*af)+"&deg;"+Y+"'"+U);var aa=(ad+"0000").split(".");if(aa.length==2){aa[1]=aa[1].substring(0,4);ad=aa[0]+"."+aa[1]}aa=(V+"0000").split(".");if(aa.length==2){aa[1]=aa[1].substring(0,4);V=aa[0]+"."+aa[1]}ad+='" '+Z;V+='" '+X}else{ad=Q(ad,9)+" "+Z;V=Q(V,9)+" "+X}e.innerHTML=V;y.innerHTML=ad};var Q=function(V,U){return Number(Math.round(parseFloat(V+"e"+U))+"e-"+U)};var J=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.onRender;var G=javaxt.dhtml.utils.setStyle;var P=javaxt.dhtml.utils.addResizeListener;R()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.Map=kartographia.Map;
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapMenu=function(i,b){var f=this;var d={style:{thumbnail:"map-tile",label:"map-tile-label map-info"},layers:{}};var a;var j=function(){if(typeof i==="string"){i=document.getElementById(i)}if(!i){return}var k={};g(k,b);g(k,d);b=k;a=document.createElement("div");i.appendChild(a);f.update();f.el=a};this.show=function(){f.el.style.display=""};this.hide=function(){f.el.style.display="none"};this.update=function(){for(var l in b.layers){if(b.layers.hasOwnProperty(l)){var k=b.layers[l];var m=k.div;if(!m){k.div=c(k)}}}};this.onSelect=function(k){};var c=function(m){var o=document.createElement("div");e(o,b.style.thumbnail);a.appendChild(o);var l=document.createElement("div");e(l,b.style.label);l.style.zIndex=1;l.innerHTML=m.name;o.appendChild(l);var n=document.createElement("div");n.style.position="absolute";o.appendChild(n);var k=document.createElement("img");k.src=m.preview;n.appendChild(k);o.onclick=function(){f.onSelect(m)};return o};var g=javaxt.dhtml.utils.merge;var e=javaxt.dhtml.utils.setStyle;var h=javaxt.dhtml.utils.createTable;j()};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapOverlay=function(e){var c=this;var d;var f=function(){var i=e.el.offsetWidth;var q=e.el.offsetHeight;var n=e.getProjection();var l=e.getMap();var p=l.getView();var r=p.calculateExtent(l.getSize());var m=r[0];var k=r[1];var h=r[2];var g=r[3];var o=e.overlay;if(!o){d=new com.kartographia.MapTile(m,k,h,g,i,q,n);var j=d.getCanvas();j.style.position="absolute";j.style.top=0;j.style.width="100%";j.style.height="100%";e.el.appendChild(j);e.overlay=d}else{d=e.overlay}};this.remove=function(){var g=d.getCanvas();e.el.removeChild(g);e.overlay=null};this.clear=function(){d.clear()};this.addPoint=function(j,k,g,i,h){d.addPoint(j,k,g,i,h)};this.addLine=function(i,g,h){d.addLine(i,g,h)};this.addText=function(k,i,j,g,h){d.addText(k,i,j,g,h)};this.renderTracks=function(K,H,L){if(!K){return}var p=L.tailLength;var F=L.color;var B=L.labels?L.labels.indexOf("device")>-1:false;var l=L.labels?L.labels.indexOf("telemetry")>-1:false;var z=L.speed;if(z!=null){if(z.indexOf("-")===-1){z=[0,parseFloat(z)]}else{var g=z.split("-");z=[parseFloat(g[0]),parseFloat(g[1])]}}for(var I=0;I<K.length;I++){var C=K[I];var h=b(C,H);if(h!=null){var s=h[1];var n=h[0];var o=h[3];var J=h[4];var q=J!=null?(J*2.236936):0;if(z){if(q>=z[0]&&q<=z[1]){}else{continue}}var u=null;if(B==true){u=C.id+""}if(l==true){if(q>0){q=a(q);if(q==0){q=0.1}q+=" mph";if(u==null){u=q}else{u+="\n"+q}if(o!=null){u+=", bearing "+a(o)}}}d.addPoint(s,n,F,5,u);if(o!=null||J!=null){var A=[[s,n]];var r=s;var m=n;var w=H-(p*60*1000);var N=[];for(var G=0;G<C.coords.length;G++){var M=C.coords[G];if(M[2]>=w&&M[2]<H){N.push(M)}}var y=H;for(var y=H;y>=w;y=y-(60*1000)){var v=N.length;for(var E=N.length-1;E>=0;E--){var D=N[E];if(D[2]>y){s=D[1];n=D[0];if(s!=r&&n!=m){A.push([s,n])}v--}}N.length=v;var M=b(C,y);if(M){s=M[1];n=M[0];if(s!=r&&n!=m){A.push([s,n])}r=s;m=n}}if(A.length>1){d.addLine(A,F,1)}}}}};var b=function(g,h){return com.kartographia.utils.getCoord(g.coords,h)};var a=function(g){return Math.round(g*10)/10};f()};
if(!kartographia){var kartographia={}}kartographia.MapTile=function(q,o,p,n,j,i,s){var r=this;var e=0;var d=0;var b=1;var a=1;var c,k;var l=function(){c=document.createElement("canvas");c.width=j;c.height=i;k=c.getContext("2d");if(s=="EPSG:3857"){e=q;d=n;b=j/h(p,q);a=i/h(o,n)}else{if(s=="EPSG:4326"){q=g(q);o=f(o);p=g(p);n=f(n);e=q;d=n;b=j/(p-q);a=i/(o-n)}}};this.getCanvas=function(){return c};this.getImage=function(){return k.getImageData(0,0,c.width,c.height)};this.clear=function(){k.clearRect(0,0,c.width,c.height)};this.addPoint=function(y,u,w,C,A){var v=g(u);var z=f(y);var t=C/2;k.beginPath();k.arc(v,z,t,0,2*Math.PI,false);k.fillStyle=w;k.fill();if(A!=null){var x=A.split("\n");var B=15;k.font=B+"px Arial";k.fillText(x[0],v+t,z);if(x.length>1){k.font="8px Arial";k.fillText(x[1],v+t,(z+B))}}};this.addLine=function(B,v,x){k.strokeStyle=v;if(x){k.lineWidth=x}k.beginPath();for(var w=0;w<B.length;w++){var y=B[w];var z=y[0];var t=y[1];var u=g(t);var A=f(z);if(w==0){k.moveTo(u,A)}else{k.lineTo(u,A)}}k.stroke()};this.addPolygon=function(C,A,v,x){if(v){k.fillStyle=v;k.beginPath();for(var w=0;w<C.length;w++){var y=C[w];var z=y[0];var t=y[1];var u=g(t);var B=f(z);if(w==0){k.moveTo(u,B)}else{k.lineTo(u,B)}}k.closePath();k.fill()}if(A){r.addLine(C,A,x)}};this.addText=function(z,x,y,t,v){var u=g(y);var w=f(x);k.fillStyle=t;k.font=v+"px Arial";k.fillText(z,u,w)};var g=function(u){if(s=="EPSG:3857"){var t=u*20037508.34/180;var v=h(t,e);if(t<e){v=-v}return v*b}else{if(s=="EPSG:4326"){u+=180;var t=(u-e)*b;return t}}};var f=function(t){if(s=="EPSG:3857"){var v=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);v=v*20037508.34/180;var u=h(v,d);if(v>d){u=-u}return u*a}else{if(s=="EPSG:4326"){t=-t;if(t<=0){t=90+-t}else{t=90-t}t=180-t;var v=(t-d)*a;if(m(v)==0||m(v)==-0){v=0}return v}}};var m=function(t){return Math.round(t)};var h=function(u,t){return Math.abs(u-t)};l()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapTile=kartographia.MapTile;
if(!kartographia){var kartographia={}}kartographia.utils={getTileCoordinate:function(d,g,i){var c=function(m,k,l){return Math.min(Math.max(m,k),l)};var e=c(d,-85.05112878,85.05112878);var b=c(g,-180,180);var h=(b+180)/360*(1<<i);var f=(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(d*Math.PI/180))/Math.PI)/2*(1<<i);var a=parseInt(Math.trunc(h));var j=parseInt(Math.trunc(f));return[a,j]},line2Polygon:function(v,a){var b=[];for(var w=0;w<v.length;w++){var r=v[w];b.push({x:r[0],y:r[1]})}v=b;if(!k(a)){var n=a;a=[];for(var w=0;w<v.length;w++){a.push(n)}}function m(A,t,C){var B=t.x-A.x,z=t.y-A.y,i=Math.sqrt(B*B+z*z),D=C/(2*i);return{x:-D*z,y:D*B}}function x(t,E,i,C){var A=(E.y-t.y)/(E.x-t.x),z=(C.y-i.y)/(C.x-i.x);if(Math.abs(A-z)<0.00001){return}var G=t.y-A*t.x;var F=i.y-z*i.x;var D=(G-F)/(z-A);var B=A*D+G;return{x:D,y:B}}function k(i){return(Object.prototype.toString.call(i)==="[object Array]")}var y,q,f=[],j,l,u,s,g,e,d,p,c,o;for(var w=0,h=v.length-1;w<h;w++){j=!w;l=(w===v.length-2);y=m(v[w],v[w+1],a[w]);q=m(v[w],v[w+1],a[w+1]);d={x:v[w].x+y.x,y:v[w].y+y.y};p={x:v[w+1].x+q.x,y:v[w+1].y+q.y};c={x:v[w].x-y.x,y:v[w].y-y.y};o={x:v[w+1].x-q.x,y:v[w+1].y-q.y};if(!j){g=x(u[0],u[1],d,p);if(g){f.unshift(g)}e=x(s[0],s[1],c,o);if(e){f.push(e)}}if(j){f.unshift(d);f.push(c)}if(l){f.unshift(p);f.push(o)}if(!l){u=[d,p];s=[c,o]}}for(var w=0;w<f.length;w++){var r=f[w];f[w]=[r.x,r.y]}f.push(f[0]);return f},getCoord:function(k,u){var a=null;var x=null;var s=null;var w=function(e,j){return window.getLatLon(j,e)};var b=function(j,e){return j.distanceTo(e)};var z=function(t,j){var e=t.initialBearingTo(j);return isNaN(e)?0:e};var o=function(t,A,e){var j=t.destinationPoint(A,e);return[j.longitude,j.latitude]};for(var r=0;r<k.length;r++){var q=k[r];var l=q[2];if(l>u){x=q;if(r>0){s=k[r-1];var h=s[2];if(h==l){a=s;if(r>1){s=k[r-2]}else{s=null}}}break}}if(s!=null){var p=w(s[0],s[1]);var i=s[2];var d;var v;if(s.length<4){var n;var h;if(a!=null){n=w(a[0],a[1]);h=a[2]}else{n=w(x[0],x[1]);h=x[2]}var c=b(p,n);var f=(h-i)/1000;v=c/f;d=z(p,n);s.push(d);s.push(v)}else{d=s[3];v=s[4]}var g=(u-i)/1000;var m=v*g;try{a=o(p,m,d);a.push(u);a.push(d);a.push(v)}catch(y){}}return a}};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.utils=kartographia.utils;